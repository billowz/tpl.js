!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("jquery"),require("observer")):"function"==typeof define&&define.amd?define(["_","jquery","observer"],e):"object"==typeof exports?exports.tpl=e(require("_"),require("jquery"),require("observer")):t.tpl=e(t._,t.jQuery,t.observer)}(this,function(t,e,n){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var r=n(1);r.Directives=n(9),r.expression=n(10),t.exports=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},o=n(2),s=n(3),c=n(4),a=n(7),p=a.Directive,u=a.DirectiveGroup,l=function(t){return new RegExp([t[0],"([^",t[0],t[0],"]*)",t[1]].join(""),"g")},h=function(t){return new RegExp("^"+t)},f={delimiter:["{","}"],directivePrefix:"tpl-"},d=0,v=function(){function t(e,n){r(this,t),this.template=s(e),n=n||{},this.directivePrefix=n.directivePrefix||f.directivePrefix,this.delimiter=n.delimiter||f.delimiter,this.directiveReg=h(this.directivePrefix),this.delimiterReg=l(this.delimiter),this.__instance_nr__=0,this.__id__=d++}return t.prototype.complie=function(t,e){return new y(this,t,e)},t}(),y=function(){function t(e,n,i){r(this,t),this.tpl=e,this.scope=n,this.el=this.tpl.template.clone(),this.parent=i,this.__id__=e.__id__+"-"+e.__instance_nr__++,this.init()}return t.prototype.renderTo=function(t){return s(t).append(this.el),this},t.prototype.init=function(){var t=this;this.bindings=this.parse(this.el),this.bindings.forEach(function(e){e.bind(),t.scope=e.scope})},t.prototype.parse=function(t){var e=this;if(!(t.jquery||t instanceof Array))return this.parseEl(t);var n=function(){var n=[];return o.each(t,function(t){n.push.apply(n,e.parseEl(t))}),{v:n}}();return"object"===("undefined"==typeof n?"undefined":i(n))?n.v:void 0},t.prototype.parseEl=function(t){switch(t.nodeType){case 1:return this.parseElement(t);case 3:return this.parseText(t)}},t.prototype.parseText=function(t){for(var e=t.data,n=void 0,r=0,i=this.tpl.delimiterReg,o=[];n=i.exec(e);)this.createTextNode(e.substring(r,i.lastIndex-n[0].length),t),n[1]&&o.push(new c(this.createTextNode("binding",t),this,n[1])),r=i.lastIndex;return this.createTextNode(e.substr(r),t),s(t).remove(),o},t.prototype.createTextNode=function(t,e){if(t=o.trim(t)){var n=document.createTextNode(t);return s(n).insertBefore(e),n}},t.prototype.parseElement=function(t){var e=this,n=!1,r=(s(t),[]),i=[];return t.attributes&&(o.each(t.attributes,function(t){var r=t.name,o=t.value,s=void 0;if((r=e.parseDirectiveName(r))&&(s=p.getDirective(r))){if(s.prototype["abstract"])return i=[{"const":s,val:o}],n=!0,!1;i.push({"const":s,val:o}),s.prototype.block&&(n=!0)}else r&&console.warn("Directive is undefined "+t.name)}),i.length>1?r.push(new u(t,this,i)):1==i.length&&r.push(new i[0]["const"](t,this,i[0].val))),n||r.push.apply(r,this.parseChildNodes(t)),r},t.prototype.parseChildNodes=function(t){return this.parse(o.slice(t.childNodes,0))},t.prototype.parseDirectiveName=function(t){var e=this.tpl.directiveReg;return e.test(t)?t.replace(e,""):void 0},t}();t.exports=v},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=(n(2),n(3)),c=n(5),a=c.Binding,p=function(t){function e(n,o,s){r(this,e);var c=i(this,t.call(this,o,s));return c.el=n,c.observeHandler=c.observeHandler.bind(c),c}return o(e,t),e.prototype.bind=function(){a.generateComments&&!this.comment&&(this.comment=s(document.createComment("Text Binding "+this.expr)),this.comment.insertBefore(this.el)),this.observe(this.expr,this.observeHandler),this.update(this.value(this.expr))},e.prototype.unbind=function(){this.unobserve(this.expr,this.observeHandler)},e.prototype.observeHandler=function(t,e){this.update(e)},e.prototype.update=function(t){void 0!==t&&null!==t||(t=""),this.el.data=t},e}(a);t.exports=p},function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(2),c=n(6),a=e.AbstractBinding=function(){function t(e){o(this,t),this.tpl=e,this.scope=e.scope}return t.prototype.bind=function(){throw"Abstract Method ["+this.constructor.name+".bind]"},t.prototype.unbind=function(){throw"Abstract Method ["+this.constructor.name+".unbind]"},t}(),p=/((?:'[^']*')*(?:(?:[^\|']+(?:'[^']*')*[^\|']*)+|[^\|]+))|^$/g,u=/^$/g,l=e.Binding=function(t){function e(n,i){o(this,e);var s=r(this,t.call(this,n));s.fullExpr=i;var c=i.match(p);return s.expr=c.shift(),s.filterExprs=c,console.log(s.className+': "'+s.expr+'" | '+c.join(" & ")),s.filters=s.filterExprs.map(function(t){var e=t.match(u);return e?{name:e.shift(),args:e}:null}).filter(function(t){return t}),s}return i(e,t),e.prototype.realValue=function(t,e){if(2==arguments.length)return s.set(this.scope,t,e);for(var n=this.scope,r=this.tpl;!s.has(n,t);){if(r=r.parent,!r)return;n=r.scope}return s.get(n,t)},e.prototype.value=function(t,e){return 2==arguments.length?this.realValue(t,this.unapplyFilter(e)):this.applyFilter(this.realValue(t))},e.prototype.applyFilter=function(t){for(var e=0;e<this.filters.length;e++)t=this.filters[e].apply(t);return t},e.prototype.unapplyFilter=function(t){for(var e=0;e<this.filters.length;e++)t=this.filters[e].unapply(t);return t},e.prototype.observe=function(t,e){return this.scope=c.on(this.scope,t,e)},e.prototype.unobserve=function(t,e){return this.scope=c.un(this.scope,t,e)},e}(a);l.generateComments=!0},function(t,e){t.exports=n},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},c=n(2),a=n(3),p=n(5),u=p.Binding,l=p.AbstractBinding,h=n(8),f=h.ArrayIterator,d=h.YieId,v="extend",y=(e.DirectiveGroup=function(t){function e(n,o,s){r(this,e);var c=i(this,t.call(this,o));return c.el=n,s.sort(function(t,e){return e["const"].prototype.priority-t["const"].prototype.priority||0}),c.directives=s.map(function(t){return new t["const"](n,o,t.val)}),c}return o(e,t),e.prototype.bind=function(){function t(){for(var r=void 0,i=void 0;e.hasNext();)if(r=e.next(),i=r.bind(),n.scope=r.scope,e.hasNext()&&i&&i instanceof d){i.then(t);break}}var e=new f(this.directives),n=this;t()},e.prototype.unbind=function(){var t=this;this.directives.forEach(function(e){e.unbind(),t.scope=e.scope})},e}(l),e.Directive=function(t){function e(n,o,s){r(this,e);var c=i(this,t.call(this,o,s));return c.el=n,c.$el=a(n),c.attr=o.tpl.directivePrefix+c.name,c}return o(e,t),e.prototype.bindComments=function(){u.generateComments&&!this.comment&&(this.comment=a(document.createComment(" Directive:"+this.name+" ["+this.expr+"] ")),this.comment.insertBefore(this.el))},e}(u));y.prototype["abstract"]=!1,y.prototype.name="Unkown",y.prototype.block=!1,y.prototype.priority=0;var b={},m=y.isDirective=function(t){var e="undefined"==typeof t?"undefined":s(t);if(!t||"function"!=e&&"object"!=e)return!1;for(var n=t;n=Object.getPrototypeOf(n);)if(n===y)return!0;return!1};y.getDirective=function(t){return b[t]},y.register=function(t,e){t in b&&console.warn("Directive["+t+"] is defined");var n=void 0;if(c.isPlainObject(e))n=function(t,e){var n=t[v];if(n&&!m(n))throw"Invalid Directive SuperClass "+n;e=n||e;var r=c.isFunction(t.constructor)?t.constructor:void 0,i=function(){var t=function(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");e.apply(this,arguments),r&&r.apply(this,arguments)};return t}();return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),delete t.constructor,delete t[v],c.each(t,function(t,e){i.prototype[e]=t}),Object.setPrototypeOf(i,e),i}(e,y),n.prototype.className=c.capitalize(t)+"Directive";else{if(!m(e))throw TypeError("Invalid Directive Object "+e);n=e,n.prototype.className=n.prototype.constructor.name}return n.prototype.name=t,b[t]=n,n}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var i=n(2);e.YieId=function(){function t(){r(this,t),this._doned=!1,this._thens=[]}return t.prototype.then=function(t){i.include(this._thens,t)||this._thens.push(t)},t.prototype.done=function(){this._doned||(i.each(this._thens,function(t){return t()}),this._doned=!0)},t.prototype.isDone=function(){return this._doned},t}(),e.ArrayIterator=function(){function t(e,n){r(this,t),this.array=e,this.index=n||0}return t.prototype.hasNext=function(){return this.index<this.array.length},t.prototype.next=function(){return this.array[this.index++]},t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(e,n){var r=p.register(e,n);t.exports[r.prototype.className]=r}e.__esModule=!0;var c=n(2),a=n(7),p=a.Directive,u=n(1),l=n(8),h=l.YieId,f=e.AbstractEventDirective=function(t){function e(n,o,s){r(this,e);var c=i(this,t.call(this,n,o,s));return c.handler=c.handler.bind(c),c}return o(e,t),e.prototype.handler=function(t){var e=this.value(this.expr);if("function"!=typeof e)throw TypeError("Invalid Event Handler ");e.call(this.scope,t,t.target,this.scope)},e.prototype.bind=function(){this.$el.on(this.eventType,this.handler)},e.prototype.unbind=function(){this.$el.un(this.eventType,this.handler)},e}(p),d=["blur","change","click","dblclick","error","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","resize","scroll","select","submit","unload",{name:"oninput",eventType:"input propertychange"}];c.each(d,function(t){var e=void 0;c.isString(t)?(e="on"+t,t={eventType:t}):e=t.name,t.extend=f,s(e,t)});var v=e.AbstractExpressionDirective=function(t){function e(n,o,s){r(this,e);var c=i(this,t.call(this,n,o,s));return c.observeHandler=c.observeHandler.bind(c),c}return o(e,t),e.prototype.bind=function(){this.observe(this.expr,this.observeHandler),this.update(this.value(this.expr))},e.prototype.unbind=function(){this.unobserve(this.expr,this.observeHandler)},e.prototype.blankValue=function(t){return 0==arguments.length&&(t=this.value(this.expr)),void 0===t||null==t?"":t},e.prototype.observeHandler=function(t,e){this.update(this.applyFilter(e))},e.prototype.update=function(t){throw"Abstract Method ["+this.className+".update]"},e}(p),y="change",b="input propertychange",m="click",x="SELECT",g="INPUT",w="TEXTAREA",_="radio",E="checkbox",$={text:{update:function(t){console.log(this.className,t),this.$el.text(this.blankValue(t))},block:!0},html:{update:function(t){this.$el.html(this.blankValue(t))},block:!0},"class":{update:function(t){var e=this.blankValue(t);this.oldCls&&this.$el.removeClass(this.oldCls),this.$el.addClass(e),this.oldCls=e}},show:{update:function(t){this.$el.css("display",t?"":"none")}},hide:{update:function(t){this.$el.css("display",t?"none":"")}},value:{update:function(t){this.$el.val(this.blankValue(t))}},checked:{update:function(t){this.$el.prop("checked",!!t)}},"if":{bind:function(){return v.prototype.bind.call(this),this.directives?void 0:(this.yieId=new h,this.yieId)},update:function(t){var e=this;t?(this.directives||(this.directives=this.tpl.parseChildNodes(this.el),this.directives.forEach(function(t){t.bind(),e.scope=t.scope}),this.yieId&&(this.yieId.done(),delete this.yieId)),this.$el.css("display","")):this.$el.css("display","none")},unbind:function(){var t=this;v.prototype.unbind.call(this),this.directives&&this.directives.forEach(function(e){e.unbind(),t.scope=e.scope})},priority:9,block:!0},input:{constructor:function(t,e,n){v.call(this,t,e,n),this.onChange=this.onChange.bind(this);var r=this.tag=t.tagName;switch(r){case x:this.event=y;break;case g:var i=this.type=t.type;this.event=i==_||i==E?m:b;break;case w:throw TypeError("Directive[input] not support "+r);default:throw TypeError("Directive[input] not support "+r)}},bind:function(){v.prototype.bind.call(this),this.$el.on(this.event,this.onChange)},unbind:function(){v.prototype.unbind.call(this),this.$el.un(this.event,this.onChange)},onChange:function(){var t=this.elVal();t!=this.val&&this.value(this.expr,t)},update:function(t){this.val=this.blankValue(t),this.elVal(this.val)},elVal:function(t){var e=this.tag;switch(e){case x:break;case g:var n=this.type;if(n==_||n==E){if(0==arguments.length)return this.$el.prop("checked")?this.$el.val():void 0;var r=c.isString(t)?t==this.$el.val():!!t;this.$el.prop("checked")!=r&&this.$el.prop("checked",r)}else{if(0==arguments.length)return this.$el.val();t!=this.$el.val()&&this.$el.val(t)}break;case w:throw TypeError("Directive[input] not support "+e);default:throw TypeError("Directive[input] not support "+e)}}}};c.each($,function(t,e){t.extend=v,s(e,t)});var T=/^\s*([\S][\s\S]+[\S])\s+in\s+([\S]+)(\s+track\s+by\s+([\S]+))?\s*$/,k=/^(\(\s*([\S]+)(\s*,\s*([\S]+))?\s*\))|([\S]+)(\s*,\s*([\S]+))$/,O=e.EachDirective=function(t){function e(n,o,s){r(this,e);var c=i(this,t.call(this,n,o,s));c.observeHandler=c.observeHandler.bind(c),c.lengthObserveHandler=c.lengthObserveHandler.bind(c);var a=s.match(T);if(!a)throw Error("Invalid Expression["+s+"] on Each Directive");c.scopeExpr=a[2],c.indexExpr=a[4];var p=a[1].match(k);if(!p)throw Error("Invalid Expression["+a[1]+"] on Each Directive");return c.valueAlias=p[2]||p[5],c.keyAlias=p[4]||p[7],c.$parentEl=c.$el.parent(),c.$el.remove().removeAttr(c.attr),c.childTpl=new u(c.$el),c}return o(e,t),e.prototype.bindChild=function(t,e){var n={__index__:this.indexExpr?c.get(e,this.indexExpr):t};this.keyAlias&&(n[this.keyAlias]=t),n[this.valueAlias]=e;this.childTpl.complie(n,this.tpl).renderTo(this.$parentEl)},e.prototype.bind=function(){this.observe(this.scopeExpr,this.observeHandler),this.observe(this.scopeExpr+".length",this.lengthObserveHandler),this.update(this.realValue(this.scopeExpr))},e.prototype.unbind=function(){t.prototype.unbind.call(this),this.unobserve(this.scopeExpr,this.observeHandler),this.unobserve(this.scopeExpr+".length",this.lengthObserveHandler)},e.prototype.update=function(t){if(!(t instanceof Array))throw Error("Invalid Each Scope["+this.scopeExpr+"]");for(var e=0;e<t.length;e++)this.bindChild(e,t[e])},e.prototype.observeHandler=function(t,e){this.update(e)},e.prototype.lengthObserveHandler=function(){this.update(this.realValue(this.scopeExpr))},e}(p);O.prototype["abstract"]=!0,O.prototype.block=!0,O.prototype.priority=10,p.register("each",O)},function(t,e){"use strict";function n(t,e){var n=w.length;return w[n]=e?t.replace(v,"\\n"):t,'"'+n+'"'}function r(t){var e=t.charAt(0),n=t.slice(1);return l.test(n)?t:(n=n.indexOf('"')>-1?n.replace(b,i):n,e+"scope."+n)}function i(t,e){return w[e]}function o(t){try{return new Function("binding","return "+t+";")}catch(e){throw Error("Invalid expression. Generated function body: "+t)}}function s(t){if(f.test(t))throw Error("Invalid expression. Generated function body: "+t);w.length=0;var e=t.replace(y,n).replace(d,"");return e=(" "+e).replace(x,r).replace(b,i),o(e)}function c(t){}function a(t){return m.test(t)&&!g.test(t)&&"Math."!==t.slice(0,5)}function p(t,e){t=t.trim();var n={exp:t};return n.get=a(t)&&t.indexOf("[")<0?o("binding.value("+t+")"):s(t),e&&(n.set=c(t)),n}e.__esModule=!0,e.isSimplePath=a,e.parse=p;var u="Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat",l=new RegExp("^("+u.replace(/,/g,"\\b|")+"\\b)"),h="break,case,class,catch,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,let,return,super,switch,throw,try,var,while,with,yield,enum,await,implements,package,proctected,static,interface,private,public",f=new RegExp("^("+h.replace(/,/g,"\\b|")+"\\b)"),d=/\s/g,v=/\n/g,y=/[\{,]\s*[\w\$_]+\s*:|('(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"|`(?:[^`\\]|\\.)*\$\{|\}(?:[^`\\]|\\.)*`|`(?:[^`\\]|\\.)*`)|new |typeof |void /g,b=/"(\d+)"/g,m=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/,x=/[^\w$\.](?:[A-Za-z_$][\w$]*)/g,g=/^(?:true|false)$/,w=[]}])});