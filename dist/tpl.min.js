!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("utility"),require("observer")):"function"==typeof define&&define.amd?define("tpl",["utility","observer"],t):e.tpl=t(e.utility,e.observer)}(this,function(e,t){function n(e,t){var n=ie.length;return ie[n]=t?e.replace(Z,"\\n"):e,'"'+n+'"'}function i(e,t){return ie[t]}function r(e,t,n){var i=e.length,r=e.charAt(i-1),o=e.slice(0,i-1),s=o.match(ne)[0];return U[s]||oe[s]?e:"$context"===s?e.replace(ne,se):"("==r?(r=t+i==n.length||")"==n.charAt(t+i)?"":",",se="this.propScope('"+s+"')","$scope."+o+".call("+se+r):(re[o]=!0,"$scope."+o+r)}function o(e){return se=void 0,(e+" ").replace(te,r).replace(J,i)}function s(e,t){for(var n=0,i=e.length;n<i;n++)e[n]=l(o(e[n]),t);return e}function a(t,n){if(!t||!t.length)return[];for(var r=[],o=void 0,a=void 0,c=0,u=t.length;c<u;c++)(o=e.trim(t[c]))&&(a=o.replace(/,?\s+/g,",").split(","),r.push({name:a.shift().replace(J,i),args:s(a,n)}));return r}function c(t,r){var s=void 0,c=void 0,h=d(t);return re={},oe=r?e.reverseConvert(r,function(){return!0}):{},h||(s=t.replace(G,n).split("|"),t=s.shift().replace(K,""),h=d(t)),h?(t=t.replace(J,i),re[t]=!0,c={execute:l("$scope."+t,r),path:e.parseExpr(t),expr:t}):c={execute:l(o(t),r),expr:t},c.filters=a(s,r),c.simplePath=h,c.identities=e.keys(re),oe=void 0,re=void 0,ie.length=0,c.applyFilter=function(e,t,n,i){for(var r=c.filters,o=void 0,s=void 0,a=void 0,l=0,d=r.length;l<d;l++){if(o=r[l],s=u(o.args,t,n),a=(i!==!1?z.apply:z.unapply)(o.name,e,s),a.stop)return a.data;a.replaceData&&(e=a.data)}return e},c.executeAll=function(){var e=c.execute.apply(this,arguments);return e=c.applyFilter(e,this,arguments)},c}function u(t,n,i){return e.map(t,function(e){return e.apply(n,i)})}function l(e,t){var n=["$scope"];t=t?n.concat(t):n,t.push("return "+e+";");try{return Function.apply(Function,t)}catch(i){throw Error("Invalid expression. Generated function body: "+e)}}function d(e){return Q.test(e)&&!ee.test(e)}function h(t,n){var i=void 0;return t=e.trim(t),(i=ae[t])||(ae[t]=i=c(t,n)),i}function p(t){return e.isArrayLike(t)?t[0]:t}function f(t){return e.isArrayLike(t)?t[t.length-1]:t}function v(t,n){e.isArrayLike(t)?e.each(t,n):n(t)}function m(e,t,n,i){return n?(ue.prop(e,t,i),ue):ue.prop(e,t)}function g(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function b(e,t,n){if(he[e])return he[e];t=t||ge.style;for(var i=0,r=ve.length;i<r;i++)if(n=g(ve[i]+e),n in t)return he[e]=n;return null}function y(e){for(var t=e.offsetParent;t&&"static"===be(t,"position");)t=t.offsetParent;return t||ge}function x(e){var t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,i=n.body,r=n.documentElement,o=n.defaultView||n.parentWindow;if(!ue.inDoc(e,r))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var s=r.clientTop||i.clientTop,a=r.clientLeft||i.clientLeft,c=Math.max(o.pageYOffset||0,r.scrollTop,i.scrollTop),u=Math.max(o.pageXOffset||0,r.scrollLeft,i.scrollLeft);return{top:t.top+c-s,left:t.left+u-a}}function w(e){return e.window&&e.document?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}function C(t){return e.isNil(t)||NaN===t?"":e.isString(t)?t:t+""}function E(t,n,i,r){if(!e.isFunc(i))throw TypeError("Invalid Event Handler");var o=t[Le],s=void 0,a=!1;if(o||(t[Le]=o={}),s=o[n]){if(s.contains(i))return!1}else o[n]=s=new e.LinkedList,a=!0;return s.push({handler:i,once:r}),a}function T(e,t,n){var i=e[Le],r=i&&i[t];return!(!r||r.empty())&&(r.remove(n),r.empty())}function k(e,t){var n=e[Le];return n&&n[t]}function S(e,t,n){var i=e[Le],r=i&&i[t];return!!r&&(n?r.contains(n):!r.empty())}function D(e,t,n){var i=Fe[t];i&&i.bind&&i.bind(e,t,n)===!1||Pe(e,i?i.type||t:t,I,!!_e[t])}function A(e,t,n){var i=Fe[t];i&&i.unbind&&i.unbind(e,t,n)===!1||$e(e,i?i.type||t:t,I)}function N(e,t){Ve[e]?Ve[e]++:(D(we,e,t),Ve[e]=1)}function L(e,t){Ve[e]&&(Ve[e]--,Ve[e]||A(we,e,t))}function P(e,t,n){var i=k(e,t.type);if(i){t.currentTarget=e,t.isImmediatePropagationStopped=!1,i.each(function(i){if(n){var r=new Date;r-Be>16&&(i.handler.call(e,t),Be=r)}else i.handler.call(e,t);return i.once&&ue.off(e,t.type,i.handler),!t.isImmediatePropagationStopped})}}function $(e,t,n){if(e.disabled!==!0||"click"!==t){var i=/move|scroll/.test(t);if(Oe[t])for(;e&&e.getAttribute&&!n.cancelBubble;)P(e,n,i),e=e.parentNode;else P(e,n,i)}}function I(e){e=new Ne(e);var t=e.type,n=e.target;if(He[t]){t=He[t];var i=Fe[t];if(i&&i.fix&&i.fix(n,e)===!1)return;e.type=t,$(n,t,e)}else $(n,t,e)}function O(e){for(Re=!0;e=qe.shift();)e()}function _(e){return"_"!=e[0]&&"-"!=e[0]||(e=e[1]),e.toUpperCase()}function F(e){return e.replace(st,_)}function H(e,n,i){return t.each(n,function(t,n){e[i[n]||n]=t}),e}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t;var V=/{([^{]+)}/g,B=e.dynamicClass({constructor:function(e){this.text=e,this.index=0},nextToken:function(){var e=V.exec(this.text);if(e){var t=this.index=V.lastIndex;return{token:e[1],start:t-e[0].length,end:t}}this.index=0}}),q=new e.Configuration,R=e.dynamicClass({statics:{commentCfg:"generateComments"},constructor:function(e){this._scope=t.obj(e.scope),this.el=e.el},scope:function(){var e=this._scope;return t.proxy(e)||e},realScope:function(){return this._scope},propScope:function(n){for(var i=this.realScope(),r=void 0;(r=i.$parent)&&!e.hasOwnProp(i,n);)i=r;return t.proxy(i)||i},exprScope:function(t){return this.propScope(e.parseExpr(t)[0])},observe:function(e,n){t.on(this.exprScope(e),e,n)},unobserve:function(e,n){t.un(this.exprScope(e),e,n)},get:function(t){return e.get(this.realScope(),t)},has:function(t){return e.has(this.realScope(),t)},set:function(t,n){e.set(this.scope(),t,n)},bind:function(){throw new Error("abstract method")},unbind:function(){throw new Error("abstract method")},destroy:function(){}});q.register(R.commentCfg,!0);var M=new e.Logger("tpl","debug"),X={},z={register:function(t,n){if(X[t])throw Error("Translate["+t+"] is existing");e.isFunc(n)&&(n={transform:n}),n.type=n.type||"normal",X[t]=n,M.debug("register Translate["+n.type+":"+t+"]")},get:function(e){return X[e]},apply:function(t,n,i,r){var o=X[t],s=o&&o.type,a=o&&(r?o.restore:o.transform);return a?(e.isFunc(i)&&(i=i()),n=a.apply(o,[n].concat(i))):M.warn("Translate["+t+"]."+(r?"Restore":"Transform")+" is undefined"),{stop:"event"==s&&n===!1,data:n,replaceData:"event"!==s}},unapply:function(e,t,n){return this.apply(e,t,n,!1)}},W={esc:27,tab:9,enter:13,space:32,"delete":[8,46],up:38,left:37,right:39,down:40},Y={key:function(e){for(var t=e.which,n=void 0,i=1,r=arguments.length;i<r;i++)if(n=arguments[i],t==(W[n]||n))return!0;return!1},stop:function(e){e.stopPropagation()},prevent:function(e){e.preventDefault()},self:function(e){return e.target===e.currentTarget}};e.each(Y,function(e,t){z.register(t,{type:"event",transform:e})});var j={json:{transform:function(e,t){return"string"==typeof e?e:JSON.stringify(e,null,Number(t)||2)},restore:function(e){try{return JSON.parse(e)}catch(t){return e}}},trim:{transform:e.trim,restore:e.trim},capitalize:function(t){return e.isString(t)?t.charAt(0).toUpperCase()+t.slice(1):t},uppercase:function(t){return e.isString(t)?t.toUpperCase():t},lowercase:function(t){return e.isString(t)?t.toLowerCase():t},currency:function(e,t){if(e=parseFloat(e),!isFinite(e)||!e&&0!==e)return"";t=null!=t?t:"$";var n=Math.abs(e).toFixed(2),i=n.slice(0,-3),r=i.length%3,o=r>0?i.slice(0,r)+(i.length>3?",":""):"",s=n.slice(-3),a=e<0?"-":"";return a+t+o+i.slice(r).replace(digitsRE,"$1,")+s},plural:{transform:function(t,n){return n&&e.isString(t)?e.plural(t):t},restore:function(t){return e.singular(t)}},singular:{transform:function(t,n){return n&&e.isString(t)?e.singular(t):t},restore:function(t){return e.plural(t)}},unit:{transform:function(t,n,i,r){if(r!==!1&&1!=t&&0!=t&&(n=e.plural(n)),i)return i?e.format(i,t,n):t+n},restore:function(t,n,i){var r=new RegExp("("+n+"|"+e.plural(n));return e.trim(t.replace(r,""))}},format:{transform:function(t,n){return e.format(n,t)}}};e.each(j,function(e,t){z.register(t,e)});var U=e.reverseConvert("Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat,$scope".split(","),function(){return!0}),K=/\s/g,Z=/\n/g,G=/[\{,]\s*[\w\$_]+\s*:|('(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"|`(?:[^`\\]|\\.)*\$\{|\}(?:[^`\\]|\\.)*`|`(?:[^`\\]|\\.)*`)|new |typeof |void |(\|\|)/g,J=/"(\d+)"/g,Q=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/,ee=/^(?:true|false)$/,te=/[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*[^\w$\.]/g,ne=/^[A-Za-z_$][\w$]*/,ie=[],re=void 0,oe=void 0,se=void 0,ae={},ce="string"==typeof document.createElement("div").textContent?"textContent":"innerText",ue={W3C:!!window.dispatchEvent,inDoc:function(e,t){if(t=t||document.documentElement,t.contains)return t.contains(e);try{for(;e=e.parentNode;)if(e===t)return!0}catch(n){}return!1},query:function(t,n){return e.isString(t)?n?document.querySelectorAll(t):document.querySelector(t):t},cloneNode:function(t,n){function i(e){return e.cloneNode(n!==!1)}return e.isArrayLike(t)?e.map(t,i):i(t)},parent:function(e){return p(e).parentNode},next:function(e,t){return e=f(e),t?e.nextSibling:e.nextElementSibling},prev:function(e,t){return e=p(e),t?e.previousSibling:e.previousElementSibling},children:function(e,t){return e=p(e),t?e.childNodes:e.children},remove:function(e){return v(e,function(e){var t=e.parentNode;t&&t.removeChild(e)}),ue},before:function(e,t){t=p(t);var n=t.parentNode;return v(e,function(e){n.insertBefore(e,t)}),ue},after:function(e,t){t=f(t);var n=t.parentNode;return v(e,n.lastChild===t?function(e){n.insertBefore(e,t)}:function(){var e=t.nextSibling;return function(t){n.insertBefore(t,e)}}()),ue},append:function(e,t){return e=p(e),v(t,function(t){e.appendChild(t)}),ue},prepend:function(e,t){return e.firstChild?ue.before(t,t.firstChild):ue.append(e,t),ue},replace:function(e,t){var n=e.parentNode;n.replaceChild(t,e)},html:function(e,t){return arguments.length>1?e.innerHTML=t:e.innerHTML},outerHtml:function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},text:function(e,t){return 3==e.nodeType?arguments.length>1?e.data=t:e.data:arguments.length>1?e[ce]=t:e[ce]},focus:function(e){return e.focus(),ue}};document.querySelectorAll||(document.querySelectorAll=function(e){var t=document,n=t.documentElement.firstChild,i=t.createElement("STYLE");if(n.appendChild(i),t.__qsaels=[],i.styleSheet)i.styleSheet.cssText=e+"{x:expression(document.__qsaels.push(this))}";else{var r=document.createTextNode(e+"{x:expression(document.__qsaels.push(this))}");i.appendChild(r)}return window.scrollBy(0,0),t.__qsaels}),document.querySelector||(document.querySelector=function(e){var t=document.querySelectorAll(e);return t.length?t[0]:null});var le=/^(?:input|select|textarea|button|object)$/i,de=/^(?:a|area)$/i;e.assign(ue,{prop:function(e,t,n){t=ue.propFix[t]||t;var i=ue.propHooks[t];return 2==arguments.length?i&&i.get?i.get(e,t):e[t]:(i&&i.set?i.set(e,t,n):e[t]=n,ue)},attr:function(e,t,n){return 2==arguments.length?e.getAttribute(t):(e.setAttribute(t,n),ue)},removeAttr:function(e,t){return e.removeAttribute(t),ue},checked:function(e,t){return m(e,"checked",arguments.length>1,t)},"class":function(e,t){return m(e,"class",arguments.length>1,t)},addClass:function(t,n){if(t.classList)t.classList.add(n);else{var i=" "+ue.prop(t,"class")+" ";i.indexOf(" "+n+" ")===-1&&ue["class"](t,e.trim(i+n))}return ue},removeClass:function(t,n){return t.classList?t.classList.remove(n):ue["class"](t,e.trim((" "+ue.prop(t,"class")+" ").replace(new RegExp(" "+n+" ","g"),""))),ue},style:function(e,t){return m(e,"style",arguments.length>1,t)},propHooks:{tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex");return t&&t.specified?parseInt(t.value,10):le.test(e.nodeName)||de.test(e.nodeName)&&e.href?0:void 0}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"}}),e.assign(ue,{css:function(e,t,n){var i=/[_-]/.test(t)?g(t):t,r=void 0;if(t=b(i)||i,r=pe[i]||fe,2==arguments.length){var o=n,s=void 0;return"background"===t&&(t="backgroundColor"),n=r.get(e,t),o!==!1&&isFinite(s=parseFloat(n))?s:n}return n||0===n?(isFinite(n)&&!me[i]&&(n+="px"),r.set(e,t,n)):e.style[t]="",ue},position:function(e){var t=void 0,n=void 0,i={top:0,left:0};return"fixed"===ue.css(e,"position")?n=e.getBoundingClientRect():(t=y(e),n=x(e),"HTML"!==t.tagName&&(i=x(t)),i.top+=ue.css(t,"borderTopWidth",!0),i.left+=ue.css(t,"borderLeftWidth",!0),i.top-=ue.scrollTop(t),i.left-=ue.scrollLeft(t)),{top:n.top-i.top-ue.css(e,"marginTop",!0),left:n.left-i.left-ue.css(e,"marginLeft",!0)}},scrollTop:function(e,t){var n=w(e);return 1==arguments.length?(n?"scrollTop"in n?n.scrollTop:ge.pageYOffset:e.pageYOffset)||0:(n?n.scrollTo(ue.scrollLeft(e),t):e.pageYOffset=t,ue)},scrollLeft:function(e,t){var n=w(e);return 1==arguments.length?(n?"scrollLeft"in n?n.scrollLeft:ge.pageXOffset:e.pageXOffset)||0:(n?n.scrollTo(t,ue.scrollTop(e)):e.pageXOffset=t,ue)},scroll:function(e,t,n){var i=w(e);return 1==arguments.length?{left:ue.scrollLeft(e),top:ue.scrollTop(e)}:(i?i.scrollTo(t,n):(e.pageXOffset=t,e.pageYOffset=n),ue)}});var he=ue.cssFix={"float":ue.W3C?"cssFloat":"styleFloat"},pe=ue.cssHooks={},fe={},ve=["","-webkit-","-o-","-moz-","-ms-"],me={animationIterationCount:!0,columnCount:!0,order:!0,flex:!0,flexGrow:!0,flexShrink:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},ge=document.documentElement,be=ue.css;fe.set=function(e,t,n){try{e.style[t]=n}catch(i){}};var ye=void 0;window.getComputedStyle?(ye=fe.get=function(e,t){var n=void 0,i=getComputedStyle(e,null);return i&&(n="filter"===t?i.getPropertyValue(t):i[t],""===n&&(n=e.style[t])),n},pe.opacity={get:function(e,t){var n=ye(e,t);return""===n?"1":ret}}):!function(){var e=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,t=/^(top|right|bottom|left)$/,n=/alpha\([^)]*\)/i,i=!!window.XDomainRequest,r="DXImageTransform.Microsoft.Alpha",o={thin:i?"1px":"2px",medium:i?"3px":"4px",thick:i?"5px":"6px"};ye=fe.get=function(n,i){var r=n.currentStyle,s=r[i];if(e.test(s)&&!t.test(s)){var a=n.style,c=a.left,u=n.runtimeStyle.left;n.runtimeStyle.left=r.left,a.left="fontSize"===i?"1em":s||0,s=a.pixelLeft+"px",a.left=c,n.runtimeStyle.left=u}return"medium"===s&&(i=i.replace("Width","Style"),"none"===r[i]&&(s="0px")),""===s?"auto":o[s]||s},pe.opacity={get:function(e,t){var n=e.filters.alpha||e.filters[r],i=n&&n.enabled?n.opacity:100;return i/100+""},set:function(e,t,i){var r=e.style,o=isFinite(i)&&i<=1?"alpha(opacity="+100*i+")":"",s=r.filter||"";r.zoom=1,r.filter=(n.test(s)?s.replace(n,o):s+" "+o).trim(),r.filter||r.removeAttribute("filter")}}}(),e.each(["top","left"],function(e){pe[e]={get:function(e,t){var n=ye(e,t);return/px$/.test(n)?n:ue.position(e)[t]+"px"}}}),e.each(["Width","Height"],function(e){function t(e,t){var n=void 0;return n=e[i],2===t?n+be(e,"margin"+r[0],!0)+be(e,"margin"+r[1],!0):(t<0&&(n=n-be(e,"border"+r[0]+"Width",!0)-be(e,"border"+r[1]+"Width",!0)),t===-4&&(n=n-be(e,"padding"+r[0],!0)-be(e,"padding"+r[1],!0)),n)}var n=e.toLowerCase(),i="offset"+e,r="Width"==e?["Left","Right"]:["Top","Bottom"];ue[n]=function(e){return t(e,-4)},ue["inner"+e]=function(e){return t(e,-2)},ue["outer"+e]=function(e,n){return t(e,n===!0?2:0)}}),e.assign(ue,{val:function(e,t){var n=ue.valHooks[e.type||e.tagName.toLowerCase()];return 1==arguments.length?n&&n.get?n.get(e):e.value||"":(n&&n.set?n.set(e,t):e.value=C(t),ue)},valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t="select-one"==e.type,n=e.selectedIndex;if(n<0)return t?void 0:[];for(var i=e.options,r=void 0,o=t?void 0:[],s=0,a=i.length;s<a;s++)if(r=i[s],r.selected||s==n){if(t)return ue.val(r);o.push(ue.val(r))}return o},set:function(t,n){var i="select-one"==t.type,r=t.options,o=void 0,s=void 0,a=void 0,c=void 0,u=void 0;if(t.selectedIndex=-1,e.isArray(n)||(n=e.isNil(n)?[]:[n]),c=n.length){i&&(c=n.length=1);var l=e.reverseConvert(n,function(){return!1}),d=0;for(s=0,a=r.length;s<a&&(o=r[s],u=ue.val(o),!e.isBoolean(l[u])||(l[u]=o.selected=!0,++d!==c));s++)n=e.keys(l,function(e){return e===!0})}return i?n[0]:n}}}});var xe=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},we=document.documentElement,Ce=e.assign(ue,{hasListen:function(e,t,n){return S(e,t,n)},on:function(e,t,n,i){return E(e,t,n,i===!0)&&(Oe[t]?N(t,n):D(e,t,n)),ue},once:function(e,t,n){return ue.on(e,t,n,!0)},off:function(e,t,n){return T(e,t,n)&&(Oe[t]?L(t,n):A(e,t,n)),ue},dispatchEvent:function(t,n,i){var r=void 0;return document.createEvent?(r=document.createEvent("Events"),r.initEvent(n,!0,!0,i),e.assign(r,i),t.dispatchEvent(r)):ue.inDoc(t)&&(r=document.createEventObject(),e.assign(r,i),t.fireEvent("on"+n,r)),r}}),Ee=/^(?:mouse|contextmenu|drag)|click/,Te=/^key/,ke=["altKey","bubbles","cancelable","ctrlKey","currentTarget","propertyName","eventPhase","metaKey","relatedTarget","shiftKey","target","view","which"],Se={},De={props:["char","charCode","key","keyCode"],fix:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode)}},Ae={props:["button","buttons","clientX","clientY","offsetX","offsetY","pageX","pageY","screenX","screenY","toElement"],fix:function(e,t){var n,i,r,o=t.button;null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||document,i=n.documentElement,r=n.body,e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0)}},Ne=function(){function e(t){xe(this,e);var n=t.type,i=Se[n],r=void 0,o=void 0;for(this.originalEvent=t,this.type=t.type,this.returnValue=!(t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault()),this.timeStamp=t&&t.timeStamp||new Date+0,r=ke.length;r--;)o=ke[r],this[o]=t[o];if(i||(Se[n]=i=Ee.test(n)?Ae:Te.test(n)?De:{}),i.props){var s=i.props;for(r=s.length;r--;)o=s[r],this[o]=t[o]}this.target||(this.target=t.srcElement||document),3==this.target.nodeType&&(this.target=this.target.parentNode),i.fix&&i.fix(this,t)}return e.prototype.preventDefault=function(){var e=this.originalEvent;this.returnValue=!1,e&&(e.returnValue=!1,e.preventDefault&&e.preventDefault())},e.prototype.stopPropagation=function(){var e=this.originalEvent;this.cancelBubble=!0,e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},e.prototype.stopImmediatePropagation=function(){var e=this.originalEvent;this.isImmediatePropagationStopped=!0,e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()},e}(),Le="__LISTEN__",Pe=ue.W3C?function(e,t,n,i){e.addEventListener(t,n,i)}:function(e,t,n){e.attachEvent("on"+t,n)},$e=ue.W3C?function(e,t,n){e.removeEventListener(t,n)}:function(e,t,n){e.detachEvent("on"+t,n)},Ie=["click","dblclick","keydown","keypress","keyup","mousedown","mousemove","mouseup","mouseover","mouseout","wheel","mousewheel","input","change","beforeinput","compositionstart","compositionupdate","compositionend","select","cut","copy","paste","beforecut","beforecopy","beforepaste","focusin","focusout","DOMFocusIn","DOMFocusOut","DOMActivate","dragend","datasetchanged"],Oe={},_e={focus:!0,blur:!0},Fe={},He={},Ve={};e.each(Ie,function(e){Oe[e]=!0}),ue.W3C||(delete Oe.change,delete Oe.select);var Be=new Date;"onmouseenter"in we||e.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){Fe[e]={type:t,fix:function(e,t,n){var i=t.relatedTarget;return!i||i!==e&&!(16&e.compareDocumentPosition(i))}}}),e.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!Fe.animationend&&(Fe.animationend={type:t})}),"oninput"in document.createElement("input")?navigator.userAgent.indexOf("MSIE 9")!==-1&&(Fe.input={type:"input",fix:function(e){e.oldValue=e.value}},document.addEventListener("selectionchange",function(e){var t=document.activeElement;if("TEXTAREA"===t.tagName||"INPUT"===t.tagName&&"text"===t.type){if(t.value==t.oldValue)return;t.oldValue=t.value,S(t,"input")&&(e=new Ne(e),e.type="input",$(t,"input",e))}})):(delete Oe.input,Fe.input={type:"propertychange",fix:function(e,t){return"value"==t.propertyName}},Fe.change={bind:function(e){if("checkbox"==e.type||"radio"==e.type)return e.$onchange||(e.$onchange=function(t){t.type="change",$(e,"change",t)},ue.on(e,"click",e.$onchange)),!1},unbind:function(e){if("checkbox"==e.type||"radio"==e.type)return ue.off(e,"click",e.$onchange),!1}}),void 0===document.onmousewheel&&!function(){var e=document.onwheel?"wheel":"DOMMouseScroll",t="wheel"===e?"deltaY":"detail";Fe.mousewheel={type:e,fix:function(e,n){return n.wheelDeltaY=n.wheelDelta=n[t]>0?-120:120,n.wheelDeltaX=0,!0}}}(),e.each(Fe,function(e,t){He[e.type||t]=t});var qe=[],Re=void 0,Me=document.documentElement;"complete"===document.readyState?setTimeout(O):document.addEventListener?document.addEventListener("DOMContentLoaded",O):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&O()}),Me.doScroll&&null===window.frameElement&&window.external&&!function(){var e=function(){try{Me.doScroll("left"),O()}catch(t){setTimeout(e)}};e()}()),Ce.on(window,"load",O),Ce.ready=function(e){return Re?e():qe.push(e),Ce};var Xe=["$el"],ze=e.dynamicClass({extend:R,constructor:function(e){this["super"](arguments),this.expr=h(e.expression,Xe),q.get(R.commentCfg)&&(this.comment=document.createComment("Text Binding "+this.expr),ue.before(this.comment,this.el)),this.observeHandler=this.observeHandler.bind(this)},value:function(){return this.expr.executeAll.call(this,this.scope(),this.el)},bind:function(){var t=this;e.each(this.expr.identities,function(e){t.observe(e,t.observeHandler)}),this.update(this.value())},unbind:function(){var t=this;e.each(this.expr.identities,function(e){t.unobserve(e,t.observeHandler)})},observeHandler:function(e,t){this.expr.simplePath?this.update(this.expr.applyFilter(t,this,[this.scope(),this.el])):this.update(this.value())},update:function(t){e.isNil(t)&&(t=""),t!==ue.text(this.el)&&ue.text(this.el,t)}}),We={},Ye=e.dynamicClass({extend:R,independent:!1,block:!1,priority:5,constructor:function(e){this["super"](arguments),this.expr=e.expression,this.attr=e.attr,this.children=e.children,this.domParser=e.domParser,q.get(R.commentCfg)&&(this.comment=document.createComment("Directive["+this.attr+"]: "+this.expr),ue.before(this.comment,this.el))},bindChildren:function(){this.children&&e.each(this.children,function(e){e.bind()})},bind:function(){this.bindChildren()},unbindChildren:function(){this.children&&e.each(this.children,function(e){e.unbind()})},unbind:function(){this.unbindChildren()},statics:{getPriority:function(e){return e.prototype.priority},isBlock:function(e){return e.prototype.block},isIndependent:function(e){return e.prototype.independent},getDirective:function(e){return We[e.toLowerCase()]},isDirective:function(t){return e.isExtendOf(t,Ye)},register:function(t,n){var i=void 0;if(t=t.toLowerCase(),e.isObject(n))n.extend=n.extend||Ye,i=e.dynamicClass(n);else{if(!e.isFunc(n)||!e.isExtendOf(n,Ye))throw TypeError("Invalid Directive["+t+"] "+n);i=n}if(t in We)throw new Error("Directive["+t+"] is existing");return We[t]=i,M.debug("register Directive[%s]",t),i}}}),je=e.dynamicClass({extend:R,constructor:function(e){this["super"](arguments),this.directives=e.directives,this.children=e.children,this.directiveCount=e.directives.length,this.bindedCount=0,this.bindedChildren=!1,this._bind=this._bind.bind(this)},_bind:function(){var t=this.bindedCount;if(t<this.directiveCount){var n=this.directives[t],i=n.bind();this.bindedCount++,i&&i instanceof e.YieId?i.then(this._bind):this._bind()}else this.children&&(e.each(this.children,function(e){e.bind()}),this.bindedChildren=!0)},bind:function(){this._bind()},unbind:function(){var t=this.directives,n=this.bindedCount;for(this.bindedChildren&&(e.each(this.children,function(e){e.unbind()}),this.bindedChildren=!1);n--;)t[n].unbind();this.bindedCount=0}});q.register("directiveReg",/^tpl-/,[RegExp]);var Ue=e.dynamicClass({constructor:function(){this.reg=q.get("directiveReg")},isDirective:function(e){return this.reg.test(e)},getDirective:function(e){return Ye.getDirective(e.replace(this.reg,""))}}),Ke=e.dynamicClass({constructor:function(e,t){this.el=e,this.bindings=t},before:function(e,t){return t!==!1&&this.bind(),ue.before(this.el,ue.query(e)),this},after:function(e,t){return t!==!1&&this.bind(),ue.after(this.el,ue.query(e)),this},prependTo:function(e,t){return t!==!1&&this.bind(),ue.prepend(ue.query(e),this.el),this},appendTo:function(e,t){return t!==!1&&this.bind(),ue.append(ue.query(e),this.el),this},remove:function(e){ue.remove(this.el),e!==!1&&this.unbind()},bind:function(){return this.binded||(e.each(this.bindings,function(e){e.bind()}),this.binded=!0),this},unbind:function(){return this.binded&&(e.each(this.bindings,function(e){e.unbind()}),this.binded=!1),this},destroy:function(){this.binded&&e.each(this.bindings,function(e){e.unbind(),e.destroy()}),ue.remove(this.el),this.bindings=void 0,this.el=void 0}});q.register("directiveParser",new Ue,[Ue]),q.register("TextParser",B,B,!0);var Ze=1,Ge=2,Je=3,Qe=e.dynamicClass({constructor:function(e,t){this.el=this.parseEl(e,t),this.directiveParser=q.get("directiveParser"),this.TextParser=q.get("TextParser"),this.parse()},complie:function(t){var n=ue.cloneNode(this.el),i=document.createDocumentFragment();return ue.append(i,n),new Ke(e.map(i.childNodes,function(e){return e}),this.parseBindings(this.bindings,t,this.parseEls(n)))},parseBindings:function(t,n,i){var r=this;return e.map(t,function(t){var o=t.type,s={el:i[t.index],scope:n};if(o===Ze)return s.expression=t.expression,new ze(s);var a=void 0;return o===Ge?(a=t.directive,s.expression=t.expression,s.attr=t.attr,s.domParser=t.domParser,s.independent=t.independent):(a=je,s.directives=e.map(t.directives,function(e){return new e.directive({el:s.el,scope:n,expression:e.expression,attr:e.attr})})),s.block=t.block,s.children=t.children?r.parseBindings(t.children||[],n,i):void 0,new a(s)})},parseEls:function(e){var t=0,n=this.elStatus;return this.eachDom(e,[],function(e,i){return i.push(e),n[t++]&&i},function(e,n){n.push(e),t++})},parseEl:function(t,n){if(e.isString(t)){if(t=e.trim(t),"<"==t.charAt(0)){var i=document.createElement("div");ue.html(i,t),t=i.childNodes}t=ue.query(t)}else n&&(t=ue.cloneNode(t));return t},eachDom:function(t,n,i,r){var o=this;return e.isArrayLike(t)?e.each(t,function(e){o._eachDom(e,n,i,r)}):this._eachDom(t,n,i,r),n},_eachDom:function(t,n,i,r){var o=this;switch(t.nodeType){case 1:(n=i(t,n))&&e.each(e.map(t.childNodes,function(e){return e}),function(e){o._eachDom(e,n,i,r)});break;case 3:r(t,n)}},parse:function(){function t(e,t){return e&&(i.push(t),r++),e}var n=this,i=[],r=0,o=this.TextParser,s=this.directiveParser;this.elStatus=i,this.bindings=this.eachDom(this.el,[],function(n,i){var o=[],a=!1,c=!1,u=void 0;if(e.each(n.attributes,function(e){var t=e.name,n=void 0;if(s.isDirective(t)){if(!(n=s.getDirective(t)))return void M.warn("Directive["+t+"] is undefined");var i={type:Ge,index:r,expression:e.value,directive:n,attr:t,block:Ye.isBlock(n),independent:Ye.isIndependent(n)};if(i.independent)return i.block=a=c=!0,o=[i],!1;i.block&&(a=!0),o.push(i)}}),!o.length)return t(n,!0),i;if(u=1==o.length?o[0]:{type:Je,index:r,directives:o.sort(function(e,t){return Ye.getPriority(t.directive)-Ye.getPriority(e.directive)||0}),block:a,independent:c},u.children=!a&&[],i.push(u),c){var l=ue.cloneNode(n,!1);ue.removeAttr(l,o[0].attr),ue.append(l,e.map(n.childNodes,function(e){return e})),u.domParser=new Qe(l,(!1))}return t(n,!a),u.children},function(e,i){var s=ue.text(e),a=new o(s),c=void 0,u=0,l=e.parentNode;for(l.childNodes.length;c=a.nextToken();)u<c.start&&t(n.insertNotBlankText(s.substring(u,c.start),e),!1),i.push({type:Ze,index:r,expression:c.token}),t(n.insertText("binding",e),!1),u=c.end;u?(t(n.insertNotBlankText(s.substr(u),e),!1),ue.remove(e)):t(e,!1)})},insertNotBlankText:function(e,t){return e?this.insertText(e,t):void 0},insertText:function(e,t){var n=document.createTextNode(e);return ue.before(n,t),n}}),et=0,tt={},nt=e.dynamicClass({statics:{get:function(e){return tt[e]},DomParser:Qe,DirectiveParser:Ue,TextParser:B},constructor:function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.id=n.id||et++,e.hasOwnProp(tt,this.id))throw new Error("Existing Template["+this.id+"]");this.parser=new Qe(t),tt[this.id]=this},complie:function(e){return this.parser.complie(e)}}),it=/^\s*([\s\S]+)\s+in\s+([\S]+)(\s+track\s+by\s+([\S]+))?\s*$/,rt=/^(\(\s*([^,\s]+)(\s*,\s*([\S]+))?\s*\))|([^,\s]+)(\s*,\s*([\S]+))?$/,ot=Ye.register("each",e.dynamicClass({extend:Ye,independent:!0,block:!0,priority:10,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this);var e=this.expr.match(it);if(!e)throw Error("Invalid Expression["+this.expr+"] on Each Directive");this.scopeExpr=e[2],this.indexExpr=e[4];var t=e[1].match(rt);if(!t)throw Error("Invalid Expression["+e[1]+"] on Each Directive");this.valueAlias=t[2]||t[5],this.keyAlias=t[4]||t[7],this.begin=document.createComment("each begin"),this.end=document.createComment("each end"),ue.replace(this.el,this.begin),ue.after(this.end,this.begin),this.el=void 0,this.version=1},update:function(n){var i=this,r=this.domParser,o=this.realScope(),s=(this.begin,this.end),a=this.indexExpr,c=this.used,u=this.version++,l=this.used={},d=e.map(n,function(n,i){var r=a?e.get(n,a):i,o=c&&c[r],s=void 0;return o&&o.version===u&&(o=void 0),s=o||{index:r},s.version=u,s.data=t.proxy(n),l[r]=s,s}),h=[],p=document.createDocumentFragment();c&&tpl.each(c,function(e){e.version!=u&&h.push(e),e.tpl.remove(!1)}),tpl.each(d,function(e){if(!e.scope){var t=h.pop();t?(e.scope=t.scope,e.tpl=t.tpl,i.initScope(e.scope,e.data,e.index)):(e.scope=i.createScope(o,e.data,e.index),e.tpl=r.complie(e.scope))}ue.append(p,e.tpl.el)}),tpl.before(p,s),tpl.each(d,function(e){return e.tpl.bind()}),tpl.each(h,function(e){return e.tpl.destroy()})},createScope:function(t,n,i){var r=e.create(t);return r.$parent=t,r.$eachContext=this,this.initScope(r,n,i,!0),r},initScope:function(e,n,i,r){r||(e=t.proxy(e)),e[this.valueAlias]=n,this.keyAlias&&(e[this.keyAlias]=i)},bind:function(){this.observe(this.scopeExpr,this.observeHandler),this.update(this.target())},unbind:function(){this.unobserve(this.scopeExpr,this.observeHandler)},target:function(){return this.get(this.scopeExpr)},observeHandler:function(e,t){this.update(t)}})),st=/(^[a-z])|([_-][a-zA-Z])/g,at=e.dynamicClass({constructor:function(){this.doned=!1,this.thens=[]},then:function(e){this.doned?e():this.thens.push(e)},done:function(){if(!this.doned){for(var e=this.thens,t=0,n=e.length;t<n;t++)e[t]();this.doned=!0}},isDone:function(){return this.doned}}),ct=Object.freeze({hump:F,YieId:at}),ut=["$el","$event"],lt=e.dynamicClass({extend:Ye,constructor:function(){this["super"](arguments),this.handler=this.handler.bind(this),this.expression=h(this.expr,ut)},handler:function(t){t.stopPropagation();var n=this.scope(),i=this.expression;if(this.expression.applyFilter(t,this,[n,this.el,t])!==!1){var r=i.execute.call(this,n,this.el,t);if(i.simplePath)if(e.isFunc(r)){var o=this.propScope(i.path[0]);r.call(o,n,this.el,t,o)}else M.warn("Invalid Event Handler:%s",this.expr,r)}},bind:function(){ue.on(this.el,this.eventType,this.handler),this["super"](arguments)},unbind:function(){this["super"](arguments),ue.off(this.el,this.eventType,this.handler)}}),dt=["blur","change","click","dblclick","error","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","resize","scroll","select","submit","unload",{
name:"oninput",eventType:"input propertychange"}],ht=e.assign(e.convert(dt,function(t){var n=e.isObject(t)?t.name:t;return F(n+"Directive")},function(t){e.isObject(t)||(t={eventType:t});var n=t.name||"on"+t.eventType;return t.extend=lt,Ye.register(n,t)}),{EventDirective:lt}),pt=["$el"],ft=e.dynamicClass({extend:Ye,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this),this.expression=h(this.expr,pt)},realValue:function(){return this.expression.execute.call(this,this.scope(),this.el)},value:function(){return this.expression.executeAll.call(this,this.scope(),this.el)},listen:function(){var t=this;e.each(this.expression.identities,function(e){t.observe(e,t.observeHandler)}),this.update(this.value())},unlisten:function(){var t=this;e.each(this.expression.identities,function(e){t.unobserve(e,t.observeHandler)})},bind:function(){this.listen(),this["super"](arguments)},unbind:function(){this["super"](arguments),this.unlisten()},blankValue:function(t){return 0==arguments.length&&(t=this.value()),e.isNil(t)?"":t},observeHandler:function(e,t){this.expression.simplePath?this.update(this.expression.applyFilter(t,this,[this.scope(),this.el])):this.update(this.value())},update:function(e){throw"abstract method"}}),vt="change",mt="input",gt="SELECT",bt="INPUT",yt="TEXTAREA",xt="radio",wt="checkbox",Ct={text:{block:!0,update:function(e){ue.text(this.el,this.blankValue(e))}},html:{block:!0,update:function(e){ue.html(this.el,this.blankValue(e))}},"class":{update:function(t){t&&"string"==typeof t?this.handleArray(e.trim(t).split(/\s+/)):t instanceof Array?this.handleArray(t):t&&"object"==typeof t?this.handleObject(t):this.cleanup()},handleObject:function(e){this.cleanup(e,!1);var t=this.prevKeys=[],n=this.el;for(var i in e)e[i]?(ue.addClass(n,i),t.push(i)):ue.removeClass(n,i)},handleArray:function(t){this.cleanup(t,!0);var n=this.prevKeys=[],i=this.el;e.each(t,function(e){e&&(n.push(e),ue.addClass(i,e))})},cleanup:function(t,n){var i=this.prevKeys;if(i)for(var r=i.length,o=this.el;r--;){var s=i[r];t&&(n?e.indexOf(t,s)!=-1:e.hasOwnProp(t,s))||ue.removeClass(o,s)}}},style:{update:function(t){t&&e.isString(t)?ue.style(this.el,t):t&&e.isObject(t)&&this.handleObject(t)},handleObject:function(t){this.cleanup(t);var n=(this.prevKeys=[],this.el);e.each(t,function(e,t){ue.css(n,t,e)})}},show:{update:function(e){ue.css(this.el,"display",e?"":"none")}},hide:{update:function(e){ue.css(this.el,"display",e?"none":"")}},value:{update:function(e){ue.val(this.el,this.blankValue(e))}},"if":{priority:9,bind:function(){return this.yieId=new at,this.listen(),this.yieId},unbind:function(){this.yieId||this.unbindChildren(),this.unlisten()},update:function(e){e?(this.yieId&&(this.yieId.done(),this.yieId=void 0,this.bindChildren()),ue.css(this.el,"display","")):ue.css(this.el,"display","none")}},checked:{update:function(t){e.isArray(t)?ue.checked(this.el,e.indexOf(t,ue.val(this.el))):ue.checked(this.el,!!t)}},selected:{update:function(e){}},focus:{update:function(e){e&&ue.focus(this.el)}},input:{priority:4,constructor:function(){if(this["super"](arguments),!this.expression.simplePath)throw TypeError("Invalid Expression["+this.expression.expr+"] on InputDirective");this.onChange=this.onChange.bind(this);var e=this.tag=this.el.tagName;switch(e){case gt:this.event=vt;break;case bt:var t=this.type=this.el.type;this.event=t==xt||t==wt?vt:mt;break;case yt:throw TypeError("Directive[input] not support "+e);default:throw TypeError("Directive[input] not support "+e)}},bind:function(){ue.on(this.el,this.event,this.onChange),this["super"]()},unbind:function(){this["super"](),ue.off(this.el,this.event,this.onChange)},setRealValue:function(e){this.set(this.expression.path,e)},setValue:function(e){this.setRealValue(this.expression.applyFilter(e,this,[this.scope(),this.el],!1))},onChange:function(e){var t=this.elVal(),n=this.val;t!=n&&this.setValue(t),e.stopPropagation()},update:function(e){var t=this.blankValue(e);t!=this.val&&this.elVal(this.val=t)},elVal:function(e){var t=this.tag;switch(t){case gt:break;case bt:var n=this.type;if(n==xt||n==wt){if(0==arguments.length)return ue.checked(this.el)?ue.val(this.el):void 0;var i=void 0;i=e==ue.val(this.el),ue.checked(this.el)!=i&&ue.checked(this.el,i)}else{if(0==arguments.length)return ue.val(this.el);e!=ue.val(this.el)&&ue.val(this.el,e)}break;case yt:throw TypeError("Directive[input] not support "+t);default:throw TypeError("Directive[input] not support "+t)}}}},Et=e.assign(e.convert(Ct,function(e,t){return F(t+"Directive")},function(e,t){return e.extend=ft,Ye.register(t,e)}),{SimpleDirective:ft}),Tt=e.assign({EachDirective:ot},ht,Et);e.assign(nt,{translate:z,expression:h,Directive:Ye,directives:Tt,config:q,init:function(e){t.init(e),q.config(e)}},ue,ct);var kt=function(e,t){return new nt(e,t)};return e.assign(kt,nt,{Template:nt,utility:e,observer:t}),H(e.assign(kt,e),t.observer,{on:"observe",un:"unobserve",hasListen:"isObserved"}),kt});
//# sourceMappingURL=tpl.min.js.map