!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("observer")):"function"==typeof define&&define.amd?define("tpl",["observer"],t):e.tpl=t(e.observer)}(this,function(e){function t(e){return"_"!=e[0]&&"-"!=e[0]||(e=e[1]),e.toUpperCase()}function n(t,n,i){return e.each(n,function(e,n){t[i[n]||n]=e}),t}function i(e,t,n,i){var r=Y[e],o=r?r.type:void 0,s=void 0;return s=r?i!==!1?r.apply:r.unapply:void 0,s?(V.isFunc(n)&&(n=n()),t=s.apply(r,[t].concat(n))):X.warn("Translate["+e+"]."+(i!==!1?"apply":"unapply")+" is undefined"),{stop:"event"==o&&t===!1,data:t,replaceData:"event"!==o}}function r(e,t){var n=oe.length;return oe[n]=t?e.replace(J,"\\n"):e,'"'+n+'"'}function o(e,t){return oe[t]}function s(e,t,n){var i=e.length,r=e.charAt(i-1),o=e.slice(0,i-1),s=o.match(re)[0];return Z[s]||ce[s]?e:"$context"===s?e.replace(re,ae):"("==r?(r=t+i==n.length||")"==n.charAt(t+i)?"":",",ae="this.propScope('"+s+"')","$scope."+o+".call("+ae+r):(se[o]=!0,"$scope."+o+r)}function c(e){return ae=void 0,(e+" ").replace(ie,s).replace(ee,o)}function a(e,t){for(var n=0,i=e.length;n<i;n++)e[n]=d(c(e[n]),t);return e}function u(e,t){if(!e||!e.length)return[];for(var n=[],i=void 0,r=void 0,s=0,c=e.length;s<c;s++)(i=V.trim(e[s]))&&(r=i.replace(/,?\s+/g,",").split(","),n.push({name:r.shift().replace(ee,o),args:a(r,t)}));return n}function l(e,t){var n=void 0,i=void 0,s=p(e);return se={},ce=t?V.reverseConvert(t,function(){return!0}):{},s||(n=e.replace(Q,r).split("|"),e=n.shift().replace(G,""),s=p(e)),s?(e=e.replace(ee,o),se[e]=!0,i={execute:d("$scope."+e,t),path:V.parseExpr(e),expr:e}):i={execute:d(c(e),t),expr:e},i.filters=u(n,t),i.simplePath=s,i.identities=V.keys(se),ce=void 0,se=void 0,oe.length=0,i.applyFilter=function(e,t,n,r){for(var o=i.filters,s=void 0,c=void 0,a=void 0,u=0,l=o.length;u<l;u++){if(s=o[u],c=h(s.args,t,n),a=(r!==!1?W.apply:W.unapply)(s.name,e,c),a.stop)return a.data;a.replaceData&&(e=a.data)}return e},i.executeAll=function(){var e=i.execute.apply(this,arguments);return e=i.applyFilter(e,this,arguments)},i}function h(e,t,n){return V.map(e,function(e){return e.apply(t,n)})}function d(e,t){var n=["$scope"];t=t?n.concat(t):n,t.push("return "+e+";");try{return Function.apply(Function,t)}catch(i){throw Error("Invalid expression. Generated function body: "+e)}}function p(e){return te.test(e)&&!ne.test(e)}function f(e,t){var n=void 0;return e=V.trim(e),(n=ue[e])||(ue[e]=n=l(e,t)),n}function v(e){return V.isArrayLike(e)?e[0]:e}function m(e){return V.isArrayLike(e)?e[e.length-1]:e}function g(e,t){V.isArrayLike(e)?V.each(e,t):t(e)}function y(e,t,n,i){return n?(he.prop(e,t,i),he):he.prop(e,t)}function b(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function x(e,t,n){if(fe[e])return fe[e];t=t||be.style;for(var i=0,r=ge.length;i<r;i++)if(n=b(ge[i]+e),n in t)return fe[e]=n;return null}function w(e){for(var t=e.offsetParent;t&&"static"===xe(t,"position");)t=t.offsetParent;return t||be}function C(e){var t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,i=n.body,r=n.documentElement,o=n.defaultView||n.parentWindow;if(!he.inDoc(e,r))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var s=r.clientTop||i.clientTop,c=r.clientLeft||i.clientLeft,a=Math.max(o.pageYOffset||0,r.scrollTop,i.scrollTop),u=Math.max(o.pageXOffset||0,r.scrollLeft,i.scrollLeft);return{top:t.top+a-s,left:t.left+u-c}}function E(e){return e.window&&e.document?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}function T(e){return V.isNil(e)||NaN===e?"":V.isString(e)?e:e+""}function k(e,t,n,i){if(!V.isFunc(n))throw TypeError("Invalid Event Handler");var r=e[Le],o=void 0;return r||(e[Le]=r={}),(o=r[t])||(r[t]=o=[]),o.push({handler:n,once:i}),1===o.length}function S(e,t,n){var i=e[Le],r=i?i[t]:void 0;if(r)for(var o=0,s=r.length;o<s;o++)if(r[o].handler===n)return r.splice(o,1),1===s;return!1}function D(e,t){var n=e[Le],i=n?n[t]:void 0;return i?i.slice():void 0}function $(e,t,n){var i=e[Le],r=i?i[t]:void 0;return!!r&&(n?V.indexOf(r,n)!=-1:!!r.length)}function A(e,t,n){var i=Ve[t];i&&i.bind&&i.bind(e,t,n)===!1||Ie(e,i?i.type||t:t,_,!!He[t])}function N(e,t,n){var i=Ve[t];i&&i.unbind&&i.unbind(e,t,n)===!1||Oe(e,i?i.type||t:t,_)}function P(e,t){qe[e]?qe[e]++:(A(Ee,e,t),qe[e]=1)}function L(e,t){qe[e]&&(qe[e]--,qe[e]||N(Ee,e,t))}function I(e,t,n){var i=D(e,t.type);if(i){t.currentTarget=e;var r=void 0,o=void 0,s=void 0;for(o=0,s=i.length;o<s&&!t.isImmediatePropagationStopped;o++){if(r=i[o],n){var c=new Date;c-Me>16&&(r.handler.call(e,t),Me=c)}else r.handler.call(e,t);r.once&&he.off(e,t.type,r.handler)}}}function O(e,t,n){if(e.disabled!==!0||"click"!==t){var i=/move|scroll/.test(t);if(Fe[t])for(;e&&e.getAttribute&&!n.cancelBubble;)I(e,n,i),e=e.parentNode;else I(e,n,i)}}function _(e){e=new Pe(e);var t=e.type,n=e.target;if(Be[t]){t=Be[t];var i=Ve[t];if(i&&i.fix&&i.fix(n,e)===!1)return;e.type=t,O(n,t,e)}else O(n,t,e)}function F(e){for(Xe=!0;e=Re.shift();)e()}e="default"in e?e["default"]:e;var H=/(^[a-z])|([_-][a-zA-Z])/g,V=n({hump:function(e){return e.replace(H,t)},YieId:e.dynamicClass({constructor:function(){this.doned=!1,this.thens=[]},then:function(e){this.doned?e():this.thens.push(e)},done:function(){if(!this.doned){for(var e=this.thens,t=0,n=e.length;t<n;t++)e[t]();this.doned=!0}},isDone:function(){return this.doned}})},e,{on:"observe",un:"unobserve",hasListen:"isObserved"}),B=/{([^{]+)}/g,q=V.dynamicClass({constructor:function(e){this.text=e,this.index=0},nextToken:function(){var e=B.exec(this.text);if(e){var t=this.index=B.lastIndex;return{token:e[1],start:t-e[0].length,end:t}}this.index=0}}),M=new V.Configuration,R=V.dynamicClass({statics:{commentCfg:"generateComments"},constructor:function(e){this._scope=V.obj(e.scope),this.el=e.el},scope:function(){var e=this._scope;return V.proxy(e)||e},realScope:function(){return this._scope},propScope:function(e){for(var t=this.realScope(),n=void 0;(n=t.$parent)&&!V.hasOwnProp(t,e);)t=n;return V.proxy(t)||t},exprScope:function(e){return this.propScope(V.parseExpr(e)[0])},observe:function(e,t){V.observe(this.exprScope(e),e,t)},unobserve:function(e,t){V.unobserve(this.exprScope(e),e,t)},get:function(e){return V.get(this.realScope(),e)},has:function(e){return V.has(this.realScope(),e)},set:function(e,t){V.set(this.scope(),e,t)},bind:function(){throw new Error("abstract method")},unbind:function(){throw new Error("abstract method")},destroy:function(){}});M.register(R.commentCfg,!0);var X=new V.Logger("tpl","debug"),z=Array.prototype.slice,Y={},W={register:function(e,t){if(Y[e])throw Error("Translate["+e+"] is existing");"function"==typeof t&&(t={apply:t}),t.type=t.type||"normal",Y[e]=t,X.debug("register Translate[%s:%s]",t.type,e)},get:function(e){return Y[e]},apply:i,unapply:function(e,t,n){return i(e,t,n,!1)}},j={esc:27,tab:9,enter:13,space:32,"delete":[8,46],up:38,left:37,right:39,down:40},U={key:function(e){for(var t=e.which,n=void 0,i=1,r=arguments.length;i<r;i++)if(n=arguments[i],t==(j[n]||n))return!0;return!1},stop:function(e){e.stopPropagation()},prevent:function(e){e.preventDefault()},self:function(e){return e.target===e.currentTarget}};V.each(U,function(e,t){W.register(t,{type:"event",apply:e})});var K={json:{apply:function(e,t){return"string"==typeof e?e:JSON.stringify(e,null,Number(t)||2)},unapply:function(e){try{return JSON.parse(e)}catch(t){return e}}},capitalize:function(e){return e||0===e?(e=e.toString(),e.charAt(0).toUpperCase()+e.slice(1)):""},uppercase:function(e){return e||0===e?e.toString().toUpperCase():""},lowercase:function(e){return e||0===e?e.toString().toLowerCase():""},currency:function(e,t){if(e=parseFloat(e),!isFinite(e)||!e&&0!==e)return"";t=null!=t?t:"$";var n=Math.abs(e).toFixed(2),i=n.slice(0,-3),r=i.length%3,o=r>0?i.slice(0,r)+(i.length>3?",":""):"",s=n.slice(-3),c=e<0?"-":"";return c+t+o+i.slice(r).replace(digitsRE,"$1,")+s},pluralize:function(e){var t=z.call(arguments,1);return t.length>1?t[e%10-1]||t[t.length-1]:t[0]+(1===e?"":"s")}};V.each(K,function(e,t){W.register(t,e)});var Z=V.reverseConvert("Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat,$scope".split(","),function(){return!0}),G=/\s/g,J=/\n/g,Q=/[\{,]\s*[\w\$_]+\s*:|('(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"|`(?:[^`\\]|\\.)*\$\{|\}(?:[^`\\]|\\.)*`|`(?:[^`\\]|\\.)*`)|new |typeof |void |(\|\|)/g,ee=/"(\d+)"/g,te=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/,ne=/^(?:true|false)$/,ie=/[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*[^\w$\.]/g,re=/^[A-Za-z_$][\w$]*/,oe=[],se=void 0,ce=void 0,ae=void 0,ue={},le="string"==typeof document.createElement("div").textContent?"textContent":"innerText",he={W3C:!!window.dispatchEvent,inDoc:function(e,t){if(t=t||document.documentElement,t.contains)return t.contains(e);try{for(;e=e.parentNode;)if(e===t)return!0}catch(n){}return!1},query:function(e,t){return V.isString(e)?t?document.querySelectorAll(e):document.querySelector(e):e},cloneNode:function(e,t){function n(e){return e.cloneNode(t!==!1)}return V.isArrayLike(e)?V.map(e,n):n(e)},parent:function(e){return v(e).parentNode},next:function(e,t){return e=m(e),t?e.nextSibling:e.nextElementSibling},prev:function(e,t){return e=v(e),t?e.previousSibling:e.previousElementSibling},children:function(e,t){return e=v(e),t?e.childNodes:e.children},remove:function(e){return g(e,function(e){var t=e.parentNode;t&&t.removeChild(e)}),he},before:function(e,t){t=v(t);var n=t.parentNode;return g(e,function(e){n.insertBefore(e,t)}),he},after:function(e,t){t=m(t);var n=t.parentNode;return g(e,n.lastChild===t?function(e){n.insertBefore(e,t)}:function(){var e=t.nextSibling;return function(t){n.insertBefore(t,e)}}()),he},append:function(e,t){return e=v(e),g(t,function(t){e.appendChild(t)}),he},prepend:function(e,t){return e.firstChild?he.before(t,t.firstChild):he.append(e,t),he},replace:function(e,t){var n=e.parentNode;n.replaceChild(t,e)},html:function(e,t){return arguments.length>1?e.innerHTML=t:e.innerHTML},outerHtml:function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},text:function(e,t){return 3==e.nodeType?arguments.length>1?e.data=t:e.data:arguments.length>1?e[le]=t:e[le]},focus:function(e){return e.focus(),he}};document.querySelectorAll||(document.querySelectorAll=function(e){var t=document,n=t.documentElement.firstChild,i=t.createElement("STYLE");if(n.appendChild(i),t.__qsaels=[],i.styleSheet)i.styleSheet.cssText=e+"{x:expression(document.__qsaels.push(this))}";else{var r=document.createTextNode(e+"{x:expression(document.__qsaels.push(this))}");i.appendChild(r)}return window.scrollBy(0,0),t.__qsaels}),document.querySelector||(document.querySelector=function(e){var t=document.querySelectorAll(e);return t.length?t[0]:null});var de=/^(?:input|select|textarea|button|object)$/i,pe=/^(?:a|area)$/i;V.assign(he,{prop:function(e,t,n){t=he.propFix[t]||t;var i=he.propHooks[t];return 2==arguments.length?i&&i.get?i.get(e,t):e[t]:(i&&i.set?i.set(e,t,n):e[t]=n,he)},attr:function(e,t,n){return 2==arguments.length?e.getAttribute(t):(e.setAttribute(t,n),he)},removeAttr:function(e,t){return e.removeAttribute(t),he},checked:function(e,t){return y(e,"checked",arguments.length>1,t)},"class":function(e,t){return y(e,"class",arguments.length>1,t)},addClass:function(e,t){if(e.classList)e.classList.add(t);else{var n=" "+he.prop(e,"class")+" ";n.indexOf(" "+t+" ")===-1&&he["class"](e,V.trim(n+t))}return he},removeClass:function(e,t){return e.classList?e.classList.remove(t):he["class"](e,V.trim((" "+he.prop(e,"class")+" ").replace(new RegExp(" "+t+" ","g"),""))),he},style:function(e,t){return y(e,"style",arguments.length>1,t)},propHooks:{tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex");return t&&t.specified?parseInt(t.value,10):de.test(e.nodeName)||pe.test(e.nodeName)&&e.href?0:void 0}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"}}),V.assign(he,{css:function(e,t,n){var i=/[_-]/.test(t)?b(t):t,r=void 0;if(t=x(i)||i,r=ve[i]||me,2==arguments.length){var o=n,s=void 0;return"background"===t&&(t="backgroundColor"),n=r.get(e,t),o!==!1&&isFinite(s=parseFloat(n))?s:n}return n||0===n?(isFinite(n)&&!ye[i]&&(n+="px"),r.set(e,t,n)):e.style[t]="",he},position:function(e){var t=void 0,n=void 0,i={top:0,left:0};return"fixed"===he.css(e,"position")?n=e.getBoundingClientRect():(t=w(e),n=C(e),"HTML"!==t.tagName&&(i=C(t)),i.top+=he.css(t,"borderTopWidth",!0),i.left+=he.css(t,"borderLeftWidth",!0),i.top-=he.scrollTop(t),i.left-=he.scrollLeft(t)),{top:n.top-i.top-he.css(e,"marginTop",!0),left:n.left-i.left-he.css(e,"marginLeft",!0)}},scrollTop:function(e,t){var n=E(e);return 1==arguments.length?(n?"scrollTop"in n?n.scrollTop:be.pageYOffset:e.pageYOffset)||0:(n?n.scrollTo(he.scrollLeft(e),t):e.pageYOffset=t,he)},scrollLeft:function(e,t){var n=E(e);return 1==arguments.length?(n?"scrollLeft"in n?n.scrollLeft:be.pageXOffset:e.pageXOffset)||0:(n?n.scrollTo(t,he.scrollTop(e)):e.pageXOffset=t,he)},scroll:function(e,t,n){var i=E(e);return 1==arguments.length?{left:he.scrollLeft(e),top:he.scrollTop(e)}:(i?i.scrollTo(t,n):(e.pageXOffset=t,e.pageYOffset=n),he)}});var fe=he.cssFix={"float":he.W3C?"cssFloat":"styleFloat"},ve=he.cssHooks={},me={},ge=["","-webkit-","-o-","-moz-","-ms-"],ye={animationIterationCount:!0,columnCount:!0,order:!0,flex:!0,flexGrow:!0,flexShrink:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},be=document.documentElement,xe=he.css;me.set=function(e,t,n){try{e.style[t]=n}catch(i){}};var we=void 0;window.getComputedStyle?(we=me.get=function(e,t){var n=void 0,i=getComputedStyle(e,null);return i&&(n="filter"===t?i.getPropertyValue(t):i[t],""===n&&(n=e.style[t])),n},ve.opacity={get:function(e,t){var n=we(e,t);return""===n?"1":ret}}):!function(){var e=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,t=/^(top|right|bottom|left)$/,n=/alpha\([^)]*\)/i,i=!!window.XDomainRequest,r="DXImageTransform.Microsoft.Alpha",o={thin:i?"1px":"2px",medium:i?"3px":"4px",thick:i?"5px":"6px"};we=me.get=function(n,i){var r=n.currentStyle,s=r[i];if(e.test(s)&&!t.test(s)){var c=n.style,a=c.left,u=n.runtimeStyle.left;n.runtimeStyle.left=r.left,c.left="fontSize"===i?"1em":s||0,s=c.pixelLeft+"px",c.left=a,n.runtimeStyle.left=u}return"medium"===s&&(i=i.replace("Width","Style"),"none"===r[i]&&(s="0px")),""===s?"auto":o[s]||s},ve.opacity={get:function(e,t){var n=e.filters.alpha||e.filters[r],i=n&&n.enabled?n.opacity:100;return i/100+""},set:function(e,t,i){var r=e.style,o=isFinite(i)&&i<=1?"alpha(opacity="+100*i+")":"",s=r.filter||"";r.zoom=1,r.filter=(n.test(s)?s.replace(n,o):s+" "+o).trim(),r.filter||r.removeAttribute("filter")}}}(),V.each(["top","left"],function(e){ve[e]={get:function(e,t){var n=we(e,t);return/px$/.test(n)?n:he.position(e)[t]+"px"}}}),V.each(["Width","Height"],function(e){function t(e,t){var n=void 0;return n=e[i],2===t?n+xe(e,"margin"+r[0],!0)+xe(e,"margin"+r[1],!0):(t<0&&(n=n-xe(e,"border"+r[0]+"Width",!0)-xe(e,"border"+r[1]+"Width",!0)),t===-4&&(n=n-xe(e,"padding"+r[0],!0)-xe(e,"padding"+r[1],!0)),n)}var n=e.toLowerCase(),i="offset"+e,r="Width"==e?["Left","Right"]:["Top","Bottom"];he[n]=function(e){return t(e,-4)},he["inner"+e]=function(e){return t(e,-2)},he["outer"+e]=function(e,n){return t(e,n===!0?2:0)}}),V.assign(he,{val:function(e,t){var n=he.valHooks[e.type||e.tagName.toLowerCase()];return 1==arguments.length?n&&n.get?n.get(e):e.value||"":(n&&n.set?n.set(e,t):e.value=T(t),he)},valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t="select-one"==e.type,n=e.selectedIndex;if(n<0)return t?void 0:[];for(var i=e.options,r=void 0,o=t?void 0:[],s=0,c=i.length;s<c;s++)if(r=i[s],r.selected||s==n){if(t)return he.val(r);o.push(he.val(r))}return o},set:function(e,t){var n="select-one"==e.type,i=e.options,r=void 0,o=void 0,s=void 0,c=void 0,a=void 0;if(e.selectedIndex=-1,V.isArray(t)||(t=V.isNil(t)?[]:[t]),c=t.length){n&&(c=t.length=1);var u=V.reverseConvert(t,function(){return!1}),l=0;for(o=0,s=i.length;o<s&&(r=i[o],a=he.val(r),!V.isBoolean(u[a])||(u[a]=r.selected=!0,++l!==c));o++)t=V.keys(u,function(e){return e===!0})}return n?t[0]:t}}}});var Ce=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ee=document.documentElement,Te=V.assign(he,{hasListen:function(e,t,n){return $(e,t,n)},on:function(e,t,n,i){return k(e,t,n,i===!0)&&(Fe[t]?P(t,n):A(e,t,n)),he},once:function(e,t,n){return he.on(e,t,n,!0)},off:function(e,t,n){return S(e,t,n)&&(Fe[t]?L(t,n):N(e,t,n)),he},dispatchEvent:function(e,t,n){var i=void 0;return document.createEvent?(i=document.createEvent("Events"),i.initEvent(t,!0,!0,n),V.assign(i,n),e.dispatchEvent(i)):he.inDoc(e)&&(i=document.createEventObject(),V.assign(i,n),e.fireEvent("on"+t,i)),i}}),ke=/^(?:mouse|contextmenu|drag)|click/,Se=/^key/,De=["altKey","bubbles","cancelable","ctrlKey","currentTarget","propertyName","eventPhase","metaKey","relatedTarget","shiftKey","target","view","which"],$e={},Ae={props:["char","charCode","key","keyCode"],fix:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode)}},Ne={props:["button","buttons","clientX","clientY","offsetX","offsetY","pageX","pageY","screenX","screenY","toElement"],fix:function(e,t){var n,i,r,o=t.button;null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||document,i=n.documentElement,r=n.body,e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0)}},Pe=function(){function e(t){Ce(this,e);var n=t.type,i=$e[n],r=void 0,o=void 0;for(this.originalEvent=t,this.type=t.type,this.returnValue=!(t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault()),this.timeStamp=t&&t.timeStamp||new Date+0,r=De.length;r--;)o=De[r],this[o]=t[o];if(i||($e[n]=i=ke.test(n)?Ne:Se.test(n)?Ae:{}),i.props){var s=i.props;for(r=s.length;r--;)o=s[r],this[o]=t[o]}this.target||(this.target=t.srcElement||document),3==this.target.nodeType&&(this.target=this.target.parentNode),i.fix&&i.fix(this,t)}return e.prototype.preventDefault=function(){var e=this.originalEvent;this.returnValue=!1,e&&(e.returnValue=!1,e.preventDefault&&e.preventDefault())},e.prototype.stopPropagation=function(){var e=this.originalEvent;this.cancelBubble=!0,e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},e.prototype.stopImmediatePropagation=function(){var e=this.originalEvent;this.isImmediatePropagationStopped=!0,e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()},e}(),Le="__LISTEN__",Ie=he.W3C?function(e,t,n,i){e.addEventListener(t,n,i)}:function(e,t,n){e.attachEvent("on"+t,n)},Oe=he.W3C?function(e,t,n){e.removeEventListener(t,n)}:function(e,t,n){e.detachEvent("on"+t,n)},_e=["click","dblclick","keydown","keypress","keyup","mousedown","mousemove","mouseup","mouseover","mouseout","wheel","mousewheel","input","change","beforeinput","compositionstart","compositionupdate","compositionend","select","cut","copy","paste","beforecut","beforecopy","beforepaste","focusin","focusout","DOMFocusIn","DOMFocusOut","DOMActivate","dragend","datasetchanged"],Fe={},He={focus:!0,blur:!0},Ve={},Be={},qe={};V.each(_e,function(e){Fe[e]=!0}),he.W3C||(delete Fe.change,delete Fe.select);var Me=new Date;"onmouseenter"in Ee||V.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){Ve[e]={type:t,fix:function(e,t,n){var i=t.relatedTarget;return!i||i!==e&&!(16&e.compareDocumentPosition(i))}}}),V.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!Ve.animationend&&(Ve.animationend={type:t})}),"oninput"in document.createElement("input")?navigator.userAgent.indexOf("MSIE 9")!==-1&&(Ve.input={type:"input",fix:function(e){e.oldValue=e.value}},document.addEventListener("selectionchange",function(e){var t=document.activeElement;if("TEXTAREA"===t.tagName||"INPUT"===t.tagName&&"text"===t.type){if(t.value==t.oldValue)return;t.oldValue=t.value,$(t,"input")&&(e=new Pe(e),e.type="input",O(t,"input",e))}})):(delete Fe.input,Ve.input={type:"propertychange",fix:function(e,t){return"value"==t.propertyName}},Ve.change={bind:function(e){if("checkbox"==e.type||"radio"==e.type)return e.$onchange||(e.$onchange=function(t){t.type="change",O(e,"change",t)},he.on(e,"click",e.$onchange)),!1},unbind:function(e){if("checkbox"==e.type||"radio"==e.type)return he.off(e,"click",e.$onchange),!1}}),void 0===document.onmousewheel&&!function(){var e=document.onwheel?"wheel":"DOMMouseScroll",t="wheel"===e?"deltaY":"detail";Ve.mousewheel={type:e,fix:function(e,n){return n.wheelDeltaY=n.wheelDelta=n[t]>0?-120:120,n.wheelDeltaX=0,!0}}}(),V.each(Ve,function(e,t){Be[e.type||t]=t});var Re=[],Xe=void 0,ze=document.documentElement;"complete"===document.readyState?setTimeout(F):document.addEventListener?document.addEventListener("DOMContentLoaded",F):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&F()}),ze.doScroll&&null===window.frameElement&&window.external&&!function(){var e=function(){try{ze.doScroll("left"),F()}catch(t){setTimeout(e)}};e()}()),Te.on(window,"load",F),Te.ready=function(e){return Xe?e():Re.push(e),Te};var Ye=["$el"],We=V.dynamicClass({extend:R,constructor:function(e){this["super"](arguments),this.expr=f(e.expression,Ye),M.get(R.commentCfg)&&(this.comment=document.createComment("Text Binding "+this.expr),he.before(this.comment,this.el)),this.observeHandler=this.observeHandler.bind(this)},value:function(){return this.expr.executeAll.call(this,this.scope(),this.el)},bind:function(){var e=this;V.each(this.expr.identities,function(t){e.observe(t,e.observeHandler)}),this.update(this.value())},unbind:function(){var e=this;V.each(this.expr.identities,function(t){e.unobserve(t,e.observeHandler)})},observeHandler:function(e,t){this.expr.simplePath?this.update(this.expr.applyFilter(t,this,[this.scope(),this.el])):this.update(this.value())},update:function(e){V.isNil(e)&&(e=""),e!==he.text(this.el)&&he.text(this.el,e)}}),je={},Ue=V.dynamicClass({extend:R,independent:!1,block:!1,priority:5,constructor:function(e){this["super"](arguments),this.expr=e.expression,this.attr=e.attr,this.children=e.children,this.domParser=e.domParser,M.get(R.commentCfg)&&(this.comment=document.createComment("Directive["+this.attr+"]: "+this.expr),he.before(this.comment,this.el))},bindChildren:function(){this.children&&V.each(this.children,function(e){e.bind()})},bind:function(){this.bindChildren()},unbindChildren:function(){this.children&&V.each(this.children,function(e){e.unbind()})},unbind:function(){this.unbindChildren()},statics:{getPriority:function(e){return e.prototype.priority},isBlock:function(e){return e.prototype.block},isIndependent:function(e){return e.prototype.independent},getDirective:function(e){return je[e.toLowerCase()]},isDirective:function(e){return V.isExtendOf(e,Ue)},register:function(e,t){var n=void 0;if(e=e.toLowerCase(),V.isObject(t))t.extend=t.extend||Ue,n=V.dynamicClass(t);else{if(!V.isFunc(t)||!V.isExtendOf(t,Ue))throw TypeError("Invalid Directive["+e+"] "+t);n=t}if(e in je)throw new Error("Directive["+e+"] is existing");return je[e]=n,X.debug("register Directive[%s]",e),n}}}),Ke=V.dynamicClass({extend:R,constructor:function(e){this["super"](arguments),this.directives=e.directives,this.children=e.children,this.directiveCount=e.directives.length,this.bindedCount=0,this.bindedChildren=!1,this._bind=this._bind.bind(this)},_bind:function(){var e=this.bindedCount;if(e<this.directiveCount){var t=this.directives[e],n=t.bind();this.bindedCount++,n&&n instanceof V.YieId?n.then(this._bind):this._bind()}else this.children&&(V.each(this.children,function(e){e.bind()}),this.bindedChildren=!0)},bind:function(){this._bind()},unbind:function(){var e=this.directives,t=this.bindedCount;for(this.bindedChildren&&(V.each(this.children,function(e){e.unbind()}),this.bindedChildren=!1);t--;)e[t].unbind();this.bindedCount=0}});M.register("directiveReg",/^tpl-/,[RegExp]);var Ze=V.dynamicClass({constructor:function(){this.reg=M.get("directiveReg")},isDirective:function(e){return this.reg.test(e)},getDirective:function(e){return Ue.getDirective(e.replace(this.reg,""))}}),Ge=V.dynamicClass({constructor:function(e,t){this.el=e,this.bindings=t},before:function(e,t){return t!==!1&&this.bind(),he.before(this.el,he.query(e)),this},after:function(e,t){return t!==!1&&this.bind(),he.after(this.el,he.query(e)),this},prependTo:function(e,t){return t!==!1&&this.bind(),he.prepend(he.query(e),this.el),this},appendTo:function(e,t){return t!==!1&&this.bind(),he.append(he.query(e),this.el),this},remove:function(e){he.remove(this.el),e!==!1&&this.unbind()},bind:function(){return this.binded||(V.each(this.bindings,function(e){e.bind()}),this.binded=!0),this},unbind:function(){return this.binded&&(V.each(this.bindings,function(e){e.unbind()}),this.binded=!1),this},destroy:function(){this.binded&&V.each(this.bindings,function(e){e.unbind(),e.destroy()}),he.remove(this.el),this.bindings=void 0,this.el=void 0}});M.register("directiveParser",new Ze,[Ze]),M.register("TextParser",q,q,!0);var Je=1,Qe=2,et=3,tt=V.dynamicClass({constructor:function(e,t){this.el=this.parseEl(e,t),this.directiveParser=M.get("directiveParser"),this.TextParser=M.get("TextParser"),this.parse()},complie:function(e){var t=he.cloneNode(this.el),n=document.createDocumentFragment();return he.append(n,t),new Ge(V.map(n.childNodes,function(e){return e}),this.parseBindings(this.bindings,e,this.parseEls(t)))},parseBindings:function(e,t,n){var i=this;return V.map(e,function(e){var r=e.type,o={el:n[e.index],scope:t};if(r===Je)return o.expression=e.expression,new We(o);var s=void 0;return r===Qe?(s=e.directive,o.expression=e.expression,o.attr=e.attr,o.domParser=e.domParser,o.independent=e.independent):(s=Ke,o.directives=V.map(e.directives,function(e){return new e.directive({el:o.el,scope:t,expression:e.expression,attr:e.attr})})),o.block=e.block,o.children=e.children?i.parseBindings(e.children||[],t,n):void 0,new s(o)})},parseEls:function(e){var t=0,n=this.elStatus;return this.eachDom(e,[],function(e,i){return i.push(e),n[t++]&&i},function(e,n){n.push(e),t++})},parseEl:function(e,t){if(V.isString(e)){if(e=V.trim(e),"<"==e.charAt(0)){var n=document.createElement("div");he.html(n,e),e=n.childNodes}e=he.query(e)}else t&&(e=he.cloneNode(e));return e},eachDom:function(e,t,n,i){var r=this;return V.isArrayLike(e)?V.each(e,function(e){r._eachDom(e,t,n,i)}):this._eachDom(e,t,n,i),t},_eachDom:function(e,t,n,i){var r=this;switch(e.nodeType){case 1:(t=n(e,t))&&V.each(V.map(e.childNodes,function(e){return e}),function(e){r._eachDom(e,t,n,i)});break;case 3:i(e,t)}},parse:function(){function e(e,t){return e&&(n.push(t),i++),e}var t=this,n=[],i=0,r=this.TextParser,o=this.directiveParser;this.elStatus=n,this.bindings=this.eachDom(this.el,[],function(t,n){var r=[],s=!1,c=!1,a=void 0;if(V.each(t.attributes,function(e){var t=e.name,n=void 0;if(o.isDirective(t)){if(!(n=o.getDirective(t)))return void X.warn("Directive["+t+"] is undefined");var a={type:Qe,index:i,expression:e.value,directive:n,attr:t,block:Ue.isBlock(n),independent:Ue.isIndependent(n)};if(a.independent)return a.block=s=c=!0,r=[a],!1;a.block&&(s=!0),r.push(a)}}),!r.length)return e(t,!0),n;if(a=1==r.length?r[0]:{type:et,index:i,directives:r.sort(function(e,t){return Ue.getPriority(t.directive)-Ue.getPriority(e.directive)||0}),block:s,independent:c},a.children=!s&&[],n.push(a),c){var u=he.cloneNode(t,!1);he.removeAttr(u,r[0].attr),he.append(u,V.map(t.childNodes,function(e){return e})),a.domParser=new tt(u,(!1))}return e(t,!s),a.children},function(n,o){for(var s=he.text(n),c=new r(s),a=void 0,u=0,l=n.parentNode,h=l.childNodes.length,d=i;a=c.nextToken();)u<a.start&&e(t.insertNotBlankText(s.substring(u,a.start),n),!1),o.push({type:Je,index:i,expression:a.token}),e(t.insertText("binding",n),!1),u=a.end;u?(e(t.insertNotBlankText(s.substr(u),n),!1),he.remove(n),console.log(l.childNodes.length+"===="+h+"   "+(i-d))):e(n,!1)})},insertNotBlankText:function(e,t){return(e=V.trim(e))?this.insertText(e,t):void 0},insertText:function(e,t){var n=document.createTextNode(e);return he.before(n,t),n}}),nt=0,it={},rt=V.dynamicClass({statics:{get:function(e){return it[e]},DomParser:tt,DirectiveParser:Ze,TextParser:q},constructor:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.id=t.id||nt++,V.hasOwnProp(it,this.id))throw new Error("Existing Template["+this.id+"]");this.parser=new tt(e),it[this.id]=this},complie:function(e){return this.parser.complie(e)}}),ot=/^\s*([\s\S]+)\s+in\s+([\S]+)(\s+track\s+by\s+([\S]+))?\s*$/,st=/^(\(\s*([^,\s]+)(\s*,\s*([\S]+))?\s*\))|([^,\s]+)(\s*,\s*([\S]+))?$/,ct=Ue.register("each",V.dynamicClass({extend:Ue,independent:!0,block:!0,priority:10,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this);var e=this.expr.match(ot);if(!e)throw Error("Invalid Expression["+this.expr+"] on Each Directive");this.scopeExpr=e[2],this.indexExpr=e[4];var t=e[1].match(st);if(!t)throw Error("Invalid Expression["+e[1]+"] on Each Directive");this.valueAlias=t[2]||t[5],this.keyAlias=t[4]||t[7],this.begin=document.createComment("each begin"),this.end=document.createComment("each end"),he.replace(this.el,this.begin),he.after(this.end,this.begin),this.el=void 0,this.version=1},update:function(e){var t=this,n=this.domParser,i=this.realScope(),r=(this.begin,this.end),o=this.indexExpr,s=this.used,c=this.version++,a=this.used={},u=V.map(e,function(e,t){var n=o?V.get(e,o):t,i=s&&s[n],r=void 0;return i&&i.version===c&&(i=void 0),r=i||{index:n},r.version=c,r.data=e,a[n]=r,r}),l=[],h=document.createDocumentFragment();s&&tpl.each(s,function(e){e.version!=c&&l.push(e),e.tpl.remove(!1)}),tpl.each(u,function(e){if(!e.scope){var r=l.pop();if(!r)return e.scope=t.createScope(i,e.data,e.index),void(e.tpl=n.complie(e.scope));e.scope=r.scope,e.tpl=r.tpl}he.append(h,e.tpl.el),t.initScope(e.scope,e.data,e.index)}),tpl.before(h,r),tpl.each(u,function(e){return e.tpl.bind()}),tpl.each(l,function(e){return e.tpl.destroy()})},update2:function(e){var t=this,n=this.domParser,i=this.realScope(),r=this.begin,o=this.end,s=this.indexExpr,c=this.valueAlias,a=(this.keyAlias,!this.cache),u=this.sort,l=this.sort=new Array(e.length),h=a?this.cache={}:this.cache,d=[],p=[];document.createDocumentFragment();V.each(e,function(r,u){var d=s?V.get(r,s):u,f=!a&&h[d];f?t.initScope(f,r,u,d):(f=h[d]=t.createScope(i,r,u,d),a||p.push(f)),l[u]=f,a&&(f.$tpl=n.complie(f),e[u]=f[c],f.$tpl.before(o))}),a||(V.each(u,function(e){var t=h[e.$index];t&&t!==l[e.$sort]&&(d.push(e),h[e.$index]=void 0)}),V.each(p,function(i){var o=d.pop();o?(t.initScope(o,i),h[i.$index]=o,l[i.$sort]=o,i=o):i.$tpl=n.complie(i),e[i.$sort]=i[c],i.$tpl.after(i.$sort?l[i.$sort-1].$tpl.el:r)}),V.each(d,function(e){e.$tpl.destroy()}))},createScope:function(e,t,n){var i=V.create(e);return i.$parent=e,i.$eachContext=this,this.initScope(i,t,n,!0),i},initScope:function(e,t,n,i){i||(e=V.proxy(e)),e[this.valueAlias]=t,this.keyAlias&&(e[this.keyAlias]=n)},bind:function(){this.observe(this.scopeExpr,this.observeHandler),this.update(this.target())},unbind:function(){this.unobserve(this.scopeExpr,this.observeHandler)},target:function(){return this.get(this.scopeExpr)},observeHandler:function(e,t){this.update(t)}})),at=["$el","$event"],ut=V.dynamicClass({extend:Ue,constructor:function(){this["super"](arguments),this.handler=this.handler.bind(this),this.expression=f(this.expr,at);
},handler:function(e){e.stopPropagation();var t=this.scope(),n=this.expression;if(this.expression.applyFilter(e,this,[t,this.el,e])!==!1){var i=n.execute.call(this,t,this.el,e);if(n.simplePath)if(V.isFunc(i)){var r=this.propScope(n.path[0]);i.call(r,t,this.el,e,r)}else X.warn("Invalid Event Handler:%s",this.expr,i)}},bind:function(){he.on(this.el,this.eventType,this.handler),this["super"](arguments)},unbind:function(){this["super"](arguments),he.off(this.el,this.eventType,this.handler)}}),lt=["blur","change","click","dblclick","error","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","resize","scroll","select","submit","unload",{name:"oninput",eventType:"input propertychange"}],ht=V.assign(V.convert(lt,function(e){var t=V.isObject(e)?e.name:e;return V.hump(t+"Directive")},function(e){V.isObject(e)||(e={eventType:e});var t=e.name||"on"+e.eventType;return e.extend=ut,Ue.register(t,e)}),{EventDirective:ut}),dt=["$el"],pt=V.dynamicClass({extend:Ue,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this),this.expression=f(this.expr,dt)},realValue:function(){return this.expression.execute.call(this,this.scope(),this.el)},value:function(){return this.expression.executeAll.call(this,this.scope(),this.el)},listen:function(){var e=this;V.each(this.expression.identities,function(t){e.observe(t,e.observeHandler)}),this.update(this.value())},unlisten:function(){var e=this;V.each(this.expression.identities,function(t){e.unobserve(t,e.observeHandler)})},bind:function(){this.listen(),this["super"](arguments)},unbind:function(){this["super"](arguments),this.unlisten()},blankValue:function(e){return 0==arguments.length&&(e=this.value()),V.isNil(e)?"":e},observeHandler:function(e,t){this.expression.simplePath?this.update(this.expression.applyFilter(t,this,[this.scope(),this.el])):this.update(this.value())},update:function(e){throw"abstract method"}}),ft="change",vt="input",mt="SELECT",gt="INPUT",yt="TEXTAREA",bt="radio",xt="checkbox",wt={text:{block:!0,update:function(e){he.text(this.el,this.blankValue(e))}},html:{block:!0,update:function(e){he.html(this.el,this.blankValue(e))}},"class":{update:function(e){e&&"string"==typeof e?this.handleArray(V.trim(e).split(/\s+/)):e instanceof Array?this.handleArray(e):e&&"object"==typeof e?this.handleObject(e):this.cleanup()},handleObject:function(e){this.cleanup(e,!1);var t=this.prevKeys=[],n=this.el;for(var i in e)e[i]?(he.addClass(n,i),t.push(i)):he.removeClass(n,i)},handleArray:function(e){this.cleanup(e,!0);var t=this.prevKeys=[],n=this.el;V.each(e,function(e){e&&(t.push(e),he.addClass(n,e))})},cleanup:function(e,t){var n=this.prevKeys;if(n)for(var i=n.length,r=this.el;i--;){var o=n[i];e&&(t?V.indexOf(e,o)!=-1:V.hasOwnProp(e,o))||he.removeClass(r,o)}}},style:{update:function(e){e&&V.isString(e)?he.style(this.el,e):e&&V.isObject(e)&&this.handleObject(e)},handleObject:function(e){this.cleanup(e);var t=(this.prevKeys=[],this.el);V.each(e,function(e,n){he.css(t,n,e)})}},show:{update:function(e){he.css(this.el,"display",e?"":"none")}},hide:{update:function(e){he.css(this.el,"display",e?"none":"")}},value:{update:function(e){he.val(this.el,this.blankValue(e))}},"if":{priority:9,bind:function(){return this.yieId=new V.YieId,this.listen(),this.yieId},unbind:function(){this.yieId||this.unbindChildren(),this.unlisten()},update:function(e){e?(this.yieId&&(this.yieId.done(),this.yieId=void 0,this.bindChildren()),he.css(this.el,"display","")):he.css(this.el,"display","none")}},checked:{update:function(e){V.isArray(e)?he.checked(this.el,V.indexOf(e,he.val(this.el))):he.checked(this.el,!!e)}},selected:{update:function(e){}},focus:{update:function(e){e&&he.focus(this.el)}},input:{priority:4,constructor:function(){if(this["super"](arguments),!this.expression.simplePath)throw TypeError("Invalid Expression["+this.expression.expr+"] on InputDirective");this.onChange=this.onChange.bind(this);var e=this.tag=this.el.tagName;switch(e){case mt:this.event=ft;break;case gt:var t=this.type=this.el.type;this.event=t==bt||t==xt?ft:vt;break;case yt:throw TypeError("Directive[input] not support "+e);default:throw TypeError("Directive[input] not support "+e)}},bind:function(){he.on(this.el,this.event,this.onChange),this["super"]()},unbind:function(){this["super"](),he.off(this.el,this.event,this.onChange)},setRealValue:function(e){this.set(this.expression.path,e)},setValue:function(e){this.setRealValue(this.expression.applyFilter(e,this,[this.scope(),this.el],!1))},onChange:function(e){var t=this.elVal(),n=this.val;t!=n&&this.setValue(t),e.stopPropagation()},update:function(e){var t=this.blankValue(e);t!=this.val&&this.elVal(this.val=t)},elVal:function(e){var t=this.tag;switch(t){case mt:break;case gt:var n=this.type;if(n==bt||n==xt){if(0==arguments.length)return he.checked(this.el)?he.val(this.el):void 0;var i=void 0;i=e==he.val(this.el),he.checked(this.el)!=i&&he.checked(this.el,i)}else{if(0==arguments.length)return he.val(this.el);e!=he.val(this.el)&&he.val(this.el,e)}break;case yt:throw TypeError("Directive[input] not support "+t);default:throw TypeError("Directive[input] not support "+t)}}}},Ct=V.assign(V.convert(wt,function(e,t){return V.hump(t+"Directive")},function(e,t){return e.extend=pt,Ue.register(t,e)}),{SimpleDirective:pt}),Et=V.assign({EachDirective:ct},ht,Ct),Tt=V.assign(rt,V,he,{translate:W,expression:f,Directive:Ue,directives:Et,config:M,init:function(t){e.init(t),M.config(t)}});return Tt});
//# sourceMappingURL=tpl.min.js.map