!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("observer")):"function"==typeof define&&define.amd?define("tpl",["observer"],t):e.tpl=t(e.observer)}(this,function(e){function t(e){return"_"!=e[0]&&"-"!=e[0]||(e=e[1]),e.toUpperCase()}function n(t,n,i){return e.each(n,function(e,n){t[i[n]||n]=e}),t}function i(e){return q.isArrayLike(e)?e[0]:e}function r(e){return q.isArrayLike(e)?e[e.length-1]:e}function s(e,t){q.isArrayLike(e)?q.each(e,t):t(e)}function o(e,t,n,i){return n?(z.prop(e,t),z):z.prop(e,t)}function a(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function c(e,t,n){if(j[e])return j[e];t=t||J.style;for(var i=0,r=Z.length;i<r;i++)if(n=a(Z[i]+e),n in t)return j[e]=n;return null}function u(e){for(var t=e.offsetParent;t&&"static"===Q(t,"position");)t=t.offsetParent;return t||J}function l(e){var t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,i=n.body,r=n.documentElement,s=n.defaultView||n.parentWindow;if(!z.inDoc(e,r))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var o=r.clientTop||i.clientTop,a=r.clientLeft||i.clientLeft,c=Math.max(s.pageYOffset||0,r.scrollTop,i.scrollTop),u=Math.max(s.pageXOffset||0,r.scrollLeft,i.scrollLeft);return{top:t.top+c-o,left:t.left+u-a}}function h(e){return e.window&&e.document?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}function p(e){return q.isNil(e)||NaN===e?"":q.isString(e)?e:e+""}function d(e,t,n,i){if(!q.isFunc(n))throw TypeError("Invalid Event Handler");var r=e[he],s=void 0;return r||(e[he]=r={}),(s=r[t])||(r[t]=s=[]),s.push({handler:n,once:i}),1===s.length}function f(e,t,n){var i=e[he],r=i?i[t]:void 0;if(r)for(var s=0,o=r.length;s<o;s++)if(r[s].handler===n)return r.splice(s,1),1===o;return!1}function v(e,t){var n=e[he],i=n?n[t]:void 0;return i?i.slice():void 0}function g(e,t,n){var i=e[he],r=i?i[t]:void 0;return!!r&&(n?q.indexOf(r,n)!=-1:!!r.length)}function m(e,t,n){var i=me[t];i&&i.bind&&i.bind(e,t,n)===!1||pe(e,i?i.type||t:t,C,!!ge[t])}function y(e,t,n){var i=me[t];i&&i.unbind&&i.unbind(e,t,n)===!1||de(e,i?i.type||t:t,C)}function b(e,t){be[e]?be[e]++:(m(ne,e,t),be[e]=1)}function x(e,t){be[e]&&(be[e]--,be[e]||y(ne,e,t))}function w(e,t,n){var i=v(e,t.type);if(i){t.currentTarget=e;var r=void 0,s=void 0,o=void 0;for(s=0,o=i.length;s<o&&!t.isImmediatePropagationStopped;s++){if(r=i[s],n){var a=new Date;a-xe>16&&(r.handler.call(e,t),xe=a)}else r.handler.call(e,t);r.once&&z.off(e,t.type,r.handler)}}}function E(e,t,n){if(e.disabled!==!0||"click"!==t){var i=/move|scroll/.test(t);if(ve[t])for(;e&&e.getAttribute&&!n.cancelBubble;)w(e,n,i),e=e.parentNode;else w(e,n,i)}}function C(e){e=new le(e);var t=e.type,n=e.target;if(ye[t]){t=ye[t];var i=me[t];if(i&&i.fix&&i.fix(n,e)===!1)return;e.type=t,E(n,t,e)}else E(n,t,e)}function T(e){for(Ee=!0;e=we.shift();)e()}function k(e,t,n,i){var r=Ae[e],s=r?r.type:void 0,o=void 0;return o=r?i!==!1?r.apply:r.unapply:void 0,o?(q.isFunc(n)&&(n=n()),t=o.apply(r,[t].concat(n))):Se.warn("filter["+e+"]."+(i!==!1?"apply":"unapply")+" is undefined"),{stop:"event"==s&&t===!1,data:t,replaceData:"event"!==s}}function S(e,t){var n=qe.length;return qe[n]=t?e.replace(Re,"\\n"):e,'"'+n+'"'}function $(e,t){return qe[t]}function A(e,t,n){var i=e.length,r=e.charAt(i-1),s=e.slice(0,i-1),o=s.match(Xe)[0];return Pe[o]||ze[o]?e:"$context"===o?e.replace(Xe,Ye):"("==r?(r=t+i==n.length||")"==n.charAt(t+i)?"":",",Ye="this.propScope('"+o+"')","$scope."+s+".call("+Ye+r):(Me[s]=!0,"$scope."+s+r)}function D(e){return Ye=void 0,(e+" ").replace(Be,A).replace(_e,$)}function N(e,t){for(var n=0,i=e.length;n<i;n++)e[n]=O(D(e[n]),t);return e}function I(e,t){if(!e||!e.length)return[];for(var n=[],i=void 0,r=void 0,s=0,o=e.length;s<o;s++)(i=q.trim(e[s]))&&(r=i.replace(/,?\s+/g,",").split(","),n.push({name:r.shift().replace(_e,$),args:N(r,t)}));return n}function L(e,t){var n=void 0,i=void 0,r=R(e);return Me={},ze=t?q.reverseConvert(t,function(){return!0}):{},r||(n=e.replace(Fe,S).split("|"),e=n.shift().replace(Oe,""),r=R(e)),r?(e=e.replace(_e,$),Me[e]=!0,i={execute:O("$scope."+e,t),path:q.parseExpr(e),expr:e}):i={execute:O(D(e),t),expr:e},i.filters=I(n,t),i.simplePath=r,i.identities=q.keys(Me),ze=void 0,Me=void 0,qe.length=0,i.applyFilter=function(e,t,n,r){for(var s=i.filters,o=void 0,a=void 0,c=void 0,u=0,l=s.length;u<l;u++){if(o=s[u],a=P(o.args,t,n),c=(r!==!1?De.apply:De.unapply)(o.name,e,a),c.stop)return c.data;c.replaceData&&(e=c.data)}return e},i.executeAll=function(){var e=i.execute.apply(this,arguments);return e=i.applyFilter(e,this,arguments)},i}function P(e,t,n){return q.map(e,function(e){return e.apply(t,n)})}function O(e,t){var n=["$scope"];t=t?n.concat(t):n,t.push("return "+e+";");try{return Function.apply(Function,t)}catch(i){throw Error("Invalid expression. Generated function body: "+e)}}function R(e){return He.test(e)&&!Ve.test(e)}function F(e,t){var n=void 0;return e=q.trim(e),(n=We[e])||(We[e]=n=L(e,t)),n}function _(e,t){if(q.isString(e)){if(e=q.trim(e),"<"==e.charAt(0)){var n=document.createElement("div");return z.html(n,e),n.childNodes}e=z.query(e)}return t?z.cloneNode(e):e}function H(e,t){return e[t]||Te.get(t)}function V(e,t){if(q.isString(e)){if(e=q.trim(e),"<"==e.charAt(0)){var n=document.createElement("div");return z.html(n,e),n.childNodes}e=z.query(e)}return t?z.cloneNode(e):e}function B(e,t){return e[t]||Te.get(t)}e="default"in e?e["default"]:e;var X=/(^[a-z])|([_-][a-zA-Z])/g,q=n({hump:function(e){return e.replace(X,t)},YieId:e.dynamicClass({constructor:function(){this.doned=!1,this.thens=[]},then:function(e){this.doned?e():this.thens.push(e)},done:function(){if(!this.doned){for(var e=this.thens,t=0,n=e.length;t<n;t++)e[t]();this.doned=!0}},isDone:function(){return this.doned}})},e,{on:"observe",un:"unobserve",hasListen:"isObserved"}),M="string"==typeof document.createElement("div").textContent?"textContent":"innerText",z={W3C:!!window.dispatchEvent,inDoc:function(e,t){if(t=t||document.documentElement,t.contains)return t.contains(e);try{for(;e=e.parentNode;)if(e===t)return!0}catch(n){}return!1},query:function(e,t){return q.isString(e)?t?document.querySelectorAll(e):document.querySelector(e):e},cloneNode:function(e,t){function n(e){return e.cloneNode(t!==!1)}return q.isArrayLike(e)?q.map(e,n):n(e)},parent:function(e){return i(e).parentNode},next:function(e,t){return e=r(e),t?e.nextSibling:e.nextElementSibling},prev:function(e,t){return e=i(e),t?e.previousSibling:e.previousElementSibling},children:function(e,t){return e=i(e),t?e.childNodes:e.children},remove:function(e){return s(e,function(e){var t=e.parentNode;t&&t.removeChild(e)}),z},before:function(e,t){t=i(t);var n=t.parentNode;return s(e,function(e){n.insertBefore(e,t)}),z},after:function(e,t){t=r(t);var n=t.parentNode;return s(e,n.lastChild===t?function(e){n.insertBefore(e,t)}:function(){var e=t.nextSibling;return function(t){n.insertBefore(t,e)}}()),z},append:function(e,t){return e=i(e),s(t,function(t){e.appendChild(t)}),z},prepend:function(e,t){return e.firstChild?z.before(t,t.firstChild):z.append(e,t),z},replace:function(e,t){var n=e.parentNode;n.replaceChild(t,e)},html:function(e,t){return arguments.length>1?e.innerHTML=t:e.innerHTML},outerHtml:function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},text:function(e,t){return 3==e.nodeType?arguments.length>1?e.data=t:e.data:arguments.length>1?e[M]=t:e[M]},focus:function(e){return e.focus(),z}};document.querySelectorAll||(document.querySelectorAll=function(e){var t=document,n=t.documentElement.firstChild,i=t.createElement("STYLE");if(n.appendChild(i),t.__qsaels=[],i.styleSheet)i.styleSheet.cssText=e+"{x:expression(document.__qsaels.push(this))}";else{var r=document.createTextNode(e+"{x:expression(document.__qsaels.push(this))}");i.appendChild(r)}return window.scrollBy(0,0),t.__qsaels}),document.querySelector||(document.querySelector=function(e){var t=document.querySelectorAll(e);return t.length?t[0]:null});var Y=/^(?:input|select|textarea|button|object)$/i,W=/^(?:a|area)$/i;q.assign(z,{prop:function(e,t,n){t=z.propFix[t]||t;var i=z.propHooks[t];return 2==arguments.length?i&&i.get?i.get(e,t):e[t]:(i&&i.set?i.set(e,t,n):e[t]=n,z)},attr:function(e,t,n){return 2==arguments.length?e.getAttribute(t):(e.setAttribute(t,n),z)},removeAttr:function(e,t){return e.removeAttribute(t),z},checked:function(e,t){return o(e,"checked",arguments.length>1,t)},"class":function(e,t){return o(e,"class",arguments.length>1,t)},addClass:function(e,t){if(e.classList)e.classList.add(t);else{var n=" "+z.prop(e,"class")+" ";n.indexOf(" "+t+" ")===-1&&z["class"](e,q.trim(n+t))}return z},removeClass:function(e,t){return e.classList?e.classList.remove(t):z["class"](e,q.trim((" "+z.prop(e,"class")+" ").replace(new RegExp(" "+t+" ","g"),""))),z},style:function(e,t){return o(e,"style",arguments.length>1,t)},propHooks:{tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex");return t&&t.specified?parseInt(t.value,10):Y.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:void 0}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"}}),q.assign(z,{css:function(e,t,n){var i=/[_-]/.test(t)?a(t):t,r=void 0;if(t=c(i)||i,r=U[i]||K,2==arguments.length){var s=n,o=void 0;return"background"===t&&(t="backgroundColor"),n=r.get(e,t),s!==!1&&isFinite(o=parseFloat(n))?o:n}return n||0===n?(isFinite(n)&&!G[i]&&(n+="px"),r.set(e,t,n)):e.style[t]="",z},position:function(e){var t=void 0,n=void 0,i={top:0,left:0};return"fixed"===z.css(e,"position")?n=e.getBoundingClientRect():(t=u(e),n=l(e),"HTML"!==t.tagName&&(i=l(t)),i.top+=z.css(t,"borderTopWidth",!0),i.left+=z.css(t,"borderLeftWidth",!0),i.top-=z.scrollTop(t),i.left-=z.scrollLeft(t)),{top:n.top-i.top-z.css(e,"marginTop",!0),left:n.left-i.left-z.css(e,"marginLeft",!0)}},scrollTop:function(e,t){var n=h(e);return 1==arguments.length?(n?"scrollTop"in n?n.scrollTop:J.pageYOffset:e.pageYOffset)||0:(n?n.scrollTo(z.scrollLeft(e),t):e.pageYOffset=t,z)},scrollLeft:function(e,t){var n=h(e);return 1==arguments.length?(n?"scrollLeft"in n?n.scrollLeft:J.pageXOffset:e.pageXOffset)||0:(n?n.scrollTo(t,z.scrollTop(e)):e.pageXOffset=t,z)},scroll:function(e,t,n){var i=h(e);return 1==arguments.length?{left:z.scrollLeft(e),top:z.scrollTop(e)}:(i?i.scrollTo(t,n):(e.pageXOffset=t,e.pageYOffset=n),z)}});var j=z.cssFix={"float":z.W3C?"cssFloat":"styleFloat"},U=z.cssHooks={},K={},Z=["","-webkit-","-o-","-moz-","-ms-"],G={animationIterationCount:!0,columnCount:!0,order:!0,flex:!0,flexGrow:!0,flexShrink:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},J=document.documentElement,Q=z.css;K.set=function(e,t,n){try{e.style[t]=n}catch(i){}};var ee=void 0;window.getComputedStyle?(ee=K.get=function(e,t){var n=void 0,i=getComputedStyle(e,null);return i&&(n="filter"===t?i.getPropertyValue(t):i[t],""===n&&(n=e.style[t])),n},U.opacity={get:function(e,t){var n=ee(e,t);return""===n?"1":ret}}):!function(){var e=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,t=/^(top|right|bottom|left)$/,n=/alpha\([^)]*\)/i,i=!!window.XDomainRequest,r="DXImageTransform.Microsoft.Alpha",s={thin:i?"1px":"2px",medium:i?"3px":"4px",thick:i?"5px":"6px"};ee=K.get=function(n,i){var r=n.currentStyle,o=r[i];if(e.test(o)&&!t.test(o)){var a=n.style,c=a.left,u=n.runtimeStyle.left;n.runtimeStyle.left=r.left,a.left="fontSize"===i?"1em":o||0,o=a.pixelLeft+"px",a.left=c,n.runtimeStyle.left=u}return"medium"===o&&(i=i.replace("Width","Style"),"none"===r[i]&&(o="0px")),""===o?"auto":s[o]||o},U.opacity={get:function(e,t){var n=e.filters.alpha||e.filters[r],i=n&&n.enabled?n.opacity:100;return i/100+""},set:function(e,t,i){var r=e.style,s=isFinite(i)&&i<=1?"alpha(opacity="+100*i+")":"",o=r.filter||"";r.zoom=1,r.filter=(n.test(o)?o.replace(n,s):o+" "+s).trim(),r.filter||r.removeAttribute("filter")}}}(),q.each(["top","left"],function(e){U[e]={get:function(e,t){var n=ee(e,t);return/px$/.test(n)?n:z.position(e)[t]+"px"}}}),q.each(["Width","Height"],function(e){function t(e,t){var n=void 0;return n=e[i],2===t?n+Q(e,"margin"+r[0],!0)+Q(e,"margin"+r[1],!0):(t<0&&(n=n-Q(e,"border"+r[0]+"Width",!0)-Q(e,"border"+r[1]+"Width",!0)),t===-4&&(n=n-Q(e,"padding"+r[0],!0)-Q(e,"padding"+r[1],!0)),n)}var n=e.toLowerCase(),i="offset"+e,r="Width"==e?["Left","Right"]:["Top","Bottom"];z[n]=function(e){return t(e,-4)},z["inner"+e]=function(e){return t(e,-2)},z["outer"+e]=function(e,n){return t(e,n===!0?2:0)}}),q.assign(z,{val:function(e,t){var n=z.valHooks[e.type||e.tagName.toLowerCase()];return 1==arguments.length?n&&n.get?n.get(e):e.value||"":(n&&n.set?n.set(e,t):e.value=p(t),z)},valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t="select-one"==e.type,n=e.selectedIndex;if(n<0)return t?void 0:[];for(var i=e.options,r=void 0,s=t?void 0:[],o=0,a=i.length;o<a;o++)if(r=i[o],r.selected||o==n){if(t)return z.val(r);s.push(z.val(r))}return s},set:function(e,t){var n="select-one"==e.type,i=e.options,r=void 0,s=void 0,o=void 0,a=void 0,c=void 0;if(e.selectedIndex=-1,q.isArray(t)||(t=q.isNil(t)?[]:[t]),a=t.length){n&&(a=t.length=1);var u=q.reverseConvert(t,function(){return!1}),l=0;for(s=0,o=i.length;s<o&&(r=i[s],c=z.val(r),!q.isBoolean(u[c])||(u[c]=r.selected=!0,++l!==a));s++)t=q.keys(u,function(e){return e===!0})}return n?t[0]:t}}}});var te=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ne=document.documentElement,ie=q.assign(z,{hasListen:function(e,t,n){return g(e,t,n)},on:function(e,t,n,i){return d(e,t,n,i===!0)&&(ve[t]?b(t,n):m(e,t,n)),z},once:function(e,t,n){return z.on(e,t,n,!0)},off:function(e,t,n){return f(e,t,n)&&(ve[t]?x(t,n):y(e,t,n)),z},dispatchEvent:function(e,t,n){var i=void 0;return document.createEvent?(i=document.createEvent("Events"),i.initEvent(t,!0,!0,n),q.assign(i,n),e.dispatchEvent(i)):z.inDoc(e)&&(i=document.createEventObject(),q.assign(i,n),e.fireEvent("on"+t,i)),i}}),re=/^(?:mouse|contextmenu|drag)|click/,se=/^key/,oe=["altKey","bubbles","cancelable","ctrlKey","currentTarget","propertyName","eventPhase","metaKey","relatedTarget","shiftKey","target","view","which"],ae={},ce={props:["char","charCode","key","keyCode"],fix:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode)}},ue={props:["button","buttons","clientX","clientY","offsetX","offsetY","pageX","pageY","screenX","screenY","toElement"],fix:function(e,t){var n,i,r,s=t.button;null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||document,i=n.documentElement,r=n.body,e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0)}},le=function(){function e(t){te(this,e);var n=t.type,i=ae[n],r=void 0,s=void 0;for(this.originalEvent=t,this.type=t.type,this.returnValue=!(t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault()),this.timeStamp=t&&t.timeStamp||new Date+0,r=oe.length;r--;)s=oe[r],this[s]=t[s];if(i||(ae[n]=i=re.test(n)?ue:se.test(n)?ce:{}),i.props){var o=i.props;for(r=o.length;r--;)s=o[r],this[s]=t[s]}this.target||(this.target=t.srcElement||document),3==this.target.nodeType&&(this.target=this.target.parentNode),i.fix&&i.fix(this,t)}return e.prototype.preventDefault=function(){var e=this.originalEvent;this.returnValue=!1,e&&(e.returnValue=!1,e.preventDefault&&e.preventDefault())},e.prototype.stopPropagation=function(){var e=this.originalEvent;this.cancelBubble=!0,e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},e.prototype.stopImmediatePropagation=function(){var e=this.originalEvent;this.isImmediatePropagationStopped=!0,e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()},e}(),he="__LISTEN__",pe=z.W3C?function(e,t,n,i){e.addEventListener(t,n,i)}:function(e,t,n){e.attachEvent("on"+t,n)},de=z.W3C?function(e,t,n){e.removeEventListener(t,n)}:function(e,t,n){e.detachEvent("on"+t,n)},fe=["click","dblclick","keydown","keypress","keyup","mousedown","mousemove","mouseup","mouseover","mouseout","wheel","mousewheel","input","change","beforeinput","compositionstart","compositionupdate","compositionend","select","cut","copy","paste","beforecut","beforecopy","beforepaste","focusin","focusout","DOMFocusIn","DOMFocusOut","DOMActivate","dragend","datasetchanged"],ve={},ge={focus:!0,blur:!0},me={},ye={},be={};q.each(fe,function(e){ve[e]=!0}),z.W3C||(delete ve.change,delete ve.select);var xe=new Date;"onmouseenter"in ne||q.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){me[e]={type:t,fix:function(e,t,n){var i=t.relatedTarget;return!i||i!==e&&!(16&e.compareDocumentPosition(i))}}}),q.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!me.animationend&&(me.animationend={type:t})}),"oninput"in document.createElement("input")?navigator.userAgent.indexOf("MSIE 9")!==-1&&(me.input={type:"input",fix:function(e){e.oldValue=e.value}},document.addEventListener("selectionchange",function(e){var t=document.activeElement;if("TEXTAREA"===t.tagName||"INPUT"===t.tagName&&"text"===t.type){if(t.value==t.oldValue)return;t.oldValue=t.value,g(t,"input")&&(e=new le(e),e.type="input",E(t,"input",e))}})):(delete ve.input,me.input={type:"propertychange",fix:function(e,t){return"value"==t.propertyName}},me.change={bind:function(e){if("checkbox"==e.type||"radio"==e.type)return e.$onchange||(e.$onchange=function(t){t.type="change",E(e,"change",t)},z.on(e,"click",e.$onchange)),!1},unbind:function(e){if("checkbox"==e.type||"radio"==e.type)return z.off(e,"click",e.$onchange),!1}}),void 0===document.onmousewheel&&!function(){var e=document.onwheel?"wheel":"DOMMouseScroll",t="wheel"===e?"deltaY":"detail";me.mousewheel={type:e,fix:function(e,n){return n.wheelDeltaY=n.wheelDelta=n[t]>0?-120:120,n.wheelDeltaX=0,!0}}}(),q.each(me,function(e,t){ye[e.type||t]=t});var we=[],Ee=void 0,Ce=document.documentElement;"complete"===document.readyState?setTimeout(T):document.addEventListener?document.addEventListener("DOMContentLoaded",T):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&T()}),Ce.doScroll&&null===window.frameElement&&window.external&&!function(){var e=function(){try{Ce.doScroll("left"),T()}catch(t){setTimeout(e)}};e()}()),ie.on(window,"load",T),ie.ready=function(e){return Ee?e():we.push(e),ie};var Te=new q.Configuration,ke=q.dynamicClass({statics:{commentCfg:"generateComments"},constructor:function(e){this._scope=q.obj(e.scope),this.el=e.el},scope:function(){var e=this._scope;return q.proxy(e)||e},realScope:function(){return this._scope},propScope:function(e){for(var t=this.realScope(),n=void 0;(n=t.$parent)&&!q.hasOwnProp(t,e);)t=n;return q.proxy(t)||t},exprScope:function(e){return this.propScope(q.parseExpr(e)[0])},observe:function(e,t){q.observe(this.exprScope(e),e,t)},unobserve:function(e,t){q.unobserve(this.exprScope(e),e,t)},get:function(e){return q.get(this.realScope(),e)},has:function(e){return q.has(this.realScope(),e)},set:function(e,t){q.set(this.scope(),e,t)},bind:function(){throw new Error("abstract method")},unbind:function(){throw new Error("abstract method")},destroy:function(){}});Te.register(ke.commentCfg,!0);var Se=new q.Logger("tpl","debug"),$e=Array.prototype.slice,Ae={},De={register:function(e,t){if(Ae[e])throw Error("Filter["+e+"] is existing");"function"==typeof t&&(t={apply:t}),t.type=t.type||"normal",Ae[e]=t,Se.debug("register Filter[%s:%s]",t.type,e)},get:function(e){return Ae[e]},apply:k,unapply:function(e,t,n){return k(e,t,n,!1)}},Ne={esc:27,tab:9,enter:13,space:32,"delete":[8,46],up:38,left:37,right:39,down:40},Ie={key:function(e){for(var t=e.which,n=void 0,i=1,r=arguments.length;i<r;i++)if(n=arguments[i],t==(Ne[n]||n))return!0;return!1},stop:function(e){e.stopPropagation()},prevent:function(e){e.preventDefault()},self:function(e){return e.target===e.currentTarget}};q.each(Ie,function(e,t){De.register(t,{type:"event",apply:e})});var Le={json:{apply:function(e,t){return"string"==typeof e?e:JSON.stringify(e,null,Number(t)||2)},unapply:function(e){try{return JSON.parse(e)}catch(t){return e}}},capitalize:function(e){return e||0===e?(e=e.toString(),e.charAt(0).toUpperCase()+e.slice(1)):""},uppercase:function(e){return e||0===e?e.toString().toUpperCase():""},lowercase:function(e){return e||0===e?e.toString().toLowerCase():""},currency:function(e,t){if(e=parseFloat(e),!isFinite(e)||!e&&0!==e)return"";t=null!=t?t:"$";var n=Math.abs(e).toFixed(2),i=n.slice(0,-3),r=i.length%3,s=r>0?i.slice(0,r)+(i.length>3?",":""):"",o=n.slice(-3),a=e<0?"-":"";return a+t+s+i.slice(r).replace(digitsRE,"$1,")+o},pluralize:function(e){var t=$e.call(arguments,1);return t.length>1?t[e%10-1]||t[t.length-1]:t[0]+(1===e?"":"s")}};q.each(Le,function(e,t){De.register(t,e)});var Pe=q.reverseConvert("Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat,$scope".split(","),function(){return!0}),Oe=/\s/g,Re=/\n/g,Fe=/[\{,]\s*[\w\$_]+\s*:|('(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"|`(?:[^`\\]|\\.)*\$\{|\}(?:[^`\\]|\\.)*`|`(?:[^`\\]|\\.)*`)|new |typeof |void |(\|\|)/g,_e=/"(\d+)"/g,He=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/,Ve=/^(?:true|false)$/,Be=/[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*[^\w$\.]/g,Xe=/^[A-Za-z_$][\w$]*/,qe=[],Me=void 0,ze=void 0,Ye=void 0,We={},je=["$el"],Ue=q.dynamicClass({extend:ke,constructor:function(e){this["super"](arguments),this.expr=F(e.expression,je),Te.get(ke.commentCfg)&&(this.comment=document.createComment("Text Binding "+this.expr),z.before(this.comment,this.el)),this.observeHandler=this.observeHandler.bind(this)},value:function(){return this.expr.executeAll.call(this,this.scope(),this.el)},bind:function(){var e=this;q.each(this.expr.identities,function(t){e.observe(t,e.observeHandler)}),this.update(this.value())},unbind:function(){var e=this;q.each(this.expr.identities,function(t){e.unobserve(t,e.observeHandler)})},observeHandler:function(e,t){this.expr.simplePath?this.update(this.expr.applyFilter(t,this,[this.scope(),this.el])):this.update(this.value())},update:function(e){q.isNil(e)&&(e=""),e!==z.text(this.el)&&z.text(this.el,e)}}),Ke={},Ze=q.dynamicClass({extend:ke,"abstract":!1,block:!1,priority:5,constructor:function(e){var t=this;this["super"](arguments),this.expr=e.expression,this.attr=e.attr,this.template=e.template,this.templateIndex=e.index,this.children=q.map(e.children,function(n){return t.template.parser.createBinding(n,{el:e.els[n.index],template:t.template,scope:t.realScope()})}),this.group=e.group,Te.get(ke.commentCfg)&&(this.comment=document.createComment("Directive["+this.attr+"]: "+this.expr),z.before(this.comment,this.el))},bindChildren:function(){q.each(this.children,function(e){e.bind()})},unbindChildren:function(){q.each(this.children,function(e){e.unbind()})},statics:{getPriority:function(e){return e.prototype.priority},isBlock:function(e){return e.prototype.block},isAbstract:function(e){return e.prototype["abstract"]},getDirective:function(e){return Ke[e.toLowerCase()]},isDirective:function(e){return q.isExtendOf(e,Ze)},register:function(e,t){var n=void 0;if(e=e.toLowerCase(),q.isObject(t))t.extend=t.extend||Ze,n=q.dynamicClass(t);else{if(!q.isFunc(t)||!q.isExtendOf(t,Ze))throw TypeError("Invalid Directive["+e+"] "+t);n=t}if(e in Ke)throw new Error("Directive["+e+"] is existing");return Ke[e]=n,Se.debug("register Directive[%s]",e),n}}}),Ge=q.dynamicClass({extend:ke,constructor:function(e){var t=this;this["super"](arguments),this.template=e.template,this.directives=q.map(e.directives,function(e){return t.createDirective(e)}),this.bindedCount=0,this.bindedChildren=!1,this.parse=this.parse.bind(this),this.children=q.map(e.children,function(e){return t.createDirective(e)})},createDirective:function(e){return this.template.parser.createBinding(e,{el:this.el,template:this.template,scope:this.realScope(),group:this})},parse:function(){var e=this.bindedCount;if(e<this.directives.length){var t=this.directives[e],n=void 0;n=t.bind(),this.bindedCount++,n&&n instanceof q.YieId?n.then(this.parse):this.parse()}else q.each(this.children,function(e){e.bind()}),this.bindedChildren=!0},bind:function(){this.parse()},unbind:function(){var e=this.directives,t=this.bindedCount;for(this.bindedChildren&&(q.each(this.children,function(e){e.unbind()}),this.bindedChildren=!1);t--;)e[t].unbind();this.bindedCount=0}}),Je=q.dynamicClass({constructor:function(e){this.text=e},token:function(){throw new Error("abstract method")}});Je.NormalTextParser=q.dynamicClass({extend:Je,constructor:function(){this["super"](arguments),this.index=0,this.reg=/{([^{]+)}/g},token:function(){var e=void 0,t=this.reg;if(e=t.exec(this.text)){var n=t.lastIndex;return this.index=n,{token:e[1],start:n-e[0].length,end:n}}this.index=0}});var Qe=q.dynamicClass({statics:{TEXT:1,DIRECTIVE:2,DIRECTIVE_GROUP:3},constructor:function(e,t,n){this.el=e,this.directiveReg=t,this.TextParser=n,this.parse()},createBinding:function(e,t){switch(t=q.assign(t,e),e.type){case Qe.TEXT:return new Ue(t);case Qe.DIRECTIVE:return new e.directive(t);case Qe.DIRECTIVE_GROUP:return new Ge(t);default:throw new Error("invalid binding")}},clone:function(){var e=z.cloneNode(this.el);return{el:e,els:this.parseEls(e),bindings:this.bindings}},parseEls:function(e){var t=this,n=[];return q.isArrayLike(e)?q.each(e,function(e){t.parseElsNode(e,n)}):this.parseElsNode(e,n),n},parseElsNode:function(e,t){var n=this;t.push(e),1===e.nodeType&&this.els[t.length-1].parsed&&q.each(e.childNodes,function(e){n.parseElsNode(e,t)})},parse:function(){var e=this;this.els=[],this.bindings=[],q.isArrayLike(this.el)?q.each(this.el,function(t){e.parseNode(t,e.bindings)}):this.parseNode(this.el,this.bindings)},parseNode:function(e,t){switch(e.nodeType){case 1:this.parseElement(e,t);break;case 3:this.parseText(e,t)}},parseText:function(e,t){for(var n=z.text(e),i=new this.TextParser(n),r=void 0,s=0,o=this.els;r=i.token();)this.insertText2(n.substring(s,r.start),e),this.insertText("binding",e),t.push({expression:r.token,index:o.length-1,type:Qe.TEXT}),s=r.end;s?(this.insertText2(n.substr(s),e),z.remove(e)):this.pushEl(e,!1)},parseElement:function(e,t){var n=this,i=[],r=this.els.length,s=this.directiveReg,o=void 0,a=void 0;q.each(e.attributes,function(e){var t=e.name;if(s.test(t)){var n=Ze.getDirective(t.replace(s,""));if(n){var o={expression:e.value,index:r,directive:n,attr:t,type:Qe.DIRECTIVE};if(Ze.isAbstract(n))return i=[o],a=Ze.isBlock(n),!1;Ze.isBlock(n)&&(a=!0),i.push(o)}else Se.warn("Directive["+t+"] is undefined")}}),1==i.length?o=i[0]:i.length&&(o={directives:i.sort(function(e,t){return Ze.getPriority(t.directive)-Ze.getPriority(e.directive)}),index:r,type:Qe.DIRECTIVE_GROUP}),o&&(t.push(o),t=o.children=[]),this.pushEl(e,!a),a||q.each(q.map(e.childNodes,function(e){return e}),function(e){n.parseNode(e,t)})},pushEl:function(e,t){e.parsed=t,this.els.push(e)},insertText:function(e,t){var n=document.createTextNode(e);return z.before(n,t),this.pushEl(n,!1),n},insertText2:function(e,t){if(e=q.trim(e))return this.insertText(e,t)}}),et=q.dynamicClass({constructor:function(e,t){this.el=e,this.bindings=t},before:function(e){return this.bind(),z.before(this.el,z.query(e)),this},after:function(e){return this.bind(),z.after(this.el,z.query(e)),this},prependTo:function(e){return this.bind(),z.prepend(z.query(e),this.el),this},appendTo:function(e){return this.bind(),z.append(z.query(e),this.el),this},bind:function(){return this.binded||(q.each(this.bindings,function(e){e.bind()}),this.binded=!0),this},unbind:function(){return this.binded&&(q.each(this.bindings,function(e){e.unbind()}),this.binded=!1),this},destroy:function(){this.binded&&q.each(this.bindings,function(e){e.unbind(),e.destroy()}),z.remove(this.el),this.bindings=void 0,this.el=void 0}}),tt="directiveReg",nt="textParser";Te.register(tt,/^tpl-/),Te.register(nt,Je.NormalTextParser);var it=0,rt={},st=q.dynamicClass({statics:{get:function(e){return rt[e]}},constructor:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.id=t.id||it++,this.directiveReg=H(t,tt),this.TextParser=H(t,nt),this.el=_(e,t.clone!==!1),this.parser=new Qe(this.el,this.directiveReg,this.TextParser),rt[this.id]=this},complie:function(e){var t=this,n=this.parser.clone(),i=n.els,r=void 0;return z.append(document.createDocumentFragment(),n.el),r=q.map(n.bindings,function(n){return t.parser.createBinding(n,{el:i[n.index],els:i,scope:e,template:t})}),new et(n.el,r)}}),ot="directiveReg",at="textParser";Te.register(ot,/^tpl-/),Te.register(at,Je.NormalTextParser);var ct=0,ut={},lt=q.dynamicClass({statics:{get:function(e){return ut[e]}},constructor:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];this.id=t.id||ct++,this.directiveReg=B(t,ot),this.TextParser=B(t,at),this.el=V(e,t.clone!==!1),this.parser=new Qe(this.el,this.directiveReg,this.TextParser),ut[this.id]=this},complie:function(e){var t=this,n=this.parser.clone(),i=n.els,r=void 0;return z.append(document.createDocumentFragment(),n.el),r=q.map(n.bindings,function(n){return t.parser.createBinding(n,{el:i[n.index],els:i,scope:e,template:t})}),new et(n.el,r)}}),ht=/^\s*([\s\S]+)\s+in\s+([\S]+)(\s+track\s+by\s+([\S]+))?\s*$/,pt=/^(\(\s*([^,\s]+)(\s*,\s*([\S]+))?\s*\))|([^,\s]+)(\s*,\s*([\S]+))?$/,dt=Ze.register("each",q.dynamicClass({extend:Ze,"abstract":!0,block:!0,priority:10,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this);var e=this.expr.match(ht);if(!e)throw Error("Invalid Expression["+this.expr+"] on Each Directive");this.scopeExpr=e[2],this.indexExpr=e[4];var t=e[1].match(pt);if(!t)throw Error("Invalid Expression["+e[1]+"] on Each Directive");this.valueAlias=t[2]||t[5],this.keyAlias=t[4]||t[7],z.removeAttr(this.el,this.attr),this.begin=document.createComment("each begin"),this.end=document.createComment("each end"),z.replace(this.el,this.begin),z.after(this.end,this.begin);var n=this.template.id+"-"+this.templateIndex;(this.eachTemplate=lt.get(n))||(this.eachTemplate=new lt(this.el,{id:n,directiveReg:this.template.directiveReg,TextParser:this.template.TextParser,clone:!1})),this.el=null},update:function(e){var t=this,n=this.realScope(),i=this.begin,r=this.end,s=this.indexExpr,o=this.valueAlias,a=(this.keyAlias,!this.cache),c=this.sort,u=this.sort=new Array(e.length),l=a?this.cache={}:this.cache,h=[],p=[];q.each(e,function(i,c){var h=s?q.get(i,s):c,d=!a&&l[h];d?t.initScope(d,i,c,h):(d=l[h]=t.createScope(n,i,c,h),a||p.push(d)),u[c]=d,a&&(d.$tpl=t.eachTemplate.complie(d),e[c]=d[o],d.$tpl.before(r))}),a||(q.each(c,function(e){var t=l[e.$index];t&&t!==u[e.$sort]&&(h.push(e),l[e.$index]=void 0)}),q.each(p,function(n){var r=h.pop();r?(t.initScope(r,n),l[n.$index]=r,u[n.$sort]=r,n=r):n.$tpl=t.eachTemplate.complie(n),e[n.$sort]=n[o],n.$tpl.after(n.$sort?u[n.$sort-1].$tpl.els:i)}),q.each(h,function(e){e.$tpl.destroy()}))},createScope:function(e,t,n,i){var r=q.create(e);return r.$parent=e,r.$eachContext=this,r.$tpl=null,this.initScope(r,t,n,i,!0),r},initScope:function(e,t,n,i,r){r||(e=e.$tpl.scope),e.$sort=n,e[this.valueAlias]=t,this.keyAlias&&(e[this.keyAlias]=n),e.$index=i},bind:function(){this.observe(this.scopeExpr,this.observeHandler),this.update(this.target())},unbind:function(){this.unobserve(this.scopeExpr,this.observeHandler)},target:function(){return this.get(this.scopeExpr)},observeHandler:function(e,t){this.update(t)}})),ft=["$el","$event"],vt=q.dynamicClass({extend:Ze,constructor:function(){this["super"](arguments),
this.handler=this.handler.bind(this),this.expression=F(this.expr,ft)},handler:function(e){e.stopPropagation();var t=this.scope(),n=this.expression;if(this.expression.applyFilter(e,this,[t,this.el,e])!==!1){var i=n.execute.call(this,t,this.el,e);if(n.simplePath)if(q.isFunc(i)){var r=this.propScope(n.path[0]);i.call(r,t,this.el,e,r)}else Se.warn("Invalid Event Handler:%s",this.expr,i)}},bind:function(){z.on(this.el,this.eventType,this.handler),this.bindChildren()},unbind:function(){z.off(this.el,this.eventType,this.handler),this.unbindChildren()}}),gt=["blur","change","click","dblclick","error","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","resize","scroll","select","submit","unload",{name:"oninput",eventType:"input propertychange"}],mt=q.assign(q.convert(gt,function(e){var t=q.isObject(e)?e.name:e;return q.hump(t+"Directive")},function(e){q.isObject(e)||(e={eventType:e});var t=e.name||"on"+e.eventType;return e.extend=vt,Ze.register(t,e)}),{EventDirective:vt}),yt=["$el"],bt=q.dynamicClass({extend:Ze,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this),this.expression=F(this.expr,yt)},realValue:function(){return this.expression.execute.call(this,this.scope(),this.el)},value:function(){return this.expression.executeAll.call(this,this.scope(),this.el)},listen:function(){var e=this;q.each(this.expression.identities,function(t){e.observe(t,e.observeHandler)}),this.update(this.value())},bind:function(){this.listen()},unlisten:function(){var e=this;q.each(this.expression.identities,function(t){e.unobserve(t,e.observeHandler)})},unbind:function(){this.unlisten()},blankValue:function(e){return 0==arguments.length&&(e=this.value()),q.isNil(e)?"":e},observeHandler:function(e,t){this.expression.simplePath?this.update(this.expression.applyFilter(t,this,[this.scope(),this.el])):this.update(this.value())},update:function(e){throw"abstract method"}}),xt="change",wt="input",Et="SELECT",Ct="INPUT",Tt="TEXTAREA",kt="radio",St="checkbox",$t={text:{block:!0,update:function(e){z.text(this.el,this.blankValue(e))}},html:{block:!0,update:function(e){z.html(this.el,this.blankValue(e))}},"class":{update:function(e){e&&"string"==typeof e?this.handleArray(q.trim(e).split(/\s+/)):e instanceof Array?this.handleArray(e):e&&"object"==typeof e?this.handleObject(e):this.cleanup()},handleObject:function(e){this.cleanup(e,!1);var t=this.prevKeys=[],n=this.el;for(var i in e)e[i]?(z.addClass(n,i),t.push(i)):z.removeClass(n,i)},handleArray:function(e){this.cleanup(e,!0);var t=this.prevKeys=[],n=this.el;q.each(e,function(e){e&&(t.push(e),z.addClass(n,e))})},cleanup:function(e,t){var n=this.prevKeys;if(n)for(var i=n.length,r=this.el;i--;){var s=n[i];e&&(t?q.indexOf(e,s)!=-1:q.hasOwnProp(e,s))||z.removeClass(r,s)}}},style:{update:function(e){e&&q.isString(e)?z.style(this.el,e):e&&q.isObject(e)&&this.handleObject(e)},handleObject:function(e){this.cleanup(e);var t=(this.prevKeys=[],this.el);q.each(e,function(e,n){z.css(t,n,e)})}},show:{update:function(e){z.css(this.el,"display",e?"":"none")}},hide:{update:function(e){z.css(this.el,"display",e?"none":"")}},value:{update:function(e){z.val(this.el,this.blankValue(e))}},"if":{priority:9,bind:function(){return this.yieId=new q.YieId,this.listen(),this.yieId},unbind:function(){this.unlisten(),this.unbindChildren()},update:function(e){e?(this.bindChildren(),this.yieId&&(this.yieId.done(),this.yieId=void 0),z.css(this.el,"display","")):z.css(this.el,"display","none")}},checked:{update:function(e){q.isArray(e)?z.checked(this.el,q.indexOf(e,z.val(this.el))):z.checked(this.el,!!e)}},selected:{update:function(e){}},focus:{update:function(e){e&&z.focus(this.el)}},input:{priority:4,constructor:function(){if(this["super"](arguments),!this.expression.simplePath)throw TypeError("Invalid Expression["+this.expression.expr+"] on InputDirective");this.onChange=this.onChange.bind(this);var e=this.tag=this.el.tagName;switch(e){case Et:this.event=xt;break;case Ct:var t=this.type=this.el.type;this.event=t==kt||t==St?xt:wt;break;case Tt:throw TypeError("Directive[input] not support "+e);default:throw TypeError("Directive[input] not support "+e)}},bind:function(){this["super"](),z.on(this.el,this.event,this.onChange)},unbind:function(){this["super"](),z.off(this.el,this.event,this.onChange)},setRealValue:function(e){this.set(this.expression.path,e)},setValue:function(e){this.setRealValue(this.expression.applyFilter(e,this,[this.scope(),this.el],!1))},onChange:function(e){var t=this.elVal(),n=this.val;t!=n&&this.setValue(t),e.stopPropagation()},update:function(e){var t=this.blankValue(e);t!=this.val&&this.elVal(this.val=t)},elVal:function(e){var t=this.tag;switch(t){case Et:break;case Ct:var n=this.type;if(n==kt||n==St){if(0==arguments.length)return z.checked(this.el)?z.val(this.el):void 0;var i=void 0;i=e==z.val(this.el),z.checked(this.el)!=i&&z.checked(this.el,i)}else{if(0==arguments.length)return z.val(this.el);e!=z.val(this.el)&&z.val(this.el,e)}break;case Tt:throw TypeError("Directive[input] not support "+t);default:throw TypeError("Directive[input] not support "+t)}}}},At=q.assign(q.convert($t,function(e,t){return console.log("name",t),q.hump(t+"Directive")},function(e,t){return console.log("name2",t),e.extend=bt,Ze.register(t,e)}),{SimpleDirective:bt}),Dt=q.assign({EachDirective:dt},mt,At),Nt=q.assign(st,q,z,{filter:De,expression:F,Directive:Ze,directives:Dt,TextParser:Je,config:Te,TemplateParser:Qe,init:function(t){e.init(t),Te.config(t)}});return Nt});
//# sourceMappingURL=tpl.min.js.map