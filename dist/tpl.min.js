!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("utility"),require("observer")):"function"==typeof define&&define.amd?define("tpl",["utility","observer"],t):e.tpl=t(e.utility,e.observer)}(this,function(e,t){function n(e,t){var n=ue.length;return ue[n]=t?e.replace(J,"\\n"):e,'"'+n+'"'}function i(e,t){return ue[t]}function r(){return"this"}function o(t,n){le={},de=n||r,he=t.__MAP__,he||(he=t.__MAP__=e.reverseConvert(t,function(){return!0}))}function s(){le=void 0,he=void 0,de=void 0,ue.length=0}function c(e,t,n){var i=e.charAt(0),r=e.slice(1),o=r.replace(ce,""),s=o.match(ne)[0];if(o==r&&(Z[s]||he[s]||ae.keywords[s]))return e;var c=t+e.length,a=n.charAt(c++),u=!1,l=!0;switch(a){case"(":u=!se.test(o),l=!1;break;case"=":u="="!=n.charAt(c);break;case"/":case"*":case"+":case"-":case"%":case"&":case"&":u="="==n.charAt(c);break;case">":case"<":u=n.charAt(c)==a&&"="==n.charAt(c+1)}return!u&&l&&(le[o]=!0),""+i+de(o,u)+"."+o}function a(e,t){t=t.slice(),t.push("return "+e+";");try{return Function.apply(Function,t)}catch(n){throw Error("Invalid expression. Generated function body: "+e)}}function u(e){return(" "+e).replace(te,c).replace(ee,i)}function l(t,n){return e.map(t,function(t){var r=t.replace(/,?\s+/g,",").split(",");return{name:r.shift().replace(ee,i),argExecutors:e.map(r,function(e){return a(u(e),n)})}})}function h(e){return ie.test(e)&&!re.test(e)&&"Math."!==e.slice(0,5)}function d(e,t,n){var i=fe[e];return i||(o(t,n),fe[e]=i=new pe(e,t),s()),i}function p(t){return e.isArrayLike(t)?t[0]:t}function f(t){return e.isArrayLike(t)?t[t.length-1]:t}function v(t,n){e.isArrayLike(t)?e.each(t,n):n(t)}function m(e,t,n,i){return n?(me.prop(e,t,i),me):me.prop(e,t)}function g(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function b(e,t,n){if(ye[e])return ye[e];t=t||ke.style;for(var i=0,r=Ce.length;i<r;i++)if(n=g(Ce[i]+e),n in t)return ye[e]=n;return null}function y(e){for(var t=e.offsetParent;t&&"static"===Se(t,"position");)t=t.offsetParent;return t||ke}function x(e){var t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,i=n.body,r=n.documentElement,o=n.defaultView||n.parentWindow;if(!me.inDoc(e,r))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var s=r.clientTop||i.clientTop,c=r.clientLeft||i.clientLeft,a=Math.max(o.pageYOffset||0,r.scrollTop,i.scrollTop),u=Math.max(o.pageXOffset||0,r.scrollLeft,i.scrollLeft);return{top:t.top+a-s,left:t.left+u-c}}function w(e){return e.window&&e.document?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}function C(t){return e.isNil(t)||NaN===t?"":e.isString(t)?t:t+""}function E(t,n,i,r){if(!e.isFunc(i))throw TypeError("Invalid Event Handler");var o=t[Fe],s=void 0,c=!1;if(o||(t[Fe]=o={}),s=o[n]){if(s.contains(i))return!1}else o[n]=s=new e.LinkedList,c=!0;return s.push({handler:i,once:r}),c}function k(e,t,n){var i=e[Fe],r=i&&i[t];return!(!r||r.empty())&&(r.remove(n),r.empty())}function S(e,t){var n=e[Fe];return n&&n[t]}function T(e,t,n){var i=e[Fe],r=i&&i[t];return!!r&&(n?r.contains(n):!r.empty())}function D(e,t,n){var i=Xe[t];i&&i.bind&&i.bind(e,t,n)===!1||Ve(e,i?i.type||t:t,_,!!Re[t])}function A(e,t,n){var i=Xe[t];i&&i.unbind&&i.unbind(e,t,n)===!1||Be(e,i?i.type||t:t,_)}function N(e,t){We[e]?We[e]++:(D(Ae,e,t),We[e]=1)}function P(e,t){We[e]&&(We[e]--,We[e]||A(Ae,e,t))}function L(e,t,n){var i=S(e,t.type);if(i){t.currentTarget=e,t.isImmediatePropagationStopped=!1,i.each(function(i){if(n){var r=new Date;r-Ye>16&&(i.handler.call(e,t),Ye=r)}else i.handler.call(e,t);return i.once&&me.off(e,t.type,i.handler),!t.isImmediatePropagationStopped})}}function $(e,t,n){if(e.disabled!==!0||"click"!==t){var i=/move|scroll/.test(t);if(qe[t])for(;e&&e.getAttribute&&!n.cancelBubble;)L(e,n,i),e=e.parentNode;else L(e,n,i)}}function _(e){e=new He(e);var t=e.type,n=e.target;if(ze[t]){t=ze[t];var i=Xe[t];if(i&&i.fix&&i.fix(n,e)===!1)return;e.type=t,$(n,t,e)}else $(n,t,e)}function I(e){for(Ue=!0;e=je.shift();)e()}function O(t){var n=t.cloneNode(!1);return 1==t.nodeType&&e.each(t.childNodes,function(e){n.appendChild(O(e))}),n}function H(t){return e.isArrayLike(t)?e.map(t,O):O(t)}function F(e){return e.charAt(e.length-1).toUpperCase()}function V(e){return e.replace(pt,F)}function B(e,n,i){return t.each(n,function(t,n){e[i[n]||n]=t}),e}e="default"in e?e["default"]:e,t="default"in t?t["default"]:t;var M=/{([^{]+)}/g,q=e.dynamicClass({constructor:function(e){this.text=e,this.index=0},nextToken:function(){var e=M.exec(this.text);if(e){var t=this.index=M.lastIndex;return{token:e[1],start:t-e[0].length,end:t}}this.index=0}}),R=new e.Configuration,X=e.dynamicClass({statics:{commentCfg:"generateComments"},constructor:function(e){this._scope=t.obj(e.scope),this.el=e.el,this.tpl=e.tpl},expressionScopeProvider:function(e,t){return t?"$binding.exprScope('"+e+"')":"$scope"},scope:function(){var e=this._scope;return t.proxy(e)||e},realScope:function(){return this._scope},propScope:function(n){for(var i=this.realScope(),r=void 0;(r=i.$parent)&&!e.hasOwnProp(i,n);)i=r;return t.proxy(i)||i},exprScope:function(t){return this.propScope(e.parseExpr(t)[0])},observe:function(e,n){t.on(this.exprScope(e),e,n)},unobserve:function(e,n){t.un(this.exprScope(e),e,n)},get:function(t){return e.get(this.realScope(),t)},has:function(t){return e.has(this.realScope(),t)},set:function(t,n){e.set(this.scope(),t,n)},bind:function(){throw new Error("abstract method")},unbind:function(){throw new Error("abstract method")},destroy:function(){}});R.register(X.commentCfg,!0);var z=new e.Logger("tpl","debug"),W={},Y={register:function(t,n){if(W[t])throw Error("Translate["+t+"] is existing");e.isFunc(n)&&(n={transform:n}),n.type=n.type||"normal",W[t]=n,z.debug("register Translate["+n.type+":"+t+"]")},get:function(e){return W[e]},transform:function(e,t,n,i,r){var o=W[e],s=o&&o.type,c=o&&(r?o.restore:o.transform);return c?n=c.apply(t,[n].concat(i)):z.warn("Translate["+e+"]."+(r?"Restore":"Transform")+" is undefined"),{stop:"event"==s&&n===!1,data:n,replace:"event"!==s}},restore:function(e,t,n){return this.apply(e,t,n,!1)}},j={esc:27,tab:9,enter:13,space:32,"delete":[8,46],up:38,left:37,right:39,down:40},U={key:function(e){for(var t=e.which,n=void 0,i=1,r=arguments.length;i<r;i++)if(n=arguments[i],t==(j[n]||n))return!0;return!1},stop:function(e){e.stopPropagation()},prevent:function(e){e.preventDefault()},self:function(e){return e.target===e.currentTarget}};e.each(U,function(e,t){Y.register(t,{type:"event",transform:e})});var K={json:{transform:function(e,t){return"string"==typeof e?e:JSON.stringify(e,null,Number(t)||2)},restore:function(e){try{return JSON.parse(e)}catch(t){return e}}},trim:{transform:e.trim,restore:e.trim},capitalize:function(t){return e.isString(t)?t.charAt(0).toUpperCase()+t.slice(1):t},uppercase:function(t){return e.isString(t)?t.toUpperCase():t},lowercase:function(t){return e.isString(t)?t.toLowerCase():t},currency:function(e,t){if(e=parseFloat(e),!isFinite(e)||!e&&0!==e)return"";t=null!=t?t:"$";var n=Math.abs(e).toFixed(2),i=n.slice(0,-3),r=i.length%3,o=r>0?i.slice(0,r)+(i.length>3?",":""):"",s=n.slice(-3),c=e<0?"-":"";return c+t+o+i.slice(r).replace(digitsRE,"$1,")+s},plural:{transform:function(t){return e.isString(t)?e.plural(t):t},restore:function(t){return e.isString(t)?e.singular(t):t}},singular:{transform:function(t,n){return e.isString(t)?e.singular(t):t},restore:function(t){return e.isString(t)?e.plural(t):t}},unit:{transform:function(t,n,i,r){return r!==!1&&1!=t&&0!=t&&(n=e.plural(n)),i?e.format(i,t,n):t+n}},format:{transform:function(t,n){var i=[n,t].concat(Array.prototype.slice.call(arguments,2));return e.format.apply(e,i)}}};e.each(K,function(e,t){Y.register(t,e)});var Z=e.reverseConvert("tpl,observer,utility,window,document,Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat".split(","),function(){return!0}),G=/\s/g,J=/\n/g,Q=/[\{,]\s*[\w\$_]+\s*:|('(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"|`(?:[^`\\]|\\.)*\$\{|\}(?:[^`\\"']|\\.)*`|`(?:[^`\\]|\\.)*`)|new |typeof |void |(\|\|)/g,ee=/"(\d+)"/g,te=/[^\w$\.](?:(?:this\.)?[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*)*)/g,ne=/^[A-Za-z_$][\w$]*/,ie=/^[A-Za-z_$][\w$]*(?:\.[A-Za-z_$][\w$]*|\['.*?'\]|\[".*?"\]|\[\d+\]|\[[A-Za-z_$][\w$]*\])*$/,re=/^(?:true|false|null|undefined|Infinity|NaN)$/,oe=/\s*\|\s*(?:\|\s*)*/,se=/\.call|\.apply$/,ce=/^this\./;R.register("keywords",{});var ae=R.get(),ue=[],le=void 0,he=void 0,de=void 0,pe=e.dynamicClass({constructor:function(t,r){var o=t.replace(Q,n).split(oe),s=o.shift().replace(G,""),c=o;this.expr=s.replace(ee,i),this.filterExprs=e.map(function(e){return e.replace(ee,i)}),this.fullExpr=t,this.params=r,this.executor=a(u(s),r),this.filters=l(c,r),this.identities=e.keys(le),this.simplePath=h(this.expr)},executeFilter:function(t,n,i,r){return e.each(this.filters,function(o){var s=e.map(o.argExecutors,function(e){return e.apply(t,n)}),c=void 0;return c=0!=r?Y.transform(o.name,t,i,s):Y.restore(o.name,t,i,s),(c.replace||c.stop)&&(i=c.data),!c.stop}),i},restore:function(e,t,n){return this.executeFilter(e,t,n,!1)},execute:function(e,t){return this.executor.apply(e,t)},executeAll:function(e,t){return this.executeFilter(e,t,this.executor.apply(e,t),!0)},isSimple:function(){return this.simplePath}}),fe={};d.cache=fe;var ve="string"==typeof document.createElement("div").textContent?"textContent":"innerText",me={W3C:!!window.dispatchEvent,inDoc:function(e,t){if(t=t||document.documentElement,t.contains)return t.contains(e);try{for(;e=e.parentNode;)if(e===t)return!0}catch(n){}return!1},query:function(t,n){return e.isString(t)?n?document.querySelectorAll(t):document.querySelector(t):t},cloneNode:function(t,n){function i(e){return e.cloneNode(n!==!1)}return e.isArrayLike(t)?e.map(t,i):i(t)},parent:function(e){return p(e).parentNode},next:function(e,t){return e=f(e),t?e.nextSibling:e.nextElementSibling},prev:function(e,t){return e=p(e),t?e.previousSibling:e.previousElementSibling},children:function(e,t){return e=p(e),t?e.childNodes:e.children},remove:function(e){return v(e,function(e){var t=e.parentNode;t&&t.removeChild(e)}),me},before:function(e,t){t=p(t);var n=t.parentNode;return v(e,function(e){n.insertBefore(e,t)}),me},after:function(e,t){t=f(t);var n=t.parentNode;return v(e,n.lastChild===t?function(e){n.insertBefore(e,t)}:function(){var e=t.nextSibling;return function(t){n.insertBefore(t,e)}}()),me},append:function(e,t){return e=p(e),v(t,function(t){e.appendChild(t)}),me},prepend:function(e,t){return e.firstChild?me.before(t,t.firstChild):me.append(e,t),me},replace:function(e,t){var n=e.parentNode;n.replaceChild(t,e)},html:function(e,t){return arguments.length>1?e.innerHTML=t:e.innerHTML},outerHtml:function(e){if(e.outerHTML)return e.outerHTML;var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML},text:function(e,t){return 3==e.nodeType?arguments.length>1?e.data=t:e.data:arguments.length>1?e[ve]=t:e[ve]},focus:function(e){return e.focus(),me}};document.querySelectorAll||(document.querySelectorAll=function(e){var t=document,n=t.documentElement.firstChild,i=t.createElement("STYLE");if(n.appendChild(i),t.__qsaels=[],i.styleSheet)i.styleSheet.cssText=e+"{x:expression(document.__qsaels.push(this))}";else{var r=document.createTextNode(e+"{x:expression(document.__qsaels.push(this))}");i.appendChild(r)}return window.scrollBy(0,0),t.__qsaels}),document.querySelector||(document.querySelector=function(e){var t=document.querySelectorAll(e);return t.length?t[0]:null});var ge=/^(?:input|select|textarea|button|object)$/i,be=/^(?:a|area)$/i;e.assign(me,{prop:function(e,t,n){t=me.propFix[t]||t;var i=me.propHooks[t];return 2==arguments.length?i&&i.get?i.get(e,t):e[t]:(i&&i.set?i.set(e,t,n):e[t]=n,me)},attr:function(e,t,n){return 2==arguments.length?e.getAttribute(t):(e.setAttribute(t,n),me)},removeAttr:function(e,t){return e.removeAttribute(t),me},checked:function(e,t){return m(e,"checked",arguments.length>1,t)},"class":function(e,t){return m(e,"class",arguments.length>1,t)},addClass:function(t,n){if(t.classList)t.classList.add(n);else{var i=" "+me.prop(t,"class")+" ";i.indexOf(" "+n+" ")===-1&&me["class"](t,e.trim(i+n))}return me},removeClass:function(t,n){return t.classList?t.classList.remove(n):me["class"](t,e.trim((" "+me.prop(t,"class")+" ").replace(new RegExp(" "+n+" ","g"),""))),me},style:function(e,t){return m(e,"style",arguments.length>1,t)},propHooks:{tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex");return t&&t.specified?parseInt(t.value,10):ge.test(e.nodeName)||be.test(e.nodeName)&&e.href?0:void 0}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"}}),e.assign(me,{css:function(e,t,n){var i=/[_-]/.test(t)?g(t):t,r=void 0;if(t=b(i)||i,r=xe[i]||we,2==arguments.length){var o=n,s=void 0;return"background"===t&&(t="backgroundColor"),n=r.get(e,t),o!==!1&&isFinite(s=parseFloat(n))?s:n}return n||0===n?(isFinite(n)&&!Ee[i]&&(n+="px"),r.set(e,t,n)):e.style[t]="",me},position:function(e){var t=void 0,n=void 0,i={top:0,left:0};return"fixed"===me.css(e,"position")?n=e.getBoundingClientRect():(t=y(e),n=x(e),"HTML"!==t.tagName&&(i=x(t)),i.top+=me.css(t,"borderTopWidth",!0),i.left+=me.css(t,"borderLeftWidth",!0),i.top-=me.scrollTop(t),i.left-=me.scrollLeft(t)),{top:n.top-i.top-me.css(e,"marginTop",!0),left:n.left-i.left-me.css(e,"marginLeft",!0)}},scrollTop:function(e,t){var n=w(e);return 1==arguments.length?(n?"scrollTop"in n?n.scrollTop:ke.pageYOffset:e.pageYOffset)||0:(n?n.scrollTo(me.scrollLeft(e),t):e.pageYOffset=t,me)},scrollLeft:function(e,t){var n=w(e);return 1==arguments.length?(n?"scrollLeft"in n?n.scrollLeft:ke.pageXOffset:e.pageXOffset)||0:(n?n.scrollTo(t,me.scrollTop(e)):e.pageXOffset=t,me)},scroll:function(e,t,n){var i=w(e);return 1==arguments.length?{left:me.scrollLeft(e),top:me.scrollTop(e)}:(i?i.scrollTo(t,n):(e.pageXOffset=t,e.pageYOffset=n),me)}});var ye=me.cssFix={"float":me.W3C?"cssFloat":"styleFloat"},xe=me.cssHooks={},we={},Ce=["","-webkit-","-o-","-moz-","-ms-"],Ee={animationIterationCount:!0,columnCount:!0,order:!0,flex:!0,flexGrow:!0,flexShrink:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},ke=document.documentElement,Se=me.css;we.set=function(e,t,n){try{e.style[t]=n}catch(i){}};var Te=void 0;window.getComputedStyle?(Te=we.get=function(e,t){var n=void 0,i=getComputedStyle(e,null);return i&&(n="filter"===t?i.getPropertyValue(t):i[t],""===n&&(n=e.style[t])),n},xe.opacity={get:function(e,t){var n=Te(e,t);return""===n?"1":ret}}):!function(){var e=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,t=/^(top|right|bottom|left)$/,n=/alpha\([^)]*\)/i,i=!!window.XDomainRequest,r="DXImageTransform.Microsoft.Alpha",o={thin:i?"1px":"2px",medium:i?"3px":"4px",thick:i?"5px":"6px"};Te=we.get=function(n,i){var r=n.currentStyle,s=r[i];if(e.test(s)&&!t.test(s)){var c=n.style,a=c.left,u=n.runtimeStyle.left;n.runtimeStyle.left=r.left,c.left="fontSize"===i?"1em":s||0,s=c.pixelLeft+"px",c.left=a,n.runtimeStyle.left=u}return"medium"===s&&(i=i.replace("Width","Style"),"none"===r[i]&&(s="0px")),""===s?"auto":o[s]||s},xe.opacity={get:function(e,t){var n=e.filters.alpha||e.filters[r],i=n&&n.enabled?n.opacity:100;return i/100+""},set:function(e,t,i){var r=e.style,o=isFinite(i)&&i<=1?"alpha(opacity="+100*i+")":"",s=r.filter||"";r.zoom=1,r.filter=(n.test(s)?s.replace(n,o):s+" "+o).trim(),r.filter||r.removeAttribute("filter")}}}(),e.each(["top","left"],function(e){xe[e]={get:function(e,t){var n=Te(e,t);return/px$/.test(n)?n:me.position(e)[t]+"px"}}}),e.each(["Width","Height"],function(e){function t(e,t){var n=void 0;return n=e[i],2===t?n+Se(e,"margin"+r[0],!0)+Se(e,"margin"+r[1],!0):(t<0&&(n=n-Se(e,"border"+r[0]+"Width",!0)-Se(e,"border"+r[1]+"Width",!0)),t===-4&&(n=n-Se(e,"padding"+r[0],!0)-Se(e,"padding"+r[1],!0)),n)}var n=e.toLowerCase(),i="offset"+e,r="Width"==e?["Left","Right"]:["Top","Bottom"];me[n]=function(e){return t(e,-4)},me["inner"+e]=function(e){return t(e,-2)},me["outer"+e]=function(e,n){return t(e,n===!0?2:0)}}),e.assign(me,{val:function(e,t){var n=me.valHooks[e.type||e.tagName.toLowerCase()];return 1==arguments.length?n&&n.get?n.get(e):e.value||"":(n&&n.set?n.set(e,t):e.value=C(t),me)},valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t="select-one"==e.type,n=e.selectedIndex;if(n<0)return t?void 0:[];for(var i=e.options,r=void 0,o=t?void 0:[],s=0,c=i.length;s<c;s++)if(r=i[s],r.selected||s==n){if(t)return me.val(r);o.push(me.val(r))}return o},set:function(t,n){var i="select-one"==t.type,r=t.options,o=void 0,s=void 0,c=void 0,a=void 0,u=void 0;if(t.selectedIndex=-1,e.isArray(n)||(n=e.isNil(n)?[]:[n]),a=n.length){i&&(a=n.length=1);var l=e.reverseConvert(n,function(){return!1}),h=0;for(s=0,c=r.length;s<c&&(o=r[s],u=me.val(o),!e.isBoolean(l[u])||(l[u]=o.selected=!0,++h!==a));s++)n=e.keys(l,function(e){return e===!0})}return i?n[0]:n}}}});var De=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ae=document.documentElement,Ne=e.assign(me,{hasListen:function(e,t,n){return T(e,t,n)},on:function(e,t,n,i){return E(e,t,n,i===!0)&&(qe[t]?N(t,n):D(e,t,n)),me},once:function(e,t,n){return me.on(e,t,n,!0)},off:function(e,t,n){return k(e,t,n)&&(qe[t]?P(t,n):A(e,t,n)),me},dispatchEvent:function(t,n,i){var r=void 0;return document.createEvent?(r=document.createEvent("Events"),r.initEvent(n,!0,!0,i),e.assign(r,i),t.dispatchEvent(r)):me.inDoc(t)&&(r=document.createEventObject(),e.assign(r,i),t.fireEvent("on"+n,r)),r}}),Pe=/^(?:mouse|contextmenu|drag)|click/,Le=/^key/,$e=["altKey","bubbles","cancelable","ctrlKey","currentTarget","propertyName","eventPhase","metaKey","relatedTarget","shiftKey","target","view","which"],_e={},Ie={props:["char","charCode","key","keyCode"],fix:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode)}},Oe={props:["button","buttons","clientX","clientY","offsetX","offsetY","pageX","pageY","screenX","screenY","toElement"],fix:function(e,t){var n,i,r,o=t.button;null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||document,i=n.documentElement,r=n.body,e.pageX=t.clientX+(i&&i.scrollLeft||r&&r.scrollLeft||0)-(i&&i.clientLeft||r&&r.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||r&&r.scrollTop||0)-(i&&i.clientTop||r&&r.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0)}},He=function(){function e(t){De(this,e);var n=t.type,i=_e[n],r=void 0,o=void 0;for(this.originalEvent=t,this.type=t.type,this.returnValue=!(t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault()),this.timeStamp=t&&t.timeStamp||new Date+0,r=$e.length;r--;)o=$e[r],this[o]=t[o];if(i||(_e[n]=i=Pe.test(n)?Oe:Le.test(n)?Ie:{}),i.props){var s=i.props;for(r=s.length;r--;)o=s[r],this[o]=t[o]}this.target||(this.target=t.srcElement||document),3==this.target.nodeType&&(this.target=this.target.parentNode),i.fix&&i.fix(this,t)}return e.prototype.preventDefault=function(){var e=this.originalEvent;this.returnValue=!1,e&&(e.returnValue=!1,e.preventDefault&&e.preventDefault())},e.prototype.stopPropagation=function(){var e=this.originalEvent;this.cancelBubble=!0,e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())},e.prototype.stopImmediatePropagation=function(){var e=this.originalEvent;this.isImmediatePropagationStopped=!0,e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()},e}(),Fe="__LISTEN__",Ve=me.W3C?function(e,t,n,i){e.addEventListener(t,n,i)}:function(e,t,n){e.attachEvent("on"+t,n)},Be=me.W3C?function(e,t,n){e.removeEventListener(t,n)}:function(e,t,n){e.detachEvent("on"+t,n)},Me=["click","dblclick","keydown","keypress","keyup","mousedown","mousemove","mouseup","mouseover","mouseout","wheel","mousewheel","input","change","beforeinput","compositionstart","compositionupdate","compositionend","select","cut","copy","paste","beforecut","beforecopy","beforepaste","focusin","focusout","DOMFocusIn","DOMFocusOut","DOMActivate","dragend","datasetchanged"],qe={},Re={focus:!0,blur:!0},Xe={},ze={},We={};e.each(Me,function(e){qe[e]=!0}),me.W3C||(delete qe.change,delete qe.select);var Ye=new Date;"onmouseenter"in Ae||e.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){Xe[e]={type:t,fix:function(e,t,n){var i=t.relatedTarget;return!i||i!==e&&!(16&e.compareDocumentPosition(i))}}}),e.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!Xe.animationend&&(Xe.animationend={type:t})}),"oninput"in document.createElement("input")?navigator.userAgent.indexOf("MSIE 9")!==-1&&(Xe.input={type:"input",fix:function(e){e.oldValue=e.value}},document.addEventListener("selectionchange",function(e){var t=document.activeElement;if("TEXTAREA"===t.tagName||"INPUT"===t.tagName&&"text"===t.type){if(t.value==t.oldValue)return;t.oldValue=t.value,T(t,"input")&&(e=new He(e),e.type="input",$(t,"input",e))}})):(delete qe.input,Xe.input={type:"propertychange",fix:function(e,t){return"value"==t.propertyName}},Xe.change={bind:function(e){if("checkbox"==e.type||"radio"==e.type)return e.$onchange||(e.$onchange=function(t){t.type="change",$(e,"change",t)},me.on(e,"click",e.$onchange)),!1},unbind:function(e){if("checkbox"==e.type||"radio"==e.type)return me.off(e,"click",e.$onchange),!1}}),void 0===document.onmousewheel&&!function(){var e=document.onwheel?"wheel":"DOMMouseScroll",t="wheel"===e?"deltaY":"detail";Xe.mousewheel={type:e,fix:function(e,n){return n.wheelDeltaY=n.wheelDelta=n[t]>0?-120:120,n.wheelDeltaX=0,!0}}}(),e.each(Xe,function(e,t){ze[e.type||t]=t});var je=[],Ue=void 0,Ke=document.documentElement;"complete"===document.readyState?setTimeout(I):document.addEventListener?document.addEventListener("DOMContentLoaded",I):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&I()}),Ke.doScroll&&null===window.frameElement&&window.external&&!function(){var e=function(){try{Ke.doScroll("left"),I()}catch(t){setTimeout(e)}};e()}()),Ne.on(window,"load",I),Ne.ready=function(e){return Ue?e():je.push(e),Ne};var Ze=["$scope","$el","$tpl","$binding"],Ge=e.dynamicClass({extend:X,constructor:function(e){this["super"](arguments),this.expression=d(e.expression,Ze,this.expressionScopeProvider),R.get(X.commentCfg)&&(this.comment=document.createComment("Text Binding "+e.expression),me.before(this.comment,this.el)),this.observeHandler=this.observeHandler.bind(this)},value:function(){var e=this.scope();return this.expression.executeAll(e,[e,this.el,this.tpl,this])},bind:function(){var t=this;e.each(this.expression.identities,function(e){t.observe(e,t.observeHandler)}),this.update(this.value())},unbind:function(){var t=this;e.each(this.expression.identities,function(e){t.unobserve(e,t.observeHandler)})},observeHandler:function(e,t){if(this.expression.isSimple()){var n=this.scope();this.update(this.expression.executeFilter(n,[n,this.el,this.tpl,this],t))}else this.update(this.value())},update:function(t){e.isNil(t)&&(t=""),t!==me.text(this.el)&&me.text(this.el,t)}}),Je={},Qe=e.dynamicClass({extend:X,independent:!1,block:!1,priority:5,constructor:function(e){this["super"](arguments),this.expr=e.expression,this.attr=e.attr,this.children=e.children,this.domParser=e.domParser,this.group=e.group,R.get(X.commentCfg)&&(this.comment=document.createComment("Directive["+this.attr+"]: "+this.expr),me.before(this.comment,this.el))},bindChildren:function(){this.children&&e.each(this.children,function(e){e.bind()})},bind:function(){this.bindChildren()},unbindChildren:function(){this.children&&e.each(this.children,function(e){e.unbind()})},unbind:function(){this.unbindChildren()},statics:{getPriority:function(e){return e.prototype.priority},isBlock:function(e){return e.prototype.block},isIndependent:function(e){return e.prototype.independent},getDirective:function(e){return Je[e.toLowerCase()]},isDirective:function(t){return e.isExtendOf(t,Qe)},register:function(t,n){var i=void 0;if(t=t.toLowerCase(),e.isObject(n))n.extend=n.extend||Qe,i=e.dynamicClass(n);else{if(!e.isFunc(n)||!e.isExtendOf(n,Qe))throw TypeError("Invalid Directive["+t+"] "+n);i=n}if(t in Je)throw new Error("Directive["+t+"] is existing");return Je[t]=i,z.debug("register Directive[%s]",t),i}}}),et=e.dynamicClass({extend:X,constructor:function(e){this["super"](arguments),this.children=e.children,this.bindedCount=0,this.bindedChildren=!1,this._bind=this._bind.bind(this)},_setDirectives:function(e){this.directives=e,this.directiveCount=e.length},_bind:function(){var t=this.bindedCount;if(t<this.directiveCount){var n=this.directives[t],i=n.bind();this.bindedCount++,i&&i instanceof e.YieId?i.then(this._bind):this._bind()}else this.children&&(e.each(this.children,function(e){e.bind()}),this.bindedChildren=!0)},bind:function(){this._bind()},unbind:function(){var t=this.directives,n=this.bindedCount;for(this.bindedChildren&&(e.each(this.children,function(e){e.unbind()}),this.bindedChildren=!1);n--;)t[n].unbind();this.bindedCount=0}});R.register("directiveReg",/^tpl-/,[RegExp]);var tt=e.dynamicClass({constructor:function(){this.reg=R.get("directiveReg")},isDirective:function(e){return this.reg.test(e)},getDirective:function(e){return Qe.getDirective(e.replace(this.reg,""))}}),nt=e.dynamicClass({constructor:function(e){this.scope=e,this.proxyHandler=this.proxyHandler.bind(this),t.proxy.on(e,this.proxyHandler)},proxyHandler:function(e,t){this.scope=t||e},before:function(e,t){return t!==!1&&this.bind(),me.before(this.el,me.query(e)),this},after:function(e,t){return t!==!1&&this.bind(),me.after(this.el,me.query(e)),this},prependTo:function(e,t){return t!==!1&&this.bind(),me.prepend(me.query(e),this.el),this},appendTo:function(e,t){return t!==!1&&this.bind(),me.append(me.query(e),this.el),this},remove:function(e){me.remove(this.el),e!==!1&&this.unbind()},bind:function(){return this.binded||(e.each(this.bindings,function(e){e.bind()}),this.binded=!0),this},unbind:function(){return this.binded&&(e.each(this.bindings,function(e){e.unbind()}),this.binded=!1),this},destroy:function(){t.proxy.un(this.scope,this.proxyHandler),this.binded&&e.each(this.bindings,function(e){e.unbind(),e.destroy()}),me.remove(this.el),this.bindings=void 0,this.el=void 0}});R.register("directiveParser",new tt,[tt]),R.register("TextParser",q,q,!0);var it=1,rt=2,ot=3,st=e.dynamicClass({constructor:function(e,t){this.el=this.parseEl(e,t),this.directiveParser=R.get("directiveParser"),this.TextParser=R.get("TextParser"),this.parse()},complie:function(e){var t=H(this.el),n=document.createDocumentFragment(),i=new nt(e);return me.append(n,t),i.el=t,i.bindings=this.parseBindings(this.bindings,e,this.parseEls(t),i),i},parseBindings:function(t,n,i,r){var o=this;return e.map(t,function(t){var s=t.type,c={el:i[t.index],scope:n,tpl:r};if(s===it)return c.expression=t.expression,new Ge(c);if(c.block=t.block,c.children=t.children?o.parseBindings(t.children||[],n,i):void 0,s===rt)return c.expression=t.expression,c.attr=t.attr,c.domParser=t.domParser,c.independent=t.independent,c.group=void 0,new t.directive(c);var a=new et(c);return a._setDirectives(e.map(t.directives,function(e){return new e.directive({el:c.el,scope:n,expression:e.expression,attr:e.attr,tpl:r,group:a})})),a})},parseEls:function(e){var t=0,n=this.elStatus;return this.eachDom(e,[],function(e,i){return i.push(e),n[t++].marked&&i},function(e,n){n.push(e),t++})},parseEl:function(t,n){if(e.isString(t)){if(t=e.trim(t),"<"==t.charAt(0)){var i=document.createElement("div");me.html(i,t),t=i.childNodes}t=me.query(t)}else n&&(t=me.cloneNode(t));return t},eachDom:function(t,n,i,r){var o=this;return e.isArrayLike(t)?e.each(t,function(e){o._eachDom(e,n,i,r)}):this._eachDom(t,n,i,r),n},_eachDom:function(t,n,i,r){var o=this;switch(t.nodeType){case 1:(n=i(t,n))&&e.each(e.map(t.childNodes,function(e){return e}),function(e){o._eachDom(e,n,i,r)});break;case 3:r(t,n)}},parse:function(){function t(e,t){return e&&(i.push({el:e,marked:t}),r++),e}var n=this,i=[],r=0,o=this.TextParser,s=this.directiveParser;this.elStatus=i,this.bindings=this.eachDom(this.el,[],function(n,i){var o=[],c=!1,a=!1,u=void 0;if(e.each(n.attributes,function(e){var t=e.name,n=void 0;if(s.isDirective(t)){if(!(n=s.getDirective(t)))return void z.warn("Directive["+t+"] is undefined");var i={type:rt,index:r,expression:e.value,directive:n,attr:t,block:Qe.isBlock(n),independent:Qe.isIndependent(n)};if(i.independent)return i.block=c=a=!0,o=[i],!1;i.block&&(c=!0),o.push(i)}}),!o.length)return t(n,!0),i;if(u=1==o.length?o[0]:{type:ot,index:r,directives:o.sort(function(e,t){return Qe.getPriority(t.directive)-Qe.getPriority(e.directive)||0}),block:c,independent:a},u.children=!c&&[],i.push(u),a){var l=me.cloneNode(n,!1);me.removeAttr(l,o[0].attr),me.append(l,e.map(n.childNodes,function(e){return e})),u.domParser=new st(l,(!1))}return t(n,!c),u.children},function(e,i){var s=me.text(e),c=new o(s),a=void 0,u=0,l=e.parentNode;for(l.childNodes.length;a=c.nextToken();)u<a.start&&t(n.insertNotBlankText(s.substring(u,a.start),e),!1),i.push({type:it,index:r,expression:a.token}),t(n.insertText("binding",e),!1),u=a.end;u?(t(n.insertNotBlankText(s.substr(u),e),!1),me.remove(e)):t(e,!1)})},insertNotBlankText:function(e,t){return e?this.insertText(e||"&nbsp;",t):void 0},insertText:function(e,t){var n=document.createTextNode(e);return me.before(n,t),n}}),ct=0,at={},ut=e.dynamicClass({statics:{get:function(e){return at[e]},DomParser:st,DirectiveParser:tt,TextParser:q},constructor:function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.id=n.id||ct++,e.hasOwnProp(at,this.id))throw new Error("Existing Template["+this.id+"]");this.parser=new st(t),at[this.id]=this},complie:function(e){return this.parser.complie(e)}}),lt=/^\s*([\s\S]+)\s+in\s+([\S]+)(\s+track\s+by\s+([\S]+))?\s*$/,ht=/^(\(\s*([^,\s]+)(\s*,\s*([\S]+))?\s*\))|([^,\s]+)(\s*,\s*([\S]+))?$/,dt=Qe.register("each",e.dynamicClass({extend:Qe,independent:!0,block:!0,priority:10,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this);var e=this.expr.match(lt);if(!e)throw Error("Invalid Expression["+this.expr+"] on Each Directive");this.scopeExpr=e[2],this.indexExpr=e[4];var t=e[1].match(ht);if(!t)throw Error("Invalid Expression["+e[1]+"] on Each Directive");this.valueAlias=t[2]||t[5],this.keyAlias=t[4]||t[7],this.begin=document.createComment("each begin"),this.end=document.createComment("each end"),me.replace(this.el,this.begin),me.after(this.end,this.begin),this.el=void 0,this.version=1},update:function(n){var i=this,r=this.domParser,o=this.realScope(),s=(this.begin,this.end),c=this.indexExpr,a=this.used,u=this.version++,l=this.used={},h=e.map(n,function(n,i){var r=c?e.get(n,c):i,o=a&&a[r],s=void 0;return o&&o.version===u&&(o=void 0),s=o||{index:r},s.version=u,s.data=t.proxy(n),l[r]=s,s}),d=[],p=document.createDocumentFragment();a&&tpl.each(a,function(e){e.version!=u&&d.push(e),e.tpl.remove(!1)}),tpl.each(h,function(e){var t=!1;if(!e.scope){var n=d.pop();n?(e.scope=n.scope,e.tpl=n.tpl):(e.scope=i.createScope(o,e.data,e.index),e.tpl=r.complie(e.scope),t=!0)}t||i.initScope(e.scope,e.data,e.index),me.append(p,e.tpl.el),t&&e.tpl.bind()}),tpl.before(p,s),tpl.each(d,function(e){return e.tpl.destroy()})},createScope:function(t,n,i){var r=e.create(t);return r.$parent=t,r.$eachContext=this,this.initScope(r,n,i,!0),r},initScope:function(e,n,i,r){r||(e=t.proxy(e)),e[this.valueAlias]=n,this.keyAlias&&(e[this.keyAlias]=i)},bind:function(){this.observe(this.scopeExpr,this.observeHandler),this.update(this.target())},unbind:function(){this.unobserve(this.scopeExpr,this.observeHandler)},target:function(){return this.get(this.scopeExpr)},observeHandler:function(e,t){this.update(t)}})),pt=/^[a-z]|[_-]+[a-zA-Z]/g,ft=e.dynamicClass({
constructor:function(){this.doned=!1,this.thens=[]},then:function(e){this.doned?e():this.thens.push(e)},done:function(){if(!this.doned){this.doned=!0;for(var e=this.thens,t=0,n=e.length;t<n;t++)e[t]()}},isDone:function(){return this.doned}}),vt=Object.freeze({hump:V,YieId:ft}),mt=["$scope","$el","$event","$tpl","$binding"],gt=e.dynamicClass({extend:Qe,constructor:function(){this["super"](arguments),this.handler=this.handler.bind(this),this.expression=d(this.expr,mt,this.expressionScopeProvider)},handler:function(t){t.stopPropagation();var n=this.scope(),i=this.expression;if(i.executeFilter(n,[n,this.el,t,this.tpl,this],t)!==!1){var r=i.execute(n,[n,this.el,t,this.tpl,this]);i.isSimple()&&(e.isFunc(r)?(n=this.exprScope(i.expr),r.call(n,n,this.el,t,this.tpl,this)):z.warn("Invalid Event Handler:%s",this.expr,r))}},bind:function(){me.on(this.el,this.eventType,this.handler),this["super"](arguments)},unbind:function(){this["super"](arguments),me.off(this.el,this.eventType,this.handler)}}),bt=["blur","change","click","dblclick","error","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","resize","scroll","select","submit","unload",{name:"oninput",eventType:"input propertychange"}],yt=e.assign(e.convert(bt,function(t){var n=e.isObject(t)?t.name:t;return V(n+"Directive")},function(t){e.isObject(t)||(t={eventType:t});var n=t.name||"on"+t.eventType;return t.extend=gt,Qe.register(n,t)}),{EventDirective:gt}),xt=["$scope","$el","$tpl","$binding"],wt=e.dynamicClass({extend:Qe,constructor:function(){this["super"](arguments),this.observeHandler=this.observeHandler.bind(this),this.expression=d(this.expr,xt,this.expressionScopeProvider)},realValue:function(){var e=this.scope();return this.expression.execute(e,[e,this.el,this.tpl,this])},value:function(){var e=this.scope();return this.expression.executeAll(e,[e,this.el,this.tpl,this])},listen:function(){var t=this;e.each(this.expression.identities,function(e){t.observe(e,t.observeHandler)}),this.update(this.value())},unlisten:function(){var t=this;e.each(this.expression.identities,function(e){t.unobserve(e,t.observeHandler)})},bind:function(){this.listen(),this["super"](arguments)},unbind:function(){this["super"](arguments),this.unlisten()},blankValue:function(t){return 0==arguments.length&&(t=this.value()),e.isNil(t)?"":t},observeHandler:function(e,t){if(this.expression.isSimple()){var n=this.scope();this.update(this.expression.executeFilter(n,[n,this.el,this.tpl,this],t))}else this.update(this.value())},update:function(e){throw"abstract method"}}),Ct="change",Et="input",kt="SELECT",St="INPUT",Tt="TEXTAREA",Dt="radio",At="checkbox",Nt={text:{block:!0,update:function(e){me.text(this.el,this.blankValue(e))}},html:{block:!0,update:function(e){me.html(this.el,this.blankValue(e))}},"class":{update:function(t){t&&"string"==typeof t?this.handleArray(e.trim(t).split(/\s+/)):t instanceof Array?this.handleArray(t):t&&"object"==typeof t?this.handleObject(t):this.cleanup()},handleObject:function(e){this.cleanup(e,!1);var t=this.prevKeys=[],n=this.el;for(var i in e)e[i]?(me.addClass(n,i),t.push(i)):me.removeClass(n,i)},handleArray:function(t){this.cleanup(t,!0);var n=this.prevKeys=[],i=this.el;e.each(t,function(e){e&&(n.push(e),me.addClass(i,e))})},cleanup:function(t,n){var i=this.prevKeys;if(i)for(var r=i.length,o=this.el;r--;){var s=i[r];t&&(n?e.indexOf(t,s)!=-1:e.hasOwnProp(t,s))||me.removeClass(o,s)}}},style:{update:function(t){t&&e.isString(t)?me.style(this.el,t):t&&e.isObject(t)&&this.handleObject(t)},handleObject:function(t){this.cleanup(t);var n=(this.prevKeys=[],this.el);e.each(t,function(e,t){me.css(n,t,e)})}},show:{update:function(e){me.css(this.el,"display",e?"":"none")}},hide:{update:function(e){me.css(this.el,"display",e?"none":"")}},value:{update:function(e){me.val(this.el,this.blankValue(e))}},"if":{priority:9,bind:function(){return this.yieId=new ft,this.listen(),this.yieId},unbind:function(){this.yieId||this.unbindChildren(),this.unlisten()},update:function(e){e?(this.yieId&&(this.yieId.done(),this.yieId=void 0,this.bindChildren()),me.css(this.el,"display","")):me.css(this.el,"display","none")}},checked:{update:function(t){e.isArray(t)?me.checked(this.el,e.indexOf(t,me.val(this.el))):me.checked(this.el,!!t)}},selected:{update:function(e){}},focus:{update:function(e){e&&me.focus(this.el)}},input:{priority:4,constructor:function(){if(this["super"](arguments),!this.expression.isSimple())throw TypeError("Invalid Expression["+this.expression.expr+"] on InputDirective");this.onChange=this.onChange.bind(this);var e=this.tag=this.el.tagName;switch(e){case kt:this.event=Ct;break;case St:var t=this.type=this.el.type;this.event=t==Dt||t==At?Ct:Et;break;case Tt:throw TypeError("Directive[input] not support "+e);default:throw TypeError("Directive[input] not support "+e)}},bind:function(){me.on(this.el,this.event,this.onChange),this["super"]()},unbind:function(){this["super"](),me.off(this.el,this.event,this.onChange)},setRealValue:function(e){this.set(this.expression.expr,e)},setValue:function(e){var t=this.scope();this.setRealValue(this.expression.restore(t,[t,this.el,this.tpl,this],e))},onChange:function(e){var t=this.elVal(),n=this.val;t!=n&&this.setValue(t),e.stopPropagation()},update:function(e){var t=this.blankValue(e);t!=this.val&&this.elVal(this.val=t)},elVal:function(e){var t=this.tag;switch(t){case kt:break;case St:var n=this.type;if(n==Dt||n==At){if(0==arguments.length)return me.checked(this.el)?me.val(this.el):void 0;var i=void 0;i=e==me.val(this.el),me.checked(this.el)!=i&&me.checked(this.el,i)}else{if(0==arguments.length)return me.val(this.el);e!=me.val(this.el)&&me.val(this.el,e)}break;case Tt:throw TypeError("Directive[input] not support "+t);default:throw TypeError("Directive[input] not support "+t)}}}},Pt=e.assign(e.convert(Nt,function(e,t){return V(t+"Directive")},function(e,t){return e.extend=wt,Qe.register(t,e)}),{SimpleDirective:wt}),Lt=e.assign({EachDirective:dt},yt,Pt);e.assign(ut,{translate:Y,expression:d,Directive:Qe,directives:Lt,config:R,logger:z,init:function(e){t.init(e),R.config(e)}},me,vt);var $t=function(e,t){return new ut(e,t)};return e.assign($t,ut,{Template:ut,utility:e,observer:t}),B(e.assign($t,e),t.observer,{on:"observe",un:"unobserve",hasListen:"isObserved"}),$t});
//# sourceMappingURL=tpl.min.js.map