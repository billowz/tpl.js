!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("jquery"),require("observer")):"function"==typeof define&&define.amd?define(["_","jquery","observer"],e):"object"==typeof exports?exports.tpl=e(require("_"),require("jquery"),require("observer")):t.tpl=e(t._,t.jQuery,t.observer)}(this,function(t,e,i){return function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=i(1),o=i(2),s=i(3),a=i(4),c=i(6),u=s.TextNodeDirective,p={delimiter:["{","}"],directivePrefix:"tpl-"},h=function(){function t(e,i){r(this,t),this.template=o(e),this.cfg=n.assign(n.clone(p),i||{});var s=this.cfg.delimiter[0],a=this.cfg.delimiter[1];this.delimiterReg=new RegExp(s+"([^"+s+a+"]*)"+a,"g"),this.attrDirectiveTestReg=new RegExp("^"+this.cfg.directivePrefix)}return t.prototype.complie=function(t){return new l(this,t)},t}(),l=function(){function t(e,i){if(r(this,t),!(e instanceof h))throw TypeError("Invalid Template "+e);this.template=e,this.bind=i,this.el=this.template.template.clone(),this.init()}return t.prototype.init=function(){var t=this;this.directives=[],n.each(this.el,function(e){t.directives.push.apply(t.directives,t.parse(e))}),this.directives.forEach(function(e){t.bind=e.bind()})},t.prototype.parse=function(t){switch(t.nodeType){case 1:return this.parseElement(t);case 3:return this.parseText(t)}return[]},t.prototype.parseDirectiveName=function(t){var e=this.template.attrDirectiveTestReg;return e.test(t)?t.replace(e,""):void 0},t.prototype.parseElement=function(t){var e=this,i=!1,r=(o(t),[]);return t.attributes&&n.each(t.attributes,function(n){var o=n.name,s=n.value,c=void 0,u=void 0;(o=e.parseDirectiveName(o))&&(c=a.getDirective(o))?(u=new c(t,e,s),r.push(u),u.isBlock()&&(i=!0)):o&&console.warn("Directive is undefined "+n.name)}),i||n.each(t.childNodes,function(t){r.push.apply(r,e.parse(t))}),r},t.prototype.parseText=function(t){for(var e=t.data,i=void 0,r=0,n=this.template.delimiterReg,s=[];i=n.exec(e);)this.createTextNode(e.substr(r,n.lastIndex-i[0].length),t),s.push(new u(this.createTextNode("binding",t),this,i[1])),r=n.lastIndex;return this.createTextNode(e.substr(r),t),o(t).remove(),s},t.prototype.createComment=function(t,e){var i=document.createComment(t);return o(i).insertBefore(e),i},t.prototype.createTextNode=function(t,e){if(t){var i=document.createTextNode(t);return o(i).insertBefore(e),i}return void 0},t}();h.Directive=a,h.Directives=s,h.Expression=c,t.exports=h},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var o=i(1),s=i(4),a=i(6),c=s.AbstractDirective,u=function(t){function e(i,n,o){r(this,e),t.call(this,i,n,o),this.expression=new a(this.target,o),this.update=this.update.bind(this),this.$el=$(i)}return n(e,t),e.prototype.bind=function(){this.template.createComment(" Directive:"+this.directiveName+" ["+this.expr+"] ",this.$el);var t=this.expression.observe(this.update);return this.update(),t},e.prototype.unbind=function(){return this.expression.unobserve(this.update)},e.prototype.getValue=function(){return this.expression.getValue()},e.prototype.setValue=function(t){this.expression.setValue(t)},e.prototype.update=function(){throw"Abstract Method ["+this.getDirectiveClassName()+".unbind]"},e}(c);e.ExprDirective=u;var p=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){this.el.data=this.getValue()},e}(u);e.TextNodeDirective=p;var h=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){this.$el.text(this.getValue()||"")},e}(u);e.TextDirective=h;var l=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){this.$el.html(this.getValue()||"")},e}(u);e.HtmlDirective=l;var f=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){var t=this.getValue();this.$el.addClass(t)},e}(u);e.ClassDirective=f;var d=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){this.$el.css("display",this.getValue()?"":"none")},e}(u);e.ShowDirective=d;var v=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){this.$el.css("display",this.getValue()?"none":"")},e}(u);e.HideDirective=v;var y=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){this.$el.val(this.getValue())},e}(u);e.ValueDirective=y;var b="change",m="input propertychange",g="click",x="SELECT",D="INPUT",T="TEXTAREA",w="radio",N="checkbox",C=function(t){function e(i,n,o){r(this,e),t.call(this,i,n,o),this.onChange=this.onChange.bind(this),this.event=m;var s=(this.tag=i.tagName,void 0);if(this.isSelect())this.event=b;else if(this.isInput())s=this.type=i.type,(this.isRadio()||this.isCheckBox())&&(this.event=g);else if(!this.isTextArea())throw TypeError("Directive[input] not support "+i.tagName);this.$el.on(this.event,this.onChange)}return n(e,t),e.prototype.onChange=function(){var t=this.elVal();t!=this.val&&this.setValue(t)},e.prototype.update=function(){this.val=this.getValue(),this.val!=this.elVal()&&this.elVal(this.val)},e.prototype.elVal=function(t){var e=0==arguments.length;if(this.isSelect());else if(this.isInput()){if(!this.isRadio()&&!this.isCheckBox())return this.$el.val.apply(this.$el,arguments);if(e)return this.$el.prop("checked")?this.$el.val():void 0;this.$el.prop("checked",o.isString(t)?t==this.$el.val():!!t)}else this.isTextArea()},e.prototype.isInput=function(){return this.tag==D},e.prototype.isSelect=function(){return this.tag==x},e.prototype.isTextArea=function(){return this.tag==T},e.prototype.isRadio=function(){return this.type==w},e.prototype.isCheckBox=function(){return this.type==N},e}(y);e.InputDirective=C;var E=function(t){function e(){r(this,e),t.apply(this,arguments)}return n(e,t),e.prototype.update=function(){var t=this;this.getValue()?(this.directives||(this.directives=[],o.each(this.el.childNodes,function(e){t.template.parse(e).forEach(function(e){e.bind(),t.directives.push(e)})})),this.$el.css("display","")):this.$el.css("display","none")},e.prototype.isBlock=function(){return!0},e}(u);e.IfDirective=E,o.each(t.exports,function(t,e){s.isDirective(t)&&t!==u&&t!==p&&s.register(o.kebabCase(e.replace(/Directive$/,"")),t)})},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t){var e=typeof t;if(!t||"function"!=e&&"object"!=e)return!1;for(var i=t;i=Object.getPrototypeOf(i);)if(i===c)return!0;return!1}function o(t,e){t in u&&console.warn("Directive["+t+"] is defined");var i=void 0;if(a.isPlainObject(e))i=function(e){var i=a.isFunction(e.constructor)?e.constructor:void 0;delete e.constructor;var r=function(){return function(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");c.apply(this,arguments),i&&i.apply(this,arguments)}}();return r.prototype=Object.create(c.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0},directiveName:{value:t,enumerable:!1,writable:!1,configurable:!1}}),Object.setPrototypeOf(r,c),r}(e);else{if(!n(e))throw TypeError("Invalid Directive Object "+e);i=e,i.prototype.directiveName||(i.prototype.directiveName=t)}return u[t]=i,i}function s(t){return u[t]}var a=i(1),c=(i(2),i(5),function(){function t(e,i,n){r(this,t),this.el=e,this.nodeType=e.nodeType,this.template=i,this.target=i.bind,this.expr=n,this.directiveName||(this.directiveName=this.constructor.name)}return t.prototype.getDirectiveClassName=function(){return this.constructor.name?this.constructor.name:a.capitalize(this.directiveName)+"Directive"},t.prototype.bind=function(){throw"Abstract Method ["+this.getDirectiveClassName()+".bind]"},t.prototype.unbind=function(){throw"Abstract Method ["+this.getDirectiveClassName()+".unbind]"},t.prototype.isBlock=function(){return!1},t}()),u={};t.exports={AbstractDirective:c,register:o,getDirective:s,isDirective:n}},function(t,e){t.exports=i},function(t,e,i){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=i(1),o=function(){function t(e,i){r(this,t),this.bind=e,this.expression=i}return t.prototype.getValue=function(){return n.get(this.bind,this.expression)},t.prototype.setValue=function(t){n.set(this.bind,this.expression,t)},t.prototype.observe=function(t){return this.bind=observer.observe(this.bind,this.expression,t),this.bind},t.prototype.unobserve=function(t){return this.bind=observer.unobserve(this.bind,this.expression,t),this.bind},t}();t.exports=o}])});