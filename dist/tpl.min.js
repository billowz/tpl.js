!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("jquery")):"function"==typeof define&&define.amd?define(["_","jquery"],e):"object"==typeof exports?exports.tpl=e(require("_"),require("jquery")):t.tpl=e(t._,t.jQuery)}(this,function(t,e){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},o=n(1),s=n(2),u=n(3),c=n(6),p=n(7),a=n(9),h=n(5),f={delimiter:["{","}"],directivePrefix:"tpl-"},l=function(){function t(e,n){i(this,t),this.template=s(e),this.cfg=o.assign(o.clone(f),n||{});var r=this.cfg.delimiter[0],u=this.cfg.delimiter[1];this.delimiterReg=new RegExp(r+"([^"+r+u+"]*)"+u,"g"),this.attrDirectiveTestReg=new RegExp("^"+this.cfg.directivePrefix)}return t.prototype.complie=function(t){return new d(this,t)},t}(),d=function(){function t(e,n){i(this,t),this.tpl=e,this.bind=n,this.el=this.tpl.template.clone(),this.init()}return t.prototype.init=function(){var t=this;this.bindings=this.parse(this.el),this.bindings.forEach(function(e){e.bind(),t.bind=e.getScope()})},t.prototype.parse=function(t){var e=this;if(!(t.jquery||t instanceof Array))return this.parseEl(t);var n=function(){var n=[];return o.each(t,function(t){n.push.apply(n,e.parseEl(t))}),{v:n}}();return"object"===("undefined"==typeof n?"undefined":r(n))?n.v:void 0},t.prototype.parseEl=function(t){switch(t.nodeType){case 1:return this.parseElement(t);case 3:return this.parseText(t)}},t.prototype.parseText=function(t){for(var e=t.data,n=void 0,i=0,r=this.tpl.delimiterReg,o=[];n=r.exec(e);)this.createTextNode(e.substring(i,r.lastIndex-n[0].length),t),n[1]&&o.push(new u(this.createTextNode("binding",t),this,n[1])),i=r.lastIndex;return this.createTextNode(e.substr(i),t),s(t).remove(),o},t.prototype.createTextNode=function(t,e){if(t=o.trim(t)){var n=document.createTextNode(t);return s(n).insertBefore(e),n}},t.prototype.parseElement=function(t){var e=this,n=!1,i=(s(t),[]),r=[];return t.attributes&&(o.each(t.attributes,function(i){var o=i.name,s=i.value,u=void 0,p=void 0;(o=e.parseDirectiveName(o))&&(u=c.getDirective(o))?(p=new u(t,e,s),r.push(p),p.isBlock()&&(n=!0)):o&&console.warn("Directive is undefined "+i.name)}),r.length>1?i.push(new p(t,this,r)):1==r.length&&i.push(r[0])),n||i.push.apply(i,this.parseChildNodes(t)),i},t.prototype.parseChildNodes=function(t){return this.parse(o.slice(t.childNodes,0))},t.prototype.parseDirectiveName=function(t){var e=this.tpl.attrDirectiveTestReg;return e.test(t)?t.replace(e,""):void 0},t}();l.Directive=c,l.Directives=a,l.Expression=h,t.exports=l},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=(n(1),n(2)),u=n(4),c=n(5),p=c.ObserveExpression,a=function(t){function e(n,o,s){i(this,e);var u=r(this,t.call(this,o));return u.el=n,u.expr=s,u.expression=new p(u.scope,s),u.update=u.update.bind(u),u}return o(e,t),e.prototype.bind=function(){u.genComment&&!this.comment&&(this.comment=s(document.createComment("Text Binding "+this.expr)),this.comment.insertBefore(this.el)),this.scope=this.expression.observe(this.update),this.update()},e.prototype.unbind=function(){this.scope=this.expression.unobserve(this.update)},e.prototype.update=function(){var t=this.expression.getValue();void 0!==t&&null!==t||(t=""),this.el.data=t},e}(u);t.exports=a},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=(n(1),function(){function t(e){i(this,t),this.tpl=e,this.scope=e.bind}return t.prototype.bind=function(){throw"Abstract Method ["+this.constructor.name+".bind]"},t.prototype.unbind=function(){throw"Abstract Method ["+this.constructor.name+".unbind]"},t.prototype.getScope=function(){return this.scope},t}());r.genComment=!0,t.exports=r},function(t,e,n){"use strict";function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var s=n(1),u=e.AbstractExpression=function(){function t(e,n){o(this,t),this.bind=e,this.expr=n}return t.prototype.getValue=function(){throw"Abstract Method["+this.constructor.name+".getValue]"},t}(),c=(e.EventExpression=function(t){function e(){return o(this,e),i(this,t.apply(this,arguments))}return r(e,t),e.prototype.getValue=function(){return s.get(this.bind,this.expr).bind(this.bind)},e}(u),e.AbstractObserveExpression=function(t){function e(){return o(this,e),i(this,t.apply(this,arguments))}return r(e,t),e.prototype.observe=function(t){throw"Abstract Method["+this.constructor.name+".observe]"},e.prototype.unobserve=function(t){throw"Abstract Method["+this.constructor.name+".unobserve]"},e}(u));e.SimpleObserveExpression=function(t){function e(){return o(this,e),i(this,t.apply(this,arguments))}return r(e,t),e.prototype.getValue=function(){return s.get(this.bind,this.expr)},e.prototype.setValue=function(t){s.set(this.bind,this.expr,t)},e.prototype.observe=function(t){return this.bind=observer.observe(this.bind,this.expr,t),this.bind},e.prototype.unobserve=function(t){return this.bind=observer.unobserve(this.bind,this.expr,t),this.bind},e}(c),e.ObserveExpression=function(t){function e(){return o(this,e),i(this,t.apply(this,arguments))}return r(e,t),e.prototype.getValue=function(){return s.get(this.bind,this.expr)},e.prototype.observe=function(t){return this.bind=observer.observe(this.bind,this.expr,t),this.bind},e.prototype.unobserve=function(t){return this.bind=observer.unobserve(this.bind,this.expr,t),this.bind},e}(c),e.EachExpression=function(t){function e(n,r){return o(this,e),i(this,t.call(this,n,r))}return r(e,t),e.prototype.getValue=function(){return s.get(this.bind,this.expr)},e.prototype.observe=function(t){return this.bind=observer.observe(this.bind,this.expr,t),this.bind},e.prototype.unobserve=function(t){return this.bind=observer.unobserve(this.bind,this.expr,t),this.bind},e}(c)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},u=n(1),c=n(2),p=n(4),a="extend",h=function(t){function e(n,o,s){i(this,e);var u=r(this,t.call(this,o));return u.el=n,u.$el=c(n),u.expr=s,u}return o(e,t),e.prototype.getPriority=function(){return this.priority},e.prototype.isBlock=function(){return this.block},e.prototype.bind=function(){p.genComment&&!this.comment&&(this.comment=c(document.createComment(" Directive:"+this.name+" ["+this.expr+"] ")),this.comment.insertBefore(this.el))},e.prototype.unbind=function(){},e}(p);h.prototype.name=null,h.prototype.priority=0,h.prototype.block=!1;var f={},l=h.isDirective=function(t){var e="undefined"==typeof t?"undefined":s(t);if(!t||"function"!=e&&"object"!=e)return!1;for(var n=t;n=Object.getPrototypeOf(n);)if(n===h)return!0;return!1};h.register=function(t,e){t in f&&console.warn("Directive["+t+"] is defined");var n=void 0;if(u.isPlainObject(e))n=function(t,e){var n=t[a];if(n&&!l(n))throw"Invalid Directive SuperClass "+n;e=n||e;var i=u.isFunction(t.constructor)?t.constructor:void 0,r=function(){return function(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");e.apply(this,arguments),i&&i.apply(this,arguments)}}();return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),delete t.constructor,delete t[a],u.each(t,function(t,e){r.prototype[e]=t}),Object.setPrototypeOf(r,e),r}(e,h);else{if(!l(e))throw TypeError("Invalid Directive Object "+e);n=e}n.prototype.name=t;var i=n.prototype.constructor.name;return n.prototype.className=i?i:u.capitalize(t)+"Directive",f[t]=n,n},h.getDirective=function(t){return f[t]};t.exports=h},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(4),u=n(8),c=u.ArrayIterator,p=u.YieId,a=function(t){function e(n,o,s){i(this,e);var u=r(this,t.call(this,o));return u.el=n,u.directives=s,u.directives.sort(function(t,e){return e.priority-t.priority||0}),u}return o(e,t),e.prototype.bind=function(){function t(){for(var i=void 0,r=void 0;e.hasNext();)if(i=e.next(),r=i.bind(),n.scope=i.getScope(),e.hasNext()&&r&&r instanceof p){r.then(t);break}}var e=new c(this.directives),n=this;t()},e.prototype.unbind=function(){var t=this;this.directives.forEach(function(e){e.unbind(),t.scope=e.getScope()})},e}(s);t.exports=a},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=n(1),o=function(){function t(){i(this,t),this._doned=!1,this._thens=[]}return t.prototype.then=function(t){r.include(this._thens,t)||this._thens.push(t)},t.prototype.done=function(){this._doned||(r.each(this._thens,function(t){return t()}),this._doned=!0)},t.prototype.isDone=function(){return this._doned},t}(),s=function(){function t(e,n){i(this,t),this.array=e,this.index=n||0}return t.prototype.hasNext=function(){return this.index<this.array.length},t.prototype.next=function(){return this.array[this.index++]},t}();t.exports={YieId:o,ArrayIterator:s}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(e,n){var i=c.register(e,n);t.exports[i.prototype.className]=i}e.__esModule=!0;var u=n(1),c=n(6),p=n(5),a=p.SimpleObserveExpression,h=p.ObserveExpression,f=p.EventExpression,l=p.EachExpression,d=n(8),y=d.YieId,b=e.AbstractExpressionDirective=function(t){function e(n,o,s){i(this,e);var u=r(this,t.call(this,n,o,s));return u.expression=u.buildExpression(),u}return o(e,t),e.prototype.buildExpression=function(){throw"Abstract Method ["+this.className+".buildExpression]"},e.prototype.getValue=function(){return this.expression.getValue()},e.prototype.getBlankValue=function(){var t=this.getValue();return void 0===t||null==t?"":t},e}(c),v=e.EventDirective=function(t){function e(){return i(this,e),r(this,t.apply(this,arguments))}return o(e,t),e.prototype.buildExpression=function(){return new f(this.scope,this.expr)},e.prototype.getEventType=function(){if(!this.eventType)throw TypeError("EventType["+this.className+"] is undefined");return this.eventType},e.prototype.bind=function(){this.handler||(this.handler=this.getValue()),this.$el.on(this.getEventType(),this.handler)},e.prototype.unbind=function(){this.handler&&this.$el.un(this.getEventType(),this.handler)},e}(b),x=e.AbstractObserveExpressionDirective=function(t){function e(n,o,s){i(this,e);var u=r(this,t.call(this,n,o,s));return u.update=u.update.bind(u),u}return o(e,t),e.prototype.bind=function(){this.scope=this.expression.observe(this.update),this.update()},e.prototype.unbind=function(){this.scope=this.expression.unobserve(this.update)},e.prototype.update=function(){throw"Abstract Method ["+this.className+".update]"},e}(b),m=e.SimpleObserveExpressionDirective=function(t){function e(){return i(this,e),r(this,t.apply(this,arguments))}return o(e,t),e.prototype.buildExpression=function(){return new a(this.scope,this.expr)},e.prototype.setValue=function(t){this.expression.setValue(t)},e}(x),g=e.ObserveExpressionDirective=function(t){function e(){return i(this,e),r(this,t.apply(this,arguments))}return o(e,t),e.prototype.buildExpression=function(){return new h(this.scope,this.expr)},e}(x),w=e.EachDirective=function(t){function e(){return i(this,e),r(this,t.apply(this,arguments))}return o(e,t),e.prototype.buildExpression=function(){return new l(this.scope,this.expr)},e.prototype.bind=function(){},e}(x);w.prototype.priority=10,c.register("each",w);var E="change",T="input propertychange",O="click",_="SELECT",j="INPUT",C="TEXTAREA",S="radio",V="checkbox",k={input:{constructor:function(t,e,n){m.call(this,t,e,n),this.onChange=this.onChange.bind(this),this.event=T;var i=(this.tag=t.tagName,void 0);if(this.isSelect())this.event=E;else if(this.isInput())i=this.type=t.type,(this.isRadio()||this.isCheckBox())&&(this.event=O);else if(!this.isTextArea())throw TypeError("Directive[input] not support "+t.tagName)},bind:function(){m.prototype.bind.call(this),this.$el.on(this.event,this.onChange)},unbind:function(){m.prototype.unbind.call(this),this.$el.un(this.event,this.onChange)},onChange:function(){var t=this.elVal();t!=this.val&&this.setValue(t)},update:function(){this.val=this.getBlankValue(),this.val!=this.elVal()&&this.elVal(this.val)},elVal:function(t){var e=0==arguments.length;if(this.isSelect());else if(this.isInput()){if(!this.isRadio()&&!this.isCheckBox())return this.$el.val.apply(this.$el,arguments);if(e)return this.$el.prop("checked")?this.$el.val():void 0;this.$el.prop("checked",u.isString(t)?t==this.$el.val():!!t)}else this.isTextArea()},isInput:function(){return this.tag==j},isSelect:function(){return this.tag==_},isTextArea:function(){return this.tag==C},isRadio:function(){return this.type==S},isCheckBox:function(){return this.type==V}}},D={text:{update:function(){this.$el.text(this.getBlankValue())},block:!0},html:{update:function(){this.$el.html(this.getBlankValue())},block:!0},"class":{update:function(){var t=this.getBlankValue();this.oldCls&&this.$el.removeClass(this.oldCls),this.$el.addClass(t),this.oldCls=t}},show:{update:function(){this.$el.css("display",this.getValue()?"":"none")}},hide:{update:function(){this.$el.css("display",this.getValue()?"none":"")}},value:{update:function(){this.$el.val(this.getBlankValue())}},"if":{bind:function(){return g.prototype.bind.call(this),this.directives?void 0:(this.yieId=new y,this.yieId)},update:function(){var t=this;this.getValue()?(this.directives||(this.directives=this.tpl.parseChildNodes(this.el),this.directives.forEach(function(e){e.bind(),t.scope=e.getScope()}),this.yieId&&(this.yieId.done(),delete this.yieId)),this.$el.css("display","")):this.$el.css("display","none")},unbind:function(){var t=this;g.prototype.unbind.call(this),this.directives&&this.directives.forEach(function(e){e.unbind(),t.scope=e.getScope()})},priority:9,block:!0}},N=["blur","change","click","dblclick","error","focus","keydown","keypress","keyup","load","mousedown","mousemove","mouseout","mouseover","mouseup","resize","scroll","select","submit","unload",{name:"oninput",eventType:"input propertychange"}];u.each(k,function(t,e){t.extend=m,s(e,t)}),u.each(D,function(t,e){t.extend=g,s(e,t)}),u.each(N,function(t){var e=void 0;u.isString(t)?(e="on"+t,t={eventType:t}):e=t.name,t.extend=v,s(e,t)})}])});